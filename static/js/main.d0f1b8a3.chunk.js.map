{"version":3,"sources":["i18n.ts","Common/utils.ts","MappingScope/EditMap.ts","MappingScope/MapActions/AtomActions/types.ts","MappingScope/MapActions/AtomActions/SingleFlick.ts","MappingScope/MapActions/AtomActions/Slide.ts","MappingScope/MapActions/AtomActions/SlideNote.ts","MappingScope/MapActions/AtomActions/Timepoint.ts","MappingScope/MapActions/AtomHistory.ts","MappingScope/MapActions/MapActions.ts","MappingScope/MapActions/MapAtionsBase.ts","MappingScope/MapActions/CommonActions.ts","MappingScope/Meta.ts","MappingScope/Settings.ts","MappingScope/scope.ts","Common/AudioCtx/GlobalCtx.ts","Common/AudioCtx/MyEvent.ts","Common/AudioCtx/AudioSource.ts","Common/AudioCtx/AudioInstance.ts","Common/AudioCtx/AudioElInstance.ts","Common/AudioCtx/index.ts","MappingPage/states.ts","MappingPage/Components/BackgroundImage.tsx","MappingPage/theme.ts","MappingPage/Pages/MetaPage/CopyDialog.tsx","Common/Components/GlobalSnackbar.tsx","MapFormats/bestdori.ts","MappingPage/Pages/MetaPage/ConfirmDialog.tsx","MapFormats/bbbv1.ts","MappingPage/Pages/MetaPage/Actions.tsx","Common/Components/FileField.tsx","MappingPage/Pages/MetaPage/Inputs.tsx","MappingPage/Pages/MetaPage/index.tsx","MappingPage/Pages/TimingPage/sharedState.ts","MappingPage/Pages/TimingPage/LeftPanel.tsx","MappingPage/assets.ts","Common/hooks.ts","Common/animation.ts","MappingPage/Pages/TimingPage/RightPanel/ActionPart.tsx","MappingPage/Pages/TimingPage/RightPanel/TimingPad.tsx","MappingPage/Pages/TimingPage/RightPanel/MeasureBtn.tsx","Common/Components/NumberField.tsx","MappingPage/Pages/TimingPage/RightPanel/EditPart.tsx","MappingPage/Pages/TimingPage/RightPanel/index.tsx","MappingPage/Pages/TimingPage/index.tsx","MappingPage/Pages/SettingsPage/index.tsx","MappingPage/Pages/MappingPage/sharedState.ts","MappingPage/Pages/MappingPage/Tools.tsx","MappingPage/Pages/MappingPage/Track/styles.ts","MappingPage/Pages/MappingPage/Track/state.ts","MappingPage/Pages/MappingPage/Track/SVGs.tsx","MappingPage/Pages/MappingPage/Track/ActionPreview.tsx","MappingPage/Pages/MappingPage/Track/GridLayer.tsx","MappingPage/Pages/MappingPage/Track/NotesLayer.tsx","MappingPage/Pages/MappingPage/Track/ProgressLine.tsx","MappingPage/Pages/MappingPage/Track/InfoWindow.tsx","MappingPage/Pages/MappingPage/Track/BarLayer.tsx","MappingPage/Pages/MappingPage/Track/WarningLayer.tsx","Common/binarySearch.ts","MappingPage/Pages/MappingPage/Track/index.tsx","MappingPage/Pages/MappingPage/ScrollBar/drawCanvas.ts","MappingPage/Pages/MappingPage/ScrollBar/state.ts","MappingPage/Pages/MappingPage/ScrollBar/ProgressLine.tsx","MappingPage/Pages/MappingPage/ScrollBar/CanvasBar.tsx","MappingPage/Pages/MappingPage/ScrollBar/ViewPort.tsx","MappingPage/Pages/MappingPage/ScrollBar/index.tsx","MappingPage/Pages/MappingPage/soundEffect.ts","MappingPage/Pages/MappingPage/index.tsx","MappingPage/routes.tsx","MappingPage/Components/MainContent.tsx","GamePage/gamestate.ts","MappingPage/Components/HeaderBar.tsx","MappingPage/Components/FooterBar/ProgressBar.tsx","MappingPage/Components/FooterBar/Tools.tsx","MappingPage/Components/FooterBar/index.tsx","MappingPage/index.tsx","GamePage/index.tsx","MapFormats/bbbgame.ts","App.tsx","serviceWorker.ts","index.tsx"],"names":["missingKeys","Set","i18n","use","LanguageDetector","Backend","initReactI18next","init","fallbackLng","debug","nsSeparator","interpolation","escapeValue","backend","loadPath","react","useSuspense","saveMissing","missingKeyHandler","lngs","ns","key","add","global","window","RunIntoNeverError","Error","neverHappen","message","assert","v","undefined","randomId","Math","random","isObject","item","shallowPatch","obj","p","prev","changed","k","deepPatch","_deepPatch","changes","entryList","map","list","e","entries","push","itemList","_set","i","TimeToString","s","milis","minutes","seconds","toString","substr","once","fn","res","called","range","from","to","step","openFile","accept","Promise","rej","input","document","createElement","type","onchange","f","files","reader","FileReader","onload","result","onerror","readAsText","oncancel","click","EditMap","constructor","timepoints","slides","notes","this","Map","forJson","x","forEach","ticktimecache","realtimecache","JSON","stringify","json","parse","id","some","n","has","slide","timepoint","FreshTimepointCache","FreshNoteCache","tp","bpm","get","time","offset","ResortSlide","hasEqual","sorted","sort","a","b","lane","note","set","del","delete","setv","patch","SingleFlickActions","Add","Remove","flickend","length","SlideActions","filter","SlideNoteActions","bpb","newtp","TimepointActions","AtomHistory","state","act_done","act_todo","act_undo","callAtom","args","act","undoAtom","un","pop","redoAtom","doTransaction","startLen","doParallel","MapActions","history","changeListeners","ResetState","Undo","Redo","listener","done","super","_timepoints","_slides","_notes","findTimepoint","tps","timepointlist","tpindex","calcNearestPosition","division","tickcount","round","realtime","rtp","rtpindex","timepointIndex","patchNote","justifyFollowChanged","justifyFindNearest","deleteSlideNote","n1","n2","deleteOne","deleteMany","addTimepoint","justifydivision","notelist","moveTimepoint","timechanged","removeTimepoint","size","addSingle","toggleFlick","addSlide","tp1","off1","lane1","tp2","off2","lane2","sid","toggleFlickend","addSlideMid","moveMany","timeoffset","min","max","laneoffset","targetTime","targetLane","copyMany","slideidmap","slideNoteCount","slideid","parseInt","removeNotes","DefaultMeta","name","DefaultSettings","general","song_volume","effect_volume","background_dim","editor","keep_pitch","justify_find_nearest","justify_grid_divisor","show_info_window","warn_for_same_pos_notes","autosave_interval","game","judge_offset","visual_offset","speed","resolution","note_scale","bar_opaciry","show_sim_line","lane_effect","mirror","beat_note","StorageNames","scope","save","toJsonString","localStorage","setItem","lastSave","Date","reset","create","getItem","editmap","fromJson","error","removeItem","console","meta","observable","autorun","settings","setTimeout","now","getTime","timeout","AudioContext","webkitAudioContext","globalctx","_ctx","_output","createGain","connect","destination","currentTime","baseLatency","outputLatency","gain","MyEvent","listeners","dispatch","l","dispose","clear","AudioSource","buffer","onloaderr","load","ctx","sqrt","value","duration","getsource","err","data","Blob","onabort","ArrayBuffer","readAsArrayBuffer","decodeAudioData","src","Function","then","catch","AudioInstance","source","node","_playing","_starttime","_startpos","_playbackrate","onplay","onpause","onseek","onend","callstart","delay","startt","start","playedtime","handleNormalEnd","createnode","handlePauseEnd","position","handleSeekEnd","onended","createBufferSource","playbackRate","play","stop","pause","seek","setRate","rate","currentpos","AudioElInstance","_loaded","el","oncanplaythrough","preservesPitch","URL","createObjectURL","volume","async","loadFromUrl","url","fetch","arrayBuffer","useMapChange","setI","useState","useEffect","Background","Music","musicfile","file","m","audio","playing","seekcounter","instance","playbackrate","remaintime","toggle","useStyles","makeStyles","theme","background","zIndex","top","left","right","bottom","backgroundPosition","backgroundRepeat","transition","backgroundSize","BackgroundImage","cn","useObserver","Box","className","style","backgroundImage","opacity","createMuiTheme","palette","primary","main","blue","contrastText","secondary","red","default","overrides","MuiButton","root","textTransform","MuiTab","minWidth","MuiSnackbarContent","color","MuiTableRow","MuiDivider","height","backgroundColor","paper","width","dialog","open","content","title","openDialog","CopyDialog","copy","navigator","clipboard","writeText","onfocus","target","select","t","useTranslation","Dialog","onClose","classes","DialogTitle","DialogContent","TextField","autoFocus","onFocus","fullWidth","multiline","rowsMax","variant","DialogActions","Button","onClick","variantIcon","success","CheckCircleIcon","warning","WarningIcon","ErrorIcon","info","InfoIcon","Message","lightGreen","lightBlue","orange","icon","fontSize","iconVariant","marginRight","spacing","display","alignItems","userMessage","handleClose","event","reason","GlobalSnackbar","Icon","Snackbar","anchorOrigin","vertical","horizontal","autoHideDuration","SnackbarContent","clsx","action","IconButton","aria-label","properBpmForSpan","preferred","beattime","beats","beatcount","d","toBestdoriFormat","tpsPut","dt","bdmap","lasttp","tpbasebeat","cmd","beat","inote","lastnotebeat","abeat","bbeat","mid","end","slideScope","base","flick","sl","bdn","pos","lasttime","strb","join","format","confirm","ConfirmDialog","DialogContentText","getTimepoint","items","parseFloat","getPos","parts","split","getSingle","getFlick","getSlideNotes","Actions","Grid","margin","container","direction","lines","trim","line","fromBBBv1Format","href","download","body","appendChild","removeChild","revokeObjectURL","downLoadFile","FileField","forwardRef","props","ref","onFileSelected","inputProps","multiple","others","setDisplay","handleChange","useCallback","onSelected","fs","Array","useMemo","FileFieldWrapper","children","xs","MapName","label","onChange","musicfilename","SelectMusic","backgroundfilename","SelectBackground","Inputs","panel","maxWidth","Links","Typography","align","Link","rel","Update","update","fontWeight","fontFamily","fontStyle","textAlign","MetaPage","TimingState","selected","muteticker","measuring","autoswitchtp","reaction","table","maxHeight","overflow","tablerow","cursor","TimepointTable","Table","TableHead","TableRow","TableCell","TableBody","hover","RemoveBtn","removeTp","disabled","LeftPanel","sm","assets","note_flick","note_long","note_normal","note_slide_among","timing_tack","timing_tick","perfect","long","process","createAnimLoop","unmounted","cancel","loop","requestAnimationFrame","addHotkey","handler","hotkey","unbind","Calibration","counter","stopAnimation","prop","unit","getComputedStyle","startAnimation","setInterval","addtp","settp","ActionPart","wrap","marginTop","FormControlLabel","marginLeft","control","Switch","checked","labelPlacement","padding","transform","flexGrow","border","borderRadius","borderColor","willChange","sounds","tick","tack","nosounduntil","lastbeat","animloop","pads","currentBeat","floor","beatoff","beatnum","realbeattime","deltabeat","nexttimems","timeoutms","soundtime","performance","setsound","TimingPad","useRef","padcount","current","firstChild","calcMeasureRaw","taps","sum","timeoutId","startMeasure","setLen","recalc","processed","last","calcMeasure","clearTimeout","MeasureBtn","disableRipple","count","NumberField","number","validator","test","numberDisplay","onNumberChange","onBlur","userBlur","userChange","propNumberDisplay","valid","setValid","isNaN","movebeat","secondFromString","cindex","indexOf","EditPart","InputProps","endAdornment","InputAdornment","DelayNotice","RightPanel","timing","TimingPage","SliderWrapper","component","FormLabel","SwitchWrapper","General","Slider","valueLabelDisplay","FormControl","InputLabel","Select","language","changeLanguage","MenuItem","Editor","changeKeepPitch","date","getHours","getMinutes","getSeconds","Game","SettingsPage","Divider","MappingState","timeHeightFactor","viewOffset","mapChangeCounter","NoteSig","slidelist","sig","getViewposition","tracking","_viewposition","setViewposition","computed","GridD1","endtime","bar","innerbeat","tools","flexShrink","overflowX","overflowY","toolimg","zoomin","zoomout","SelectTool","tool","my","Tooltip","placement","RadioGroup","Radio","alt","SelectDivisor","ZoomInOut","getElementById","ctrlKey","stopPropagation","preventDefault","deltaY","addEventListener","removeEventListener","OtherTools","Tools","track","layer","pointerEvents","useNoteStyles","minHeight","noevent","slidebar","selection","panelRef","getBoundingClientRect","pointerClientY","rect","pointerClientX","laneFromLeftPercent","pointerLeftPercent","pointerTime","draggingNote","selectedNotes","percent","getSelectedNotes","nid","selectingNotes","slideNote1Beat","useMirror","Cross","viewBox","stroke","strokeWidth","fill","Rect","createStyle","PointerPos","selecting","pointerLane","pointerBeat","SlideNote1","slideNote1Lane","DragOneNote","SelectedNotes","Selection","l1","selectingStartLeft","l2","t1","selectingStartTime","t2","abs","ActionPreview","vertline","borderLeft","beatline1","borderBottom","subline","beatline2","beatline3","beatline4","bottomstyle","vertlines","LaneAndTime","DivisorLines","index","GridD2","beat_3","GridD3","beat_2","GridD4","TimepointStart","GridLayer","useLayerStyle","dragPointer","handleUp","button","changedTouches","identifier","draggingSelected","dl","before","preventClick","removeNote","Note","onMouseDown","downEventHandler","buttons","onContextMenu","contextMenuHandler","onDoubleClick","doubleClickHandler","clickEventHandler","draggable","NotesLayer","progress","transY","viewTime","transpx","ProgressLine","div","userSelect","InfoWindow","gcd","c","calcGCD","divide","Bar","layerWidth","dh","dw","atan2","clickHandler","BarLayer","setLayerWidth","clientWidth","cb","forEachBar","WaringRect","noteid","WarningLayer","samePosNotes","binarySearch","listlen","r","handleScroll","flushPointerPos","clientX","clientY","touches","reduce","selectPointer","handleDown","activeElement","blur","stopSelect","handleMove","noteListOrdered","slice","handleClick","nativeEvent","Track","paddedDuration","viewduration","onWheel","getX","getY","drawLine","xfrom","xto","y","beginPath","moveTo","lineTo","drawBar","fromx","fromy","tox","toy","drawDiamond","drawOval","arcTo","drawCircle","ellipse","PI","progressTransY","playtime","barTransY","viewtime","barHeight","containerHeight","viewTransY","h","canvas","Canvas","change","getContext","timelist","clearRect","font","lineWidth","strokeStyle","fillStyle","fillText","drawScrollBar","drawWarning","handelMouseTouch","currentTarget","viewportheight","CanvasBar","onTouchStart","viewport","touchState","offsetY","handelMouseTouchStart","parentElement","TimeYtoBottom","ViewPort","scrollbar","ScrollBar","clientHeight","images","blob","noSoundUntil","soundlist","toBeStopped","au","justifyContent","routes","router","path","location","hash","useHashRoutes","ContentComponent","wrapping","MainContent","Component","Fade","in","statelistener","startGame","pushState","tabs","HeaderTabs","Tabs","indicatorColor","NavigateTo","Object","keys","Tab","SaveIcon","noticed","setNoticed","lastsave","HeaderActions","actionlist1","canUndo","canRedo","actionlist2","HeaderBar","flex","center","midline","TimepointLines","PlayTime","innerText","handleMouse","pageX","offsetLeft","handleTouch","ProgressBar","onMouseMove","onTouchMove","loaded","ml","mr","marks","FooterBar","flexDirection","MappingPage","ThemeProvider","CssBaseline","GamePage","back","musicSrc","judgeOffset","visualOffset","noteScale","barOpacity","backgroundDim","effectVolume","showSimLine","laneEffect","beatNote","backgroundSrc","songName","skin","mapContent","slideIdIndex","onbeat","toGameContent","ondestroyed","App","remove","gtag","setHash","useGameState","isLocalhost","Boolean","hostname","match","registerValidSW","swUrl","config","serviceWorker","register","registration","onupdatefound","installingWorker","installing","onstatechange","controller","log","onUpdate","onSuccess","ev","ReactDOM","render","origin","headers","response","contentType","status","ready","unregister","reload","checkValidServiceWorker"],"mappings":"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","file":"static/js/main.d0f1b8a3.chunk.js","sourcesContent":["import i18n from \"i18next\"\nimport { initReactI18next } from \"react-i18next\"\nimport Backend from 'i18next-xhr-backend'\nimport LanguageDetector from 'i18next-browser-languagedetector'\n\nconst missingKeys = new Set<string>()\n\ni18n\n  .use(LanguageDetector)\n  .use(Backend)\n  .use(initReactI18next)\n  .init({\n    fallbackLng: 'en',\n    debug: false,//process.env.NODE_ENV === \"development\",\n\n    nsSeparator: \"::\",\n\n    interpolation: {\n      escapeValue: false\n    },\n\n    backend: {\n      loadPath: process.env.PUBLIC_URL + '/locales/{{lng}}.json',\n    },\n\n    react: {\n      useSuspense: false\n    },\n\n    saveMissing: true,\n    missingKeyHandler: function (lngs, ns, key) {\n      missingKeys.add(key)\n    }\n  })\n\nconst global = window as any\nglobal.i18n = i18n\nglobal.missingKeys = missingKeys\n\nexport default i18n\n","import { scope } from \"../MappingScope/scope\"\n\nexport class RunIntoNeverError extends Error { }\n\n/**\n * Describes a case will never happen  \n * throws a {@link RunIntoNeverError}  \n * @param message error message if happen\n */\nexport function neverHappen(message = \"Ran into never happen\"): never {\n  throw new RunIntoNeverError(message)\n}\n\n/**\n * gard value by a default value  \n */\nexport function gard<T>(v: T | null | undefined, d: T) {\n  return v === null || v === undefined ? d : v\n}\n\n/**\n * type gard for null | undefined assertion\n */\nexport function assert<T>(v: T): NonNullable<T> {\n  if (v === null || v === undefined) neverHappen(\"Assertion for not null or undefined fail\")\n  return v as NonNullable<T>\n}\n\n/**\n * generate a random positive int number\n */\nexport function randomId() {\n  return Math.random() * 0x80000000 | 0\n}\n\n/**\n * linear interpolation\n */\nexport function lerp(start: number, end: number, target: number, from: number, to: number) {\n  const r = (target - start) / (end - start)\n  return (to - from) * r + from\n}\n\nfunction isObject(item: any): item is object {\n  return (item && typeof item === 'object'/* && !Array.isArray(item) */)\n}\n\nfunction _patch(obj: any, p: any): any {\n  const prev: any = {}\n  let changed = false\n  for (const k in p) {\n    if (p[k] !== undefined) {\n      if (obj[k] !== p[k]) {\n        prev[k] = obj[k]\n        obj[k] = p[k]\n        changed = true\n      }\n    } else {\n      delete obj[k]\n    }\n  }\n  if (changed) return prev\n}\n\nfunction _deepPatch(obj: any, p: any): any {\n  if (!isObject(obj) && !isObject(p)) return\n  const prev: any = {}\n  let changed = false\n  for (const k in p) {\n    if (p[k] !== undefined) {\n      if (isObject(p[k]) && isObject(obj[k])) {\n        const changes = _deepPatch(obj[k], p[k])\n        if (changes) {\n          prev[k] = changes\n          changed = true\n        }\n      } else if (obj[k] !== p[k]) {\n        prev[k] = obj[k]\n        obj[k] = p[k]\n        changed = true\n      }\n    } else {\n      delete obj[k]\n    }\n  }\n  if (changed) return prev\n}\n\n/**\n * patch the object by another object  \n *  - shallow patch\n *  - iterable property only\n *  - ignores undefined patch property\n * @param obj - the object to patch\n * @param p   - the patch object\n * @returns previous value of changed items if any change applied, else undefined\n */\nexport const shallowPatch = _patch as <T extends {}, R extends Partial<T>>(obj: T, p: R) => Partial<R> | undefined\n\n/**\n * patch the object by another object \n *  - deep patch \n *  - iterable property only\n *  - ignores undefined patch property\n * @param obj - the object to patch\n * @param p   - the patch object\n * @returns previous value of changed items if any change applied, else undefined\n */\nexport const deepPatch = _deepPatch as <T extends {}, R extends Partial<T>>(obj: T, p: R) => Partial<R> | undefined\n\n/**\n * convert a map to entry list\n * @param map - the map to convert\n */\nexport function entryList<K, V>(map: Map<K, V> | DeepReadonly<Map<K, V>>) {\n  const list: [K, V][] = []\n  for (const e of map.entries()) {\n    list.push(e)\n  }\n  return list\n}\n\nexport function itemList<T>(_set: Set<T> | DeepReadonly<Set<T>>) {\n  const list: T[] = []\n  for (const i of _set.entries()) {\n    list.push(i[0])\n  }\n  return list\n}\n\nexport function TimeToString(s: number): string {\n  if (s < 0) return \"-\" + TimeToString(-s)\n  let milis = (s * 1000 + 0.5) | 0\n  let minutes = (milis / 60000) | 0\n  milis = (milis % 60000) | 0\n  minutes = (minutes + 100) | 0\n  let seconds = (milis / 1000) | 0\n  milis = (milis % 1000) | 0\n  seconds = (seconds + 100) | 0\n  milis = (milis + 1000) | 0\n  return minutes.toString().substr(1) + \":\" + seconds.toString().substr(1) + \".\" + milis.toString().substr(1)\n}\n\nexport function once<T>(fn: () => T) {\n  let res: T\n  let called = false\n  return function () {\n    if (!called) {\n      called = true\n      res = fn()\n    }\n    return res\n  }\n}\n\nexport function range(from: number, to?: number, step?: number) {\n  if (step === undefined) {\n    step = 1\n  }\n  if (to === undefined) {\n    to = from\n    from = 0\n  }\n  const res: number[] = []\n  while ((to - from) * step > 0) {\n    res.push(from)\n    from += step\n  }\n  return res\n}\n\nexport function downLoadFile(content: string | Blob) {\n  if (typeof content === \"string\")\n    content = new Blob([content])\n  const url = URL.createObjectURL(content)\n  const a = document.createElement(\"a\")\n  a.style.display = \"none\"\n  a.href = url\n  a.download = (scope.meta.name || \"No title\") + \" - bbbEditor.json\"\n  document.body.appendChild(a)\n  a.click()\n  document.body.removeChild(a)\n  URL.revokeObjectURL(url)\n}\n\nexport function openFile(accept: string) {\n  return new Promise<string>((res, rej) => {\n    const input = document.createElement(\"input\")\n    input.type = \"file\"\n    input.accept = accept\n    input.onchange = e => {\n      let f: File | null\n      if (input.files && (f = input.files.item(0))) {\n        const reader = new FileReader()\n        reader.onload = e => res(reader.result as string)\n        reader.onerror = e => rej(e)\n        reader.readAsText(f)\n      } else {\n        rej()\n      }\n    }\n    input.oncancel = e => rej()\n    input.click()\n  })\n}","import { neverHappen, assert, entryList } from \"../Common/utils\"\n\nexport type WithId = {\n  id: number\n}\n\nexport type TimedPosition = {\n  /**\n   * id of timepoint to measure time in gamemap\n   */\n  timepoint: number\n\n  /**\n   * the count of 1/48 beats from that timepoint\n   */\n  offset: number\n\n  /**\n   * the lane that the note lays on (left most: 0, right most: 6)\n   */\n  lane: number\n\n  /**\n   * the cached real time\n   * won't be update if timepoint changed\n   */\n  realtimecache: number\n} & WithId\n\nexport type SingleNote = {\n  type: \"single\"\n} & TimedPosition\n\nexport type FlickNote = {\n  type: \"flick\"\n} & TimedPosition\n\nexport type Slide = {\n  /**\n   * note id from first to last ordered\n   */\n  notes: number[]\n  flickend: boolean\n} & WithId\n\nexport type SlideNote = {\n  type: \"slide\"\n  /**\n   * slide id\n   */\n  slide: number\n} & TimedPosition\n\nexport type NoteType = SingleNote | FlickNote | SlideNote\n\nexport type Timepoint = {\n  /**\n   * the start time of this timepoint in seconds\n   */\n  time: number\n\n  /**\n   * beats per minute\n   */\n  bpm: number\n\n  /**\n   * the cached time of 1/48 beat\n   */\n  ticktimecache: number\n\n  /**\n   * beats per bar (assumes one beat = 1/4)\n   */\n  bpb: number\n} & WithId\n\ntype EditMapForJson = {\n  timepoints: Timepoint[]\n  slides: Slide[]\n  notes: NoteType[]\n}\n\n\nexport class EditMap {\n  /**\n   * id => timepoint\n   */\n  timepoints: Map<number, Timepoint>\n\n  /**\n   * id => slide\n   */\n  slides: Map<number, Slide>\n\n  /**\n   * id => note\n   */\n  notes: Map<number, NoteType>\n\n  private constructor(map: EditMap) {\n    this.timepoints = map.timepoints\n    this.slides = map.slides\n    this.notes = map.notes\n  }\n\n  static create(): EditMap {\n    return new EditMap({\n      timepoints: new Map(),\n      slides: new Map(),\n      notes: new Map(),\n    })\n  }\n\n  static toJsonString(map: DeepReadonly<EditMap>) {\n    const { timepoints, slides, notes } = map as EditMap\n    const forJson: EditMapForJson = {\n      timepoints: entryList(timepoints).map(x => ({ ...x[1] })),\n      slides: entryList(slides).map(x => ({ ...x[1] })),\n      notes: entryList(notes).map(x => ({ ...x[1] }))\n    }\n    forJson.timepoints.forEach(x => delete x.ticktimecache)\n    forJson.notes.forEach(x => delete x.realtimecache)\n    return JSON.stringify(forJson)\n  }\n\n  static fromJson(json: string): EditMap {\n    const { timepoints, slides, notes } = JSON.parse(json) as EditMapForJson\n    const map: EditMap = {\n      timepoints: new Map(timepoints.map(x => [x.id, x])),\n      slides: new Map(slides.map(x => [x.id, x])),\n      notes: new Map(notes.map(x => [x.id, x])),\n    }\n    if (slides.some(x => x.notes.some(n => !map.notes.has(n)))) neverHappen()\n    if (notes.some(x => x.type === \"slide\" && !map.slides.has(x.slide))) neverHappen()\n    if (notes.some(x => !map.timepoints.has(x.timepoint))) neverHappen()\n    timepoints.forEach(x => FreshTimepointCache(x))\n    notes.forEach(x => FreshNoteCache(map, x))\n    return new EditMap(map)\n  }\n}\n\nexport function FreshTimepointCache(tp: Timepoint) {\n  tp.ticktimecache = 60 / tp.bpm / 48\n}\n\nexport function FreshNoteCache(map: EditMap, n: TimedPosition) {\n  const tp = assert(map.timepoints.get(n.timepoint))\n  n.realtimecache = tp.time + tp.ticktimecache * n.offset\n}\n\nexport function ResortSlide(map: EditMap, slide: Slide) {\n  let hasEqual = false\n  const sorted = slide.notes.sort((a, b) => {\n    const res = assert(map.notes.get(a)).realtimecache - assert(map.notes.get(b)).realtimecache\n    if (res === 0) hasEqual = true\n    return res\n  })\n  slide.notes = sorted\n  return hasEqual\n}\n","\nexport type Immutable = (number | string | boolean | null | undefined | bigint | symbol)\n\ntype Extra = {\n  [key: string]: Immutable\n}\n\nexport type ImmutableArgs = (Immutable | Extra)[]\n\nexport type AtomAction<TState, TArgs extends ImmutableArgs> =\n  (state: TState, ...args: TArgs) => undefined | ((state: TState) => void)\n\nexport const makeAction = <TState, TArgs extends ImmutableArgs>(fn: AtomAction<TState, TArgs>) => fn","import { EditMap, SingleNote, FlickNote, FreshNoteCache } from \"../../EditMap\"\nimport { makeAction } from \"./types\"\nimport { neverHappen, shallowPatch, assert } from \"../../../Common/utils\"\n\ntype SingleOrFlick = (SingleNote | FlickNote)\n\nconst add = (map: EditMap, id: number, type: SingleOrFlick[\"type\"], timepoint: number, offset: number, lane: number) => {\n  const note =\n    { type: type as \"single\", id, timepoint, offset, lane, realtimecache: 0 } as SingleOrFlick\n\n  map.notes.set(note.id, note)\n\n  FreshNoteCache(map, note)\n  return note\n}\n\nconst del = (map: EditMap, id: number) => {\n  const note = assert(map.notes.get(id))\n  if (note.type !== \"single\" && note.type !== \"flick\") neverHappen()\n  \n  map.notes.delete(id)\n\n  return note\n}\n\ntype PatchType = Partial<Pick<SingleOrFlick, \"type\" | \"timepoint\" | \"offset\" | \"lane\">>\n\nconst setv = (map: EditMap, id: number, patch: PatchType) => {\n  const note = assert(map.notes.get(id))\n  if (note.type !== \"single\" && note.type !== \"flick\") neverHappen()\n  const changes = shallowPatch(note, patch)\n  if (changes) {\n\n    FreshNoteCache(map, note)\n    return changes\n  }\n}\n\nexport const SingleFlickActions = {\n  Add: makeAction((map: EditMap, id: number, type: SingleOrFlick[\"type\"], timepoint: number, offset: number, lane: number) => {\n    const res = add(map, id, type, timepoint, offset, lane)\n    if (res)\n      return (map: EditMap) => del(map, res.id)\n  }),\n  Remove: makeAction((map: EditMap, id: number) => {\n    const res = del(map, id)\n    if (res)\n      return (map: EditMap) => add(map, res.id, res.type as SingleOrFlick[\"type\"], res.timepoint, res.offset, res.lane)\n  }),\n  Set: makeAction((map: EditMap, id: number, patch: PatchType) => {\n    const res = setv(map, id, patch)\n    if (res)\n      return (map: EditMap) => setv(map, id, res)\n  })\n}\n","import { EditMap, Slide } from \"../../EditMap\"\nimport { assert, neverHappen, shallowPatch } from \"../../../Common/utils\"\nimport { makeAction } from \"./types\"\n\n\nconst add = (map: EditMap, id: number, flickend: boolean) => {\n  const slide: Slide = {\n    id, flickend, notes: []\n  }\n  map.slides.set(id, slide)\n\n  return slide\n}\n\nconst del = (map: EditMap, id: number) => {\n  const s = assert(map.slides.get(id))\n  if (s.notes.length > 0) neverHappen()\n\n  map.slides.delete(id)\n\n  return s\n}\n\ntype PatchType = Partial<Pick<Slide, \"flickend\">>\n\nconst set = (map: EditMap, id: number, patch: PatchType) => {\n  const s = assert(map.slides.get(id))\n  const changes = shallowPatch(s, patch)\n  if (changes) {\n\n    return changes\n  }\n}\n\nexport const SlideActions = {\n  Add: makeAction((map: EditMap, id: number, flickend: boolean) => {\n    const res = add(map, id, flickend)\n    if (res)\n      return (map: EditMap) => del(map, res.id)\n  }),\n  Remove: makeAction((map: EditMap, id: number) => {\n    const res = del(map, id)\n    if (res)\n      return (map: EditMap) => add(map, res.id, res.flickend)\n  }),\n  Set: makeAction((map: EditMap, id: number, patch: PatchType) => {\n    const res = set(map, id, patch)\n    if (res)\n      return (map: EditMap) => set(map, id, res)\n  })\n}\n","import { EditMap, SlideNote, FreshNoteCache, ResortSlide } from \"../../EditMap\"\nimport { assert, neverHappen, shallowPatch } from \"../../../Common/utils\"\nimport { makeAction } from \"./types\"\n\n\nconst add = (map: EditMap, id: number, slide: number, timepoint: number, offset: number, lane: number) => {\n  const note: SlideNote = {\n    type: \"slide\",\n    id, slide, timepoint, offset, lane,\n    realtimecache: 0\n  }\n\n  const s = assert(map.slides.get(slide))\n  s.notes.push(id)\n  map.notes.set(id, note)\n\n  FreshNoteCache(map, note)\n  ResortSlide(map, s)\n\n  return note\n}\n\nconst del = (map: EditMap, id: number) => {\n  const note = assert(map.notes.get(id))\n  if (note.type !== \"slide\") neverHappen()\n\n  const s = assert(map.slides.get(note.slide))\n  s.notes = s.notes.filter(x => x !== note.id)\n  map.notes.delete(id)\n  \n  ResortSlide(map, s)\n\n  return note\n}\n\ntype PatchType = Partial<Pick<SlideNote, \"timepoint\" | \"offset\" | \"lane\">>\n\nconst setv = (map: EditMap, id: number, patch: PatchType) => {\n  const note = assert(map.notes.get(id))\n  if (note.type !== \"slide\") neverHappen()\n  const changes = shallowPatch(note, patch)\n  if (changes) {\n\n    FreshNoteCache(map, note)\n\n    const s = assert(map.slides.get(note.slide))\n    ResortSlide(map, s)\n\n    return changes\n  }\n}\n\nexport const SlideNoteActions = {\n  Add: makeAction((map: EditMap, id: number, slide: number, timepoint: number, offset: number, lane: number) => {\n    const res = add(map, id, slide, timepoint, offset, lane)\n    if (res)\n      return (map: EditMap) => del(map, res.id)\n  }),\n  Remove: makeAction((map: EditMap, id: number) => {\n    const res = del(map, id)\n    if (res)\n      return (map: EditMap) => add(map, res.id, res.slide, res.timepoint, res.offset, res.lane)\n  }),\n  Set: makeAction((map: EditMap, id: number, patch: PatchType) => {\n    const res = setv(map, id, patch)\n    if (res)\n      return (map: EditMap) => setv(map, id, res)\n  })\n}\n","import { EditMap, Timepoint, FreshTimepointCache } from \"../../EditMap\"\nimport { assert, shallowPatch } from \"../../../Common/utils\"\nimport { makeAction } from \"./types\"\n\nconst add = (map: EditMap, id: number, time: number, bpm: number, bpb: number) => {\n  const newtp: Timepoint =\n    { id, time, bpm, bpb, ticktimecache: 0 }\n\n  map.timepoints.set(newtp.id, newtp)\n\n  FreshTimepointCache(newtp)\n  return newtp\n}\n\nconst del = (map: EditMap, id: number) => {\n  const tp = assert(map.timepoints.get(id))\n  map.timepoints.delete(id)\n\n  return tp\n}\n\ntype PatchType = Partial<Pick<Timepoint, \"time\" | \"bpm\" | \"bpb\">>\n\nconst setv = (map: EditMap, id: number, patch: PatchType) => {\n  const tp = assert(map.timepoints.get(id))\n  const changes = shallowPatch(tp, patch)\n  if (changes) {\n\n    FreshTimepointCache(tp)\n    return changes\n  }\n}\n\nexport const TimepointActions = {\n  Add: makeAction((map: EditMap, id: number, time: number, bpm: number, bpb: number) => {\n    const res = add(map, id, time, bpm, bpb)\n    if (res)\n      return (map: EditMap) => del(map, res.id)\n  }),\n  Remove: makeAction((map: EditMap, id: number) => {\n    const res = del(map, id)\n    if (res)\n      return (map: EditMap) => add(map, res.id, res.time, res.bpm, res.bpb)\n  }),\n  Set: makeAction((map: EditMap, id: number, patch: PatchType) => {\n    const res = setv(map, id, patch)\n    if (res)\n      return (map: EditMap) => setv(map, id, res)\n  })\n}\n","import { ImmutableArgs, AtomAction } from \"./AtomActions/types\"\nimport { neverHappen } from \"../../Common/utils\"\n\ntype WithArgsAction<TState> =\n  (state: TState) => undefined | ((state: TState) => void)\n\nexport class AtomHistory<TState> {\n  constructor(private state: TState) { }\n\n  private act_done: WithArgsAction<TState>[] = []\n  private act_todo: WithArgsAction<TState>[] = []\n  private act_undo: ((state: TState) => void)[] = []\n\n  get canRedo() { return this.act_todo.length > 0 }\n  get canUndo() { return this.act_undo.length > 0 }\n\n  callAtom<TArgs extends ImmutableArgs>(fn: AtomAction<TState, TArgs>, ...args: TArgs) {\n    const act = (state: TState) => fn(state, ...args)\n    const res = act(this.state)\n    if (res) {\n      this.act_todo.length = 0\n      this.act_done.push(act)\n      this.act_undo.push(res)\n      return true\n    }\n    return false\n  }\n\n  undoAtom() {\n    const un = this.act_undo.pop()\n    const act = this.act_done.pop()\n    if (!un || !act) {\n      if (!un && !act) return false\n      neverHappen(\"Undo list and done list length not equal\")\n    }\n    un(this.state)\n    this.act_todo.push(act)\n    return true\n  }\n\n  redoAtom() {\n    const act = this.act_todo.pop()\n    if (!act) return false\n    const res = act(this.state)\n    if (res) {\n      this.act_done.push(act)\n      this.act_undo.push(res)\n      return true\n    }\n    neverHappen(\"Can not redo an action.\")\n  }\n\n  doTransaction(fn: () => boolean) {\n    const startLen = this.act_done.length\n    const res = fn()\n    if (res) {\n      return this.act_done.length - startLen\n    }\n    while (this.act_done.length > startLen) this.undoAtom()\n    return 0\n  }\n\n  doParallel(fn: () => any) {\n    const startLen = this.act_done.length\n    fn()\n    const done = this.act_done.length - startLen\n    return done\n  }\n}\n","import { NoteType, SingleNote, FlickNote, FreshNoteCache } from \"../EditMap\"\nimport { SingleFlickActions } from \"./AtomActions/SingleFlick\"\nimport { randomId, assert, neverHappen } from \"../../Common/utils\"\nimport { SlideActions } from \"./AtomActions/Slide\"\nimport { SlideNoteActions } from \"./AtomActions/SlideNote\"\nimport { TimepointActions } from \"./AtomActions/Timepoint\"\nimport { MapActionsBase } from \"./MapAtionsBase\"\n\n\nexport class MapActions extends MapActionsBase {\n\n  addTimepoint(time: number, bpm: number, bpb: number, justifydivision: number) {\n    return this.done(this.history.doParallel(() => {\n      if (this.history.callAtom(TimepointActions.Add, randomId(), time, bpm, bpb)) {\n        this.justifyFindNearest(this.notelist, justifydivision)\n      }\n    }))\n  }\n\n  moveTimepoint(timepoint: number, justifyFindNearest: boolean, justifydivision: number, time?: number, bpm?: number, bpb?: number) {\n    const tp = assert(this.state.timepoints.get(timepoint))\n    const timechanged =\n      (time !== undefined && tp.time !== time) ||\n      (bpm !== undefined && tp.bpm !== bpm)\n    return this.done(this.history.doParallel(() => {\n      if (this.history.callAtom(TimepointActions.Set, timepoint, { time, bpm, bpb })) {\n        if (timechanged)\n          if (justifyFindNearest) {\n            this.justifyFindNearest(this.notelist, justifydivision)\n          } else {\n            this.justifyFollowChanged(this.notelist, justifydivision)\n          }\n      }\n    }))\n  }\n\n  removeTimepoint(timepoint: number, justifydivision: number) {\n    if (this.state.timepoints.size > 1) {\n      return this.done(this.history.doParallel(() => {\n        if (this.history.callAtom(TimepointActions.Remove, timepoint)) {\n          this.justifyFindNearest(this.notelist, justifydivision)\n        }\n      }))\n    } else {\n      return this.done(this.history.doParallel(() => {\n        this.deleteMany(this.notelist)\n        this.history.callAtom(TimepointActions.Remove, timepoint)\n        if (this.state.slides.size ||\n          this.state.notes.size ||\n          this.state.timepoints.size) neverHappen()\n      }))\n    }\n  }\n\n  addSingle(timepoint: number, offset: number, lane: number) {\n    return this.done(this.history.doTransaction(() =>\n      this.history.callAtom(SingleFlickActions.Add, randomId(), \"single\", timepoint, offset, lane)))\n  }\n\n  toggleFlick(note: SingleNote | FlickNote) {\n    return this.done(this.history.doTransaction(() =>\n      this.history.callAtom(SingleFlickActions.Set, note.id, {\n        type: note.type === \"single\" ? \"flick\" : \"single\"\n      })))\n  }\n\n  addSlide(tp1: number, off1: number, lane1: number, tp2: number, off2: number, lane2: number) {\n    const sid = randomId()\n    return this.done(this.history.doTransaction(() =>\n      this.history.callAtom(SlideActions.Add, sid, false) &&\n      this.history.callAtom(SlideNoteActions.Add, randomId(), sid, tp1, off1, lane1) &&\n      this.history.callAtom(SlideNoteActions.Add, randomId(), sid, tp2, off2, lane2)))\n  }\n\n  toggleFlickend(slide: number) {\n    const s = assert(this.state.slides.get(slide))\n    return this.done(this.history.doTransaction(() =>\n      this.history.callAtom(SlideActions.Set, slide, { flickend: !s.flickend })))\n  }\n\n  addSlideMid(slide: number, timepoint: number, offset: number, lane: number) {\n    return this.done(this.history.doTransaction(() =>\n      this.history.callAtom(SlideNoteActions.Add, randomId(), slide, timepoint, offset, lane)))\n  }\n\n  moveMany(notes: NoteType[], timeoffset: number, min: number, max: number, laneoffset: number, division: number) {\n    return this.done(this.history.doTransaction(() => {\n      for (const n of notes) {\n        const targetTime = n.realtimecache + timeoffset\n        const targetLane = n.lane + laneoffset\n        if (targetTime > max || targetTime < min || targetLane < 0 || targetLane > 6) {\n          for (const n of notes) FreshNoteCache(this.state, n)\n          return false\n        }\n        this.patchNote(n, { lane: targetLane })\n        n.realtimecache = targetTime\n      }\n      this.justifyFindNearest(notes, division)\n      return true\n    }))\n  }\n\n  copyMany(notes: NoteType[], timeoffset: number, min: number, max: number, laneoffset: number, division: number) {\n    return this.done(this.history.doTransaction(() => {\n      const slideidmap: { [key: number]: number } = {}\n      const slideNoteCount: { [key: number]: number } = {}\n      for (const n of notes) {\n        if (n.type === \"slide\")\n          slideNoteCount[n.slide] = (slideNoteCount[n.slide] && slideNoteCount[n.slide] + 1) || 1\n      }\n      for (const slide in slideNoteCount) {\n        const slideid = parseInt(slide)\n        if (slideNoteCount[slideid] >= 2) {\n          const id = randomId()\n          this.history.callAtom(SlideActions.Add, id,\n            assert(this.state.slides.get(slideid)).flickend)\n          slideidmap[slideid] = id\n        }\n      }\n\n      for (const n of notes) {\n        const targetTime = n.realtimecache + timeoffset\n        const targetLane = n.lane + laneoffset\n        if (targetTime > max || targetTime < min || targetLane < 0 || targetLane > 6) {\n          return false\n        }\n        const res = assert(this.calcNearestPosition(targetTime, division))\n        if (n.type === \"slide\") {\n          const slide = slideidmap[n.slide]\n          if (!slide) continue\n          const done = this.history.callAtom(SlideNoteActions.Add, randomId(), slide, res.timepoint.id, res.offset, targetLane)\n          if (!done) return false\n        } else {\n          const done = this.history.callAtom(SingleFlickActions.Add, randomId(), n.type, res.timepoint.id, res.offset, targetLane)\n          if (!done) return false\n        }\n      }\n      return true\n    }))\n  }\n\n  removeNotes(notes: NoteType[]) {\n    return this.done(this.history.doParallel(() => {\n      this.deleteMany(notes)\n    }))\n  }\n\n}\n","import { CommonActions } from \"./CommonActions\"\nimport { EditMap, NoteType, Slide, Timepoint, FreshNoteCache, SlideNote } from \"../EditMap\"\nimport { SingleFlickActions } from \"./AtomActions/SingleFlick\"\nimport { assert, entryList } from \"../../Common/utils\"\nimport { SlideNoteActions } from \"./AtomActions/SlideNote\"\nimport { SlideActions } from \"./AtomActions/Slide\"\n\n\nexport class MapActionsBase extends CommonActions<EditMap> {\n\n  constructor(map: EditMap) {\n    super(map)\n\n    this.changeListeners.add(() => {\n      this._timepoints = null\n      this._slides = null\n      this._notes = null\n    })\n  }\n\n  // refresh when add, remove, set\n  protected _timepoints: Timepoint[] | null = null\n  // refresh when add, remove\n  protected _slides: Slide[] | null = null\n  // refresh when add, remove\n  protected _notes: NoteType[] | null = null\n\n  get timepoints() { return this.state.timepoints as ReadonlyMap<number, Timepoint> }\n  get slides() { return this.state.slides as ReadonlyMap<number, Slide> }\n  get notes() { return this.state.notes as ReadonlyMap<number, NoteType> }\n\n  get timepointlist() {\n    if (!this._timepoints) {\n      this._timepoints = entryList(this.state.timepoints).map(x => x[1]).sort((a, b) => (a.time - b.time) || (a.id - b.id))\n    }\n    return this._timepoints\n  }\n  get slidelist() {\n    if (!this._slides) {\n      this._slides = entryList(this.state.slides).map(x => x[1])\n    }\n    return this._slides\n  }\n  get notelist() {\n    if (!this._notes) {\n      this._notes = entryList(this.state.notes).map(x => x[1])\n    }\n    return this._notes\n  }\n\n  findTimepoint(time: number): [Timepoint | undefined, number] {\n    const tps = this.timepointlist\n    if (tps.length <= 0) return [undefined, -1]\n    let tpindex = 0\n    while (tpindex < tps.length && time >= tps[tpindex].time) tpindex++\n    if (tpindex > 0) tpindex--\n    return [tps[tpindex], tpindex]\n  }\n\n  /**\n   * calculate the nearest timepoint position  \n   * divisions of one quarter beat  \n   * @param time     - the time to calculate\n   * @param division - the division \n   */\n  calcNearestPosition(time: number, division: number) {\n    const tickcount = 48 / division\n    const [tp, tpindex] = this.findTimepoint(time)\n    if (!tp) return\n    const offset = Math.round((time - tp.time) / (tp.ticktimecache * tickcount)) * tickcount\n    const realtime = tp.time + tp.ticktimecache * offset\n    const [rtp, rtpindex] = this.findTimepoint(realtime + tp.ticktimecache) // when its very near to next tp, switch to next\n    if (rtp && rtp.id !== tp.id) return {\n      timepoint: rtp,\n      /** count of 1/48 quarter beat */\n      offset: 0, timepointIndex: rtpindex, realtime: rtp.time\n    }\n    return {\n      timepoint: tp,\n      /** count of 1/48 quarter beat */\n      offset, timepointIndex: tpindex, realtime\n    }\n  }\n\n  protected patchNote(note: NoteType, patch: { timepoint?: number, offset?: number, lane?: number }) {\n    if (note.type === \"slide\") {\n      return this.history.callAtom(SlideNoteActions.Set, note.id, patch)\n    }\n    return this.history.callAtom(SingleFlickActions.Set, note.id, patch)\n  }\n\n  /**\n   * try to keep the note's timepoint and offset  \n   * refresh note cache first  \n   * if the note still in its timepoint, no change  \n   * else find the proper position for it by division  \n   */\n  protected justifyFollowChanged(notes: NoteType[], division: number) {\n    for (const n of notes) {\n      FreshNoteCache(this.state, n)\n      const res = assert(this.calcNearestPosition(n.realtimecache, division))\n      if (res.timepoint.id !== n.timepoint || res.offset !== n.offset) {\n        this.patchNote(n, { timepoint: res.timepoint.id, offset: res.offset })\n      }\n    }\n  }\n\n  /**\n   * keep realtime cache  \n   * if note still in unchanged timepoint, no change  \n   * else find the proper position for it by division  \n   */\n  protected justifyFindNearest(notes: NoteType[], division: number) {\n    for (const n of notes) {\n      const res = assert(this.calcNearestPosition(n.realtimecache, division))\n      if (res.timepoint.id !== n.timepoint || res.offset !== n.offset) {\n        this.patchNote(n, { timepoint: res.timepoint.id, offset: res.offset })\n      }\n    }\n  }\n\n  protected deleteSlideNote(note: SlideNote) {\n    if (!this.state.notes.has(note.id)) return false\n    const s = assert(this.state.slides.get(note.slide))\n    if (s.notes.length > 2) {\n      return this.history.callAtom(SlideNoteActions.Remove, note.id)\n    } else {\n      const n1 = s.notes[0], n2 = s.notes[1]\n      return this.history.doTransaction(() =>\n        this.history.callAtom(SlideNoteActions.Remove, n1) &&\n        this.history.callAtom(SlideNoteActions.Remove, n2) &&\n        this.history.callAtom(SlideActions.Remove, s.id)\n      ) > 0\n    }\n  }\n\n  protected deleteOne(note: NoteType) {\n    if (!this.notes.has(note.id)) return false\n    if (note.type === \"slide\") {\n      return this.deleteSlideNote(note)\n    }\n    return this.history.callAtom(SingleFlickActions.Remove, note.id)\n  }\n\n  protected deleteMany(notes: NoteType[]) {\n    for (const n of notes) {\n      this.deleteOne(n)\n    }\n  }\n}\n","import { AtomHistory } from \"./AtomHistory\"\n\nexport class CommonActions<T> {\n  protected history: AtomHistory<T>\n\n  private act_done: number[] = []\n  private act_todo: number[] = []\n\n  get canUndo() { return this.act_done.length > 0 }\n  get canRedo() { return this.act_todo.length > 0 }\n\n  constructor(protected state: T) {\n    this.history = new AtomHistory(state)\n  }\n\n  readonly changeListeners = new Set<() => void>()\n\n  private changed() {\n    for (const listener of this.changeListeners) {\n      listener()\n    }\n  }\n\n  ResetState = (state: T) => {\n    this.state = state\n    this.history = new AtomHistory(state)\n    this.act_done = []\n    this.act_todo = []\n    this.changed()\n  }\n\n  protected done(step: number) {\n    if (step > 0) {\n      this.act_todo.length = 0\n      this.act_done.push(step)\n      this.changed()\n      return true\n    }\n    return false\n  }\n\n  Undo = () => {\n    const step = this.act_done.pop()\n    if (step === undefined) return\n    this.act_todo.push(step)\n\n    for (let i = 0; i < step; i++)\n      this.history.undoAtom()\n\n    this.changed()\n  }\n\n  Redo = () => {\n    const step = this.act_todo.pop()\n    if (step === undefined) return\n    this.act_done.push(step)\n\n    for (let i = 0; i < step; i++)\n      this.history.redoAtom()\n\n    this.changed()\n  }\n\n}","\n\nexport type Meta = {\n  name: string\n}\n\nexport const DefaultMeta: Meta = {\n  name: \"\"\n}\n","\n\nexport type Settings = {\n\n  general: {\n\n    song_volume: number\n    effect_volume: number\n\n    background_dim: number\n\n  }\n\n  editor: {\n\n    autosave_interval: number\n    // global\n\n    keep_pitch: boolean\n\n    // timing\n\n    justify_find_nearest: boolean\n    /** 1 | 2 | 3 | 4 | 6 | 8 | 16 | 48 */\n    justify_grid_divisor: number\n\n    show_info_window: boolean\n\n    warn_for_same_pos_notes: boolean\n  }\n\n  game: {\n    judge_offset: number\n    visual_offset: number\n    speed: number\n    resolution: number\n    note_scale: number\n    bar_opaciry: number\n    show_sim_line: boolean\n    lane_effect: boolean\n    mirror: boolean\n    beat_note: boolean\n  }\n}\n\nexport const DefaultSettings: Settings = {\n  general: { song_volume: 1, effect_volume: 1, background_dim: 0.7 },\n  editor: {\n    keep_pitch: false, justify_find_nearest: true, justify_grid_divisor: 48, show_info_window: true,\n    warn_for_same_pos_notes: true, autosave_interval: 5,\n  },\n  game: {\n    judge_offset: 0, visual_offset: 0, speed: 10, resolution: 1.25, note_scale: 1, bar_opaciry: 0.9,\n    show_sim_line: true, lane_effect: true, mirror: false, beat_note: true,\n  }\n}","import { MapActions } from \"./MapActions/MapActions\"\nimport { EditMap } from \"./EditMap\"\nimport { observable, autorun } from \"mobx\"\nimport { Meta, DefaultMeta } from \"./Meta\"\nimport { Settings, DefaultSettings } from \"./Settings\"\nimport { deepPatch } from \"../Common/utils\"\n\n\nconst StorageNames = {\n  meta: \"editor:meta\",\n  mapcontent: \"editor:mapcontent\",\n  settings: \"editor:settings\"\n}\n\nclass Scope {\n  constructor() {\n    const map = localStorage.getItem(StorageNames.mapcontent)\n    let editmap: EditMap | null = null\n    if (map) {\n      try {\n        editmap = EditMap.fromJson(map)\n      } catch (error) {\n        localStorage.removeItem(StorageNames.mapcontent)\n        console.error(error)\n      }\n    }\n    if (!editmap) {\n      editmap = EditMap.create()\n    }\n    this.map = new MapActions(editmap)\n\n    const meta = localStorage.getItem(StorageNames.meta)\n    this.meta = observable(DefaultMeta)\n    if (meta) deepPatch(this.meta, JSON.parse(meta))\n\n    autorun(() => {\n      const json = JSON.stringify(this.meta)\n      localStorage.setItem(StorageNames.meta, json)\n    })\n\n    const settings = localStorage.getItem(StorageNames.settings)\n    this.settings = observable(DefaultSettings)\n    if (settings) deepPatch(this.settings, JSON.parse(settings))\n\n    autorun(() => {\n      const json = JSON.stringify(this.settings)\n      localStorage.setItem(StorageNames.settings, json)\n    })\n\n\n    this.map.changeListeners.add(() => {\n      if (this.settings.editor.autosave_interval > 0)\n        setTimeout(() => {\n          const now = new Date().getTime()\n          const timeout = this.settings.editor.autosave_interval * 60 * 1000\n          if (!this.lastSave || now - this.lastSave.getTime() > timeout)\n            this.save()\n        }, this.settings.editor.autosave_interval * 60 * 1000 - 1000)\n    })\n  }\n\n  map: MapActions\n\n  @observable lastSave: Date | null = null\n\n  save = () => {\n    const json = EditMap.toJsonString((this.map as any).state)\n    localStorage.setItem(StorageNames.mapcontent, json)\n    this.lastSave = new Date()\n  }\n\n  @observable update = false\n\n  reset = (map?: EditMap) => {\n    this.map.ResetState(map || EditMap.create())\n  }\n\n  @observable meta: Meta\n  @observable settings: Settings\n}\n\n\nexport const scope = new Scope()\n","\nclass AudioCtx {\n  constructor() {\n    this._ctx = new AudioContext()\n    this._output = this._ctx.createGain()\n    this._output.connect(this._ctx.destination)\n  }\n  private _ctx: AudioContext\n  private _output: GainNode\n\n  get ctx() { return this._ctx }\n  get now() { return this._ctx.currentTime }\n  get latency() { return this._ctx.baseLatency + this._ctx.outputLatency }\n  get mastervolume() { return this._output.gain }\n  get destination() { return this._output }\n}\n\nwindow.AudioContext = window.AudioContext || (window as any).webkitAudioContext\n\nconst globalctx = AudioContext && new AudioCtx()\nexport default globalctx","\nexport type Listener<TArgs extends any[]> = (remove: () => boolean, ...args: TArgs) => unknown\n\nexport default class MyEvent<TArgs extends any[] = []> {\n  private listeners = new Set<Listener<TArgs>>()\n\n  add = (listener: Listener<TArgs>) => {\n    this.listeners.add(listener)\n    return () => this.listeners.delete(listener)\n  }\n\n  dispatch = (...args: TArgs) => {\n    const listeners: Listener<TArgs>[] = []\n    for (const l of this.listeners) listeners.push(l)\n    listeners.forEach(l => l(() => this.listeners.delete(l), ...args))\n  }\n\n  dispose = () => this.listeners.clear()\n}\n","import globalctx from \"./GlobalCtx\"\nimport MyEvent from \"./MyEvent\"\n\ntype Source = ArrayBuffer | Blob | Promise<ArrayBuffer | Blob>\n\nexport default class AudioSource {\n  private constructor() {\n    this.gain = globalctx.ctx.createGain()\n    this.gain.connect(globalctx.destination)\n  }\n  private gain: GainNode\n  get destination() { return this.gain }\n  get volume() { return Math.sqrt(this.gain.gain.value) }\n  set volume(v) { this.gain.gain.value = v * v }\n\n  buffer?: AudioBuffer\n  get loaded() { return !!this.buffer }\n\n  onload = new MyEvent()\n  onloaderr = new MyEvent<[any]>()\n\n  get duration() {\n    if (this.buffer) {\n      return this.buffer.duration\n    }\n    return 0\n  }\n\n  static from(getsource: (() => Source) | Source) {\n    const s = new AudioSource()\n\n    const onerror = (err: any) => s.onloaderr.dispatch(err)\n\n    const load = (data: ArrayBuffer | Blob) => {\n      if (data instanceof Blob) {\n        const reader = new FileReader()\n        reader.onabort = onerror\n        reader.onerror = onerror\n        reader.onload = e => {\n          if (reader.result instanceof ArrayBuffer) {\n            load(reader.result)\n          } else {\n            onerror(e)\n          }\n        }\n        reader.readAsArrayBuffer(data)\n      } else {\n        globalctx.ctx.decodeAudioData(data, buffer => {\n          s.buffer = buffer\n          s.onload.dispatch()\n        }, onerror)\n      }\n    }\n    s.load = () => {\n      const src = getsource instanceof Function\n        ? getsource() : getsource\n      if (src instanceof Promise) {\n        src.then(load).catch(onerror)\n      } else {\n        load(src)\n      }\n      return s\n    }\n    return s\n  }\n\n  load = () => this\n}\n","import AudioSource from \"./AudioSource\"\nimport globalctx from \"./GlobalCtx\"\nimport MyEvent from \"./MyEvent\"\n\nexport default class AudioInstance {\n  constructor(source: AudioSource) {\n    this.source = source\n    this.gain = globalctx.ctx.createGain()\n    this.gain.connect(source.destination)\n    this.node = this.createnode()\n  }\n  source: AudioSource\n\n  private gain: GainNode\n  get volume() { return Math.sqrt(this.gain.gain.value) }\n  set volume(v) { this.gain.gain.value = v * v }\n\n  private node: AudioBufferSourceNode\n  private createnode() {\n    const n = globalctx.ctx.createBufferSource()\n    n.buffer = this.source.buffer as AudioBuffer\n    n.connect(this.gain)\n    n.playbackRate.value = this._playbackrate\n    return n\n  }\n  private _playing = false\n  /**\n   * when sound is playing, keep it valid to (now - starttime) * playbackrate == position\n   * when not playing, it's not valid at all\n   */\n  private _starttime = 0\n  /**\n   * when sound is playing, it's not valid at all\n   * when not playing, it shows where to start sound\n   */\n  private _startpos = 0\n  private _playbackrate = 1\n\n  onplay = new MyEvent()\n  onpause = new MyEvent()\n  onseek = new MyEvent()\n  onend = new MyEvent()\n\n  get position() {\n    if (!this._playing) return this._startpos\n    const now = globalctx.now\n    const playedtime = now - this._starttime\n    // if (this._playbackrate !== 1) return playedtime * this._playbackrate - 0.016\n    return playedtime * this._playbackrate\n  }\n\n  /**\n   * set startpos before calling it\n   */\n  private callstart = (delay: number) => {\n    const startt = globalctx.now + delay\n    this.node.start(startt, this._startpos)\n    const playedtime = this._startpos / this._playbackrate\n    this._starttime = startt - playedtime\n    this._playing = true\n  }\n\n  private handleNormalEnd = () => {\n    this._startpos = 0\n    this._playing = false\n    this.node = this.createnode()\n\n    this.onend.dispatch()\n  }\n\n  private handlePauseEnd = () => {\n    this._startpos = this.position  // get before _playing is set to false\n    this._playing = false\n    this.node = this.createnode()\n\n    this.onpause.dispatch()\n  }\n\n  private handleSeekEnd = () => {\n\n    this.node = this.createnode()\n    this.node.onended = this.handleNormalEnd\n    this.callstart(0)\n\n    this.onseek.dispatch()\n  }\n\n  play(delay = 0) {\n    if (this._playing) return\n\n    this.callstart(delay)\n\n    // normal end\n    this.node.onended = this.handleNormalEnd\n\n    this.onplay.dispatch()\n  }\n\n  stop(delay = 0) {\n    if (!this._playing) {\n      this._startpos = 0\n      return\n    }\n\n    // normal end, maybe we have to override pause end handler\n    this.node.onended = this.handleNormalEnd\n\n    this.node.stop(globalctx.now + delay)\n  }\n\n  pause(delay = 0) {\n    if (!this._playing) return\n\n    // pause caused end\n    this.node.onended = this.handlePauseEnd\n\n    this.node.stop(globalctx.now + delay)\n  }\n\n  seek(position: number) {\n    position = Math.max(0, Math.min(this.source.duration, position))\n    if (!this._playing) {\n      this._startpos = position\n      this.onseek.dispatch()\n      return\n    }\n\n    this._startpos = position\n    const playedtime = this._startpos / this._playbackrate\n    this._starttime = globalctx.now - playedtime\n    // seek caused end\n    this.node.onended = this.handleSeekEnd\n\n    this.node.stop(globalctx.now)\n  }\n\n  get rate() { return this._playbackrate }\n\n  setRate(rate: number) {\n    rate = Math.max(0.25, Math.min(4, rate))\n\n    const currentpos = this.position // get currentpos before set playbackrate\n\n    this._playbackrate = rate\n    this.node.playbackRate.value = this._playbackrate\n\n    if (this._playing) {\n      const now = globalctx.now\n      const playedtime = currentpos / rate\n      this._starttime = now - playedtime\n    }\n  }\n}\n\n","import MyEvent from \"./MyEvent\"\n\nexport default class AudioElInstance {\n  constructor(source: Blob) {\n    this.source = source\n    this.el = document.createElement(\"audio\")\n    this.el.oncanplaythrough = e => {\n      this.el.oncanplaythrough = null\n      this._loaded = true\n      this.onload.dispatch()\n    }\n    this.el.onerror = e => this.onloaderr.dispatch(e)\n      ; (this.el as any).preservesPitch = true\n    this.el.onended = e => {\n      this.onend.dispatch()\n      this.el.currentTime = 0\n    }\n    this.el.src = URL.createObjectURL(source)\n    this.el.load()\n  }\n\n  private _loaded = false\n  get loaded() { return this._loaded }\n  onload = new MyEvent()\n  onloaderr = new MyEvent<[any]>()\n\n  get duration() { return this.el.duration }\n\n  source: Blob\n  private el: HTMLAudioElement\n\n  get volume() { return this.el.volume }\n  set volume(v) { this.el.volume = v }\n\n  onplay = new MyEvent()\n  onpause = new MyEvent()\n  onseek = new MyEvent()\n  onend = new MyEvent()\n\n  get position() {\n    return this.el.currentTime\n  }\n\n  play(delay = 0) {\n    this.el.play()\n    this.onplay.dispatch()\n  }\n\n  stop(delay = 0) {\n    this.el.pause()\n    this.el.currentTime = 0\n    this.onend.dispatch()\n  }\n\n  pause(delay = 0) {\n    this.el.pause()\n    this.onpause.dispatch()\n  }\n\n  seek(position: number) {\n    this.el.currentTime = position\n    this.onseek.dispatch()\n  }\n\n  get rate() { return this.el.playbackRate }\n\n  setRate(rate: number) {\n    rate = Math.max(0.25, Math.min(4, rate))\n    this.el.playbackRate = rate\n  }\n}\n\n","import globalctx from \"./GlobalCtx\"\nimport MyEvent from \"./MyEvent\"\nimport AudioSource from \"./AudioSource\"\nimport AudioInstance from \"./AudioInstance\"\nimport AudioElInstance from \"./AudioElInstance\"\n\nexport default globalctx\nexport { MyEvent, AudioSource, AudioInstance, AudioElInstance }\n\nexport async function loadFromUrl(url: string) {\n  const res = await fetch(url)\n  const buffer = await res.arrayBuffer()\n  return buffer\n}\n\n","import { useState, useEffect } from \"react\"\nimport { scope } from \"../MappingScope/scope\"\nimport { observable, autorun } from \"mobx\"\nimport { AudioInstance, AudioSource, AudioElInstance } from \"../Common/AudioCtx\"\n\nexport function useMapChange() {\n  const [i, setI] = useState(1)\n\n  useEffect(() => {\n    const listener = () => setI(i => i + 1)\n    scope.map.changeListeners.add(listener)\n    return () => { scope.map.changeListeners.delete(listener) }\n  }, [])\n\n  return i\n}\n\nclass BackgroundState {\n  @observable src = \"\"\n}\n\nexport const Background = new BackgroundState()\n\nclass MusicState {\n\n  constructor() {\n    autorun(() => {\n      if (this.audio) {\n        this.audio.setRate(this.playbackrate)\n        this.audio.volume = scope.settings.general.song_volume\n      }\n    })\n  }\n\n  @observable private audio = null as null | AudioInstance | AudioElInstance\n  get loaded() { return this.audio !== null }\n  @observable duration = 5\n  @observable playing = false\n  @observable playbackrate = 1\n  @observable private seekcounter = 1\n\n  musicfile: null | File = null\n\n  load = (file: File, onerror: () => void, onload: () => void) => {\n    const m = this\n    if (m.audio !== null) {\n      m.audio.stop()\n    }\n    m.audio = null\n    m.duration = 5\n    m.playing = false\n    m.seekcounter = 1\n    m.musicfile = null\n\n    if (scope.settings.editor.keep_pitch) {\n      const instance = new AudioElInstance(file)\n\n      instance.onload.add(() => {\n        this.musicfile = file\n        m.duration = instance.duration\n        instance.setRate(this.playbackrate)\n        onload()\n\n        this.audio = instance\n        this.audio.onend.add(() => {\n          this.playing = false\n        })\n      })\n\n      instance.onloaderr.add(err => {\n        console.error(err)\n        onerror()\n      })\n      return\n    }\n\n    const source = AudioSource.from(file)\n\n    source.onload.add(() => {\n      this.musicfile = file\n      m.duration = source.duration\n      onload()\n\n      this.audio = new AudioInstance(source)\n      this.audio.setRate(this.playbackrate)\n      this.audio.onend.add(() => {\n        this.playing = false\n      })\n    })\n\n    source.onloaderr.add(err => {\n      console.error(err)\n      onerror()\n    })\n\n    source.load()\n  }\n\n  position = () => {\n    // auto collect dependency for seekcounter\n    if (this.audio && this.seekcounter) return this.audio.position\n    return 1\n  }\n\n  /**\n   * valid only if playing\n   */\n  remaintime = () => {\n    return (this.duration - this.position()) / this.playbackrate\n  }\n\n  seek = (time: number) => {\n    if (!this.audio) return\n    const duration = this.duration\n    if (time < 0) time = 0\n    if (time >= duration) time = duration - 0.05\n    this.audio.seek(time)\n    this.seekcounter++\n  }\n\n  toggle = () => {\n    if (!this.audio) return\n    if (this.playing) {\n      this.audio.pause()\n      this.playing = false\n    } else {\n      this.audio.play()\n      this.playing = true\n    }\n  }\n\n  stop = () => {\n    if (this.audio)\n      this.audio.stop()\n  }\n}\n\nexport const Music = new MusicState()\n","import React from \"react\"\nimport Box from \"@material-ui/core/Box\"\nimport makeStyles from \"@material-ui/core/styles/makeStyles\"\nimport { Background } from \"../states\"\nimport { useObserver } from \"mobx-react-lite\"\nimport { scope } from \"../../MappingScope/scope\"\n\nconst useStyles = makeStyles(theme => ({\n  background: {\n    position: \"absolute\", zIndex: -1, top: 0, left: 0, right: 0, bottom: 0,\n    backgroundPosition: \"center\", backgroundRepeat: \"no-repeat\", transition: \"opacity 0.3s\",\n    backgroundSize: \"cover\"\n  }\n}))\n\nconst BackgroundImage = () => {\n\n  const cn = useStyles()\n\n  return useObserver(() =>\n    <Box className={cn.background}\n      style={{\n        backgroundImage: Background.src ? `url(${Background.src})` : \"\",\n        opacity: 1 - scope.settings.general.background_dim\n      }}\n    />)\n}\n\nexport default BackgroundImage","import { createMuiTheme } from \"@material-ui/core/styles\"\nimport { red, blue } from \"@material-ui/core/colors\"\n\nexport const theme = createMuiTheme({\n  palette: {\n    primary: { main: blue[500], contrastText: \"white\" },\n    secondary: { main: red[\"A200\"] },\n    error: red,\n    type: \"dark\",\n    background: { default: \"#000\", }//paper: \"rgba(127,127,127,0.5)\" }\n  },\n  overrides: {\n    MuiButton: {\n      root: {\n        textTransform: \"inherit\",\n        transition: \"color 0.2s\"\n      }\n    },\n    MuiTab: {\n      root: {\n        textTransform: \"inherit\",\n        minWidth: \"96px !important\"\n      },\n    },\n    MuiSnackbarContent: {\n      root: { color: \"#fff\" }\n    },\n    MuiTableRow: {\n      root: {\n        \"&$selected\": {\n          background: \"rgb(128,216,255,0.16)\",\n          \"&:hover\": {\n            background: \"rgb(128,216,255,0.16)\",\n          }\n        },\n      }\n    },\n    MuiDivider: {\n      root: {\n        height: 2,\n        backgroundColor: \"rgba(127, 127, 127, 0.5)\"\n      }\n    }\n  }\n})\n","import React from \"react\"\nimport Dialog from \"@material-ui/core/Dialog\"\nimport { observable } from \"mobx\"\nimport { useObserver } from \"mobx-react-lite\"\nimport DialogTitle from \"@material-ui/core/DialogTitle\"\nimport DialogContent from \"@material-ui/core/DialogContent\"\nimport DialogActions from \"@material-ui/core/DialogActions\"\nimport Button from \"@material-ui/core/Button\"\nimport TextField from \"@material-ui/core/TextField\"\nimport { useTranslation } from \"react-i18next\"\nimport { makeStyles } from \"@material-ui/core/styles\"\n\nconst useStyles = makeStyles(theme => ({\n  paper: { width: \"calc(60vw + 200px)\" }\n}))\n\nconst dialog = observable({\n  open: false,\n  content: \"\",\n  title: \"\"\n})\n\nexport function openDialog(title: string, content: string) {\n  dialog.open = true\n  dialog.content = content\n  dialog.title = title\n}\n\nconst CopyDialog = () => {\n\n  const copy = () => {\n    navigator.clipboard.writeText(dialog.content)\n\n  }\n\n  const onfocus = (e: React.FocusEvent<HTMLTextAreaElement>) => {\n    e.target.select()\n  }\n\n  const cn = useStyles()\n  const { t } = useTranslation()\n\n  return useObserver(() =>\n    <Dialog open={dialog.open} onClose={() => dialog.open = false} classes={{ paper: cn.paper }}>\n      <DialogTitle>{dialog.title}</DialogTitle>\n      <DialogContent>\n        <TextField autoFocus onFocus={onfocus} fullWidth multiline rowsMax={20} variant=\"outlined\" value={dialog.content} />\n      </DialogContent>\n      <DialogActions>\n        <Button onClick={copy} color=\"primary\">\n          {t(\"Copy\")}\n        </Button>\n        <Button onClick={() => dialog.open = false} color=\"primary\">\n          {t(\"Close\")}\n        </Button>\n      </DialogActions>\n    </Dialog >)\n}\n\nexport default CopyDialog","import React from 'react'\nimport clsx from 'clsx'\nimport CheckCircleIcon from '@material-ui/icons/CheckCircle'\nimport ErrorIcon from '@material-ui/icons/Error'\nimport InfoIcon from '@material-ui/icons/Info'\nimport CloseIcon from '@material-ui/icons/Close'\nimport { orange, lightGreen, red, lightBlue } from '@material-ui/core/colors'\nimport IconButton from '@material-ui/core/IconButton'\nimport Snackbar from '@material-ui/core/Snackbar'\nimport SnackbarContent from '@material-ui/core/SnackbarContent'\nimport WarningIcon from '@material-ui/icons/Warning'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { observable } from 'mobx'\nimport { useObserver } from 'mobx-react-lite'\n\nconst variantIcon = {\n  success: CheckCircleIcon,\n  warning: WarningIcon,\n  error: ErrorIcon,\n  info: InfoIcon,\n}\n\nconst Message = observable({\n  message: \"\",\n  open: false,\n  type: \"info\" as keyof typeof variantIcon,\n})\n\nconst useStyles = makeStyles(theme => ({\n  success: { backgroundColor: lightGreen[700], },\n  error: { backgroundColor: red[600], },\n  info: { backgroundColor: lightBlue[600], },\n  warning: { backgroundColor: orange[700], },\n  icon: { fontSize: 20, },\n  iconVariant: { opacity: 0.9, marginRight: theme.spacing(1), },\n  message: { display: 'flex', alignItems: 'center', },\n}))\n\nexport function userMessage(message: string, type = \"info\" as keyof typeof variantIcon) {\n  Message.message = message\n  Message.type = type\n  Message.open = true\n}\n\nconst handleClose = (event: any, reason?: string) => {\n  if (reason === 'clickaway') return\n  Message.open = false\n}\n\nconst GlobalSnackbar = () => {\n\n  const cn = useStyles()\n  const Icon = variantIcon[Message.type]\n\n  return useObserver(() => (\n    <Snackbar\n      anchorOrigin={{\n        vertical: 'bottom',\n        horizontal: 'center',\n      }}\n      open={Message.open}\n      autoHideDuration={5000}\n      onClose={handleClose}\n      key={Message.message + Message.type}\n    >\n      <SnackbarContent\n        className={cn[Message.type]}\n        message={\n          <span className={cn.message}>\n            <Icon className={clsx(cn.icon, cn.iconVariant)} />\n            {Message.message}\n          </span>\n        }\n        action={[\n          <IconButton key=\"close\" aria-label=\"close\" color=\"inherit\" onClick={handleClose}>\n            <CloseIcon className={cn.icon} />\n          </IconButton>,\n        ]}\n      />\n    </Snackbar>))\n}\n\nexport default GlobalSnackbar","import { EditMap, Timepoint } from \"../MappingScope/EditMap\"\nimport { entryList } from \"../Common/utils\"\n\ntype bdBpm = {\n  type: \"System\"\n  cmd: \"BPM\"\n  beat: number\n  bpm: number\n}\n\ntype bdNoteBase = {\n  type: \"Note\"\n  /**\n   * bpm:      60          120 at 3\n   * timeline: *---*---*---*-*-*-\n   * beat:     0   1   2   3 4 5\n   */\n  beat: number\n  /**\n   * from 1 to 7\n   */\n  lane: number\n}\n\ntype bdSingleNote = bdNoteBase & {\n  note: \"Single\"\n  flick?: true\n  skill?: true\n}\n\ntype bdSlideNote = bdNoteBase & {\n  note: \"Slide\"\n  pos: \"A\" | \"B\"\n  start?: true\n  end?: true\n  flick?: true\n  skill?: true\n}\n\ntype bdMapItem = bdBpm | bdSingleNote | bdSlideNote\n\ntype bdMap = bdMapItem[]\n\n\n\nfunction format(map: bdMap) {\n  const strb: string[] = []\n  strb.push(\"[\")\n  for (let i = 0; i < map.length; i++) {\n    const item = map[i]\n    strb.push(JSON.stringify(item))\n    if (i !== map.length - 1) strb.push(\",\\n\")\n  }\n  strb.push(\"]\")\n  return strb.join(\"\")\n}\n\nfunction slideScope() {\n\n  let a: number | null = null\n  let abeat = 0\n  let b: number | null = null\n  let bbeat = 0\n\n  return {\n    start(id: number, beat: number) {\n      if (a === null && beat > abeat) {\n        a = id\n        return \"A\"\n      }\n      if (b === null && beat > bbeat) {\n        b = id\n        return \"B\"\n      }\n      throw new Error(\"Can not use 3 slides at same time\")\n    },\n    mid(id: number) {\n      if (a === id) return \"A\"\n      if (b === id) return \"B\"\n      throw new Error(\"Map may be corrupted\")\n    },\n    end(id: number, beat: number) {\n      if (a === id) {\n        a = null\n        abeat = beat\n        return \"A\"\n      }\n      if (b === id) {\n        b = null\n        bbeat = beat\n        return \"B\"\n      }\n      throw new Error(\"Map may be corrupted\")\n    }\n  }\n}\n\nfunction properBpmForSpan(time: number, preferred: number) {\n  for (let bpm = 30; bpm <= 60000; bpm++) {\n    const beattime = 60 / bpm\n    const beats = time / beattime\n    let beatcount = (beats + 0.5) | 0\n    const diff = beats > beatcount ? beats - beatcount : beatcount - beats\n    if (diff * beattime <= 1e-3) {\n      if (preferred % bpm === 0) {\n        const d = preferred / bpm\n        bpm *= d\n        beatcount *= d\n      }\n      return { bpm, beatcount }\n    }\n  }\n}\n\nexport function toBestdoriFormat(map: EditMap) {\n  const tps = entryList(map.timepoints).map(x => x[1]).sort((a, b) => a.time - b.time)\n  if (tps.length <= 0) return \"[]\"\n\n  const tpsPut = new Set<Timepoint>()\n\n  const notes = entryList(map.notes).map(x => x[1]).sort((a, b) => {\n    const dt = a.realtimecache - b.realtimecache\n    if (dt) return dt\n    return a.lane - b.lane\n  })\n\n  const bdmap: bdMap = []\n\n  let lasttp = tps[0]\n  let tpbasebeat = 0\n\n  {\n    if (lasttp.bpm !== (lasttp.bpm | 0)) throw new Error(\"Can not have float point bpm\")\n    const res = properBpmForSpan(lasttp.time, lasttp.bpm)\n    if (!res) throw new Error(\"Can not calculate bpm insertion\")\n    if (res.bpm === lasttp.bpm || res.beatcount <= 0) {\n      bdmap.push({ type: \"System\", cmd: \"BPM\", beat: 0, bpm: lasttp.bpm })\n    } else {\n      bdmap.push({ type: \"System\", cmd: \"BPM\", beat: 0, bpm: res.bpm })\n      bdmap.push({ type: \"System\", cmd: \"BPM\", beat: res.beatcount, bpm: lasttp.bpm })\n    }\n    tpbasebeat = res.beatcount\n    tpsPut.add(lasttp)\n  }\n\n  let inote = 0\n  let lastnotebeat = tpbasebeat\n\n  const scope = slideScope()\n\n  while (inote < notes.length) {\n    const n = notes[inote++]\n    const tp = map.timepoints.get(n.timepoint)\n    if (!tp) throw new Error(\"Map may be corrupted\")\n    if (!tpsPut.has(tp)) {\n\n      if (tp.bpm !== (tp.bpm | 0)) throw new Error(\"Can not have float point bpm\")\n      lastnotebeat = 0xfffff - ((0xfffff - lastnotebeat) | 0)\n      const lasttime = (lastnotebeat - tpbasebeat) * lasttp.ticktimecache * 48 + lasttp.time\n\n      const res = properBpmForSpan(tp.time - lasttime, tp.bpm)\n      if (!res) throw new Error(\"Can not calculate bpm insertion\")\n\n      if (res.bpm === tp.bpm || res.beatcount <= 0) {\n        tpbasebeat = lastnotebeat + res.beatcount\n        bdmap.push({ type: \"System\", cmd: \"BPM\", beat: tpbasebeat, bpm: tp.bpm })\n      } else {\n        tpbasebeat = lastnotebeat + res.beatcount\n        bdmap.push({ type: \"System\", cmd: \"BPM\", beat: lastnotebeat, bpm: res.bpm })\n        bdmap.push({ type: \"System\", cmd: \"BPM\", beat: tpbasebeat, bpm: tp.bpm })\n      }\n\n      lasttp = tp\n      lastnotebeat = tpbasebeat\n      tpsPut.add(tp)\n\n    } else {\n      if (lasttp !== tp) throw new Error(\"Map may be corrupted\")\n\n      const base: bdNoteBase = {\n        type: \"Note\", beat: tpbasebeat + n.offset / 48, lane: n.lane + 1\n      }\n\n      lastnotebeat = base.beat\n\n      switch (n.type) {\n        case \"single\":\n          bdmap.push({ ...base, note: \"Single\", })\n          break\n        case \"flick\":\n          bdmap.push({ ...base, note: \"Single\", flick: true })\n          break\n        case \"slide\":\n          const sl = map.slides.get(n.slide)\n          if (!sl) throw new Error(\"Map may be corrupted\")\n          const bdn: bdSlideNote = {\n            ...base, note: \"Slide\", pos: \"A\"\n          }\n          if (sl.notes[0] === n.id) {\n            bdn.start = true\n            bdn.pos = scope.start(sl.id, base.beat)\n          }\n          else if (sl.notes[sl.notes.length - 1] === n.id) {\n            bdn.end = true\n            bdn.pos = scope.end(sl.id, base.beat)\n            if (sl.flickend) bdn.flick = true\n          } else {\n            bdn.pos = scope.mid(sl.id)\n          }\n          bdmap.push(bdn)\n          break\n      }\n    }\n  }\n  return format(bdmap)\n}\n\n","import React from \"react\"\nimport Dialog from \"@material-ui/core/Dialog\"\nimport { observable } from \"mobx\"\nimport { useObserver } from \"mobx-react-lite\"\nimport DialogTitle from \"@material-ui/core/DialogTitle\"\nimport DialogContent from \"@material-ui/core/DialogContent\"\nimport DialogActions from \"@material-ui/core/DialogActions\"\nimport Button from \"@material-ui/core/Button\"\nimport { useTranslation } from \"react-i18next\"\nimport DialogContentText from \"@material-ui/core/DialogContentText\"\n\n\nconst dialog = observable({\n  open: false,\n  title: \"\",\n  content: \"\",\n  confirm: () => { }\n})\n\nexport function openConfirm(title: string, content: string, confirm: () => void) {\n  dialog.open = true\n  dialog.content = content\n  dialog.title = title\n  dialog.confirm = confirm\n}\n\nconst ConfirmDialog = () => {\n\n  const { t } = useTranslation()\n\n  return useObserver(() =>\n    <Dialog open={dialog.open} onClose={() => dialog.open = false}>\n      <DialogTitle>{dialog.title}</DialogTitle>\n      <DialogContent>\n        <DialogContentText>{dialog.content}</DialogContentText>\n      </DialogContent>\n      <DialogActions>\n        <Button onClick={() => dialog.open = false} color=\"primary\" autoFocus>\n          {t(\"Cancel\")}\n        </Button>\n        <Button onClick={() => { dialog.confirm(); dialog.open = false }} color=\"secondary\">\n          {t(\"Reset\")}\n        </Button>\n      </DialogActions>\n    </Dialog >)\n}\n\nexport default ConfirmDialog","import { Timepoint, Slide, NoteType, FreshTimepointCache, SingleNote, FlickNote, SlideNote, EditMap } from \"../MappingScope/EditMap\"\nimport { randomId } from \"../Common/utils\"\n\nfunction getTimepoint(items: string[]): Timepoint {\n  const time = parseFloat(items[1])\n  const bpm = parseFloat(items[2])\n  const bpb = parseInt(items[3])\n  return { time, bpm, bpb, id: randomId(), ticktimecache: 0 }\n}\n\nfunction getPos(item: string) {\n  const parts = item.split(\":\")\n  const offset = parseInt(parts[0]) * 2\n  const lane = parseInt(parts[1])\n  return { offset, lane }\n}\n\nfunction getSingle(items: string[], timepoint: number): SingleNote {\n  return { type: \"single\", id: randomId(), timepoint, ...getPos(items[1]), realtimecache: 0 }\n}\n\nfunction getFlick(items: string[], timepoint: number): FlickNote {\n  return { type: \"flick\", id: randomId(), timepoint, ...getPos(items[1]), realtimecache: 0 }\n}\n\nfunction getSlideNotes(items: string[], timepoint: number): [Slide, SlideNote[]] {\n  const slide: Slide = { id: randomId(), flickend: items[1] === \"1\", notes: [] }\n  const notes: SlideNote[] = []\n  for (let i = 2; i < items.length; i++) {\n    const n: SlideNote = { type: \"slide\", id: randomId(), timepoint, ...getPos(items[i]), realtimecache: 0, slide: slide.id }\n    slide.notes.push(n.id)\n    notes.push(n)\n  }\n  return [slide, notes]\n}\n\nexport function fromBBBv1Format(content: string): EditMap {\n  const lines = content.split(/\\r?\\n/).map(x => x.trim()).filter(x => x)\n  const timepoints: Timepoint[] = []\n  const slides: Slide[] = []\n  const notes: NoteType[] = []\n  let lasttp!: Timepoint\n  for (const line of lines) {\n    const items = line.split(\"|\")\n    switch (items[0]) {\n      case \"+\": {\n        lasttp = getTimepoint(items)\n        FreshTimepointCache(lasttp)\n        timepoints.push(lasttp)\n        break\n      }\n      case \"s\": {\n        notes.push(getSingle(items, lasttp.id))\n        break\n      }\n      case \"f\": {\n        notes.push(getFlick(items, lasttp.id))\n        break\n      }\n      case \"l\": {\n        const [s, ns] = getSlideNotes(items, lasttp.id)\n        slides.push(s)\n        notes.push(...ns)\n        break\n      }\n    }\n  }\n  return EditMap.fromJson(JSON.stringify({ timepoints, slides, notes }))\n}","import React from \"react\"\nimport Grid from \"@material-ui/core/Grid\"\nimport { useTranslation } from \"react-i18next\"\nimport Button from \"@material-ui/core/Button\"\nimport { openDialog } from \"./CopyDialog\"\nimport { userMessage } from \"../../../Common/Components/GlobalSnackbar\"\nimport { toBestdoriFormat } from \"../../../MapFormats/bestdori\"\nimport { scope } from \"../../../MappingScope/scope\"\nimport { openConfirm } from \"./ConfirmDialog\"\nimport { openFile, downLoadFile } from \"../../../Common/utils\"\nimport { fromBBBv1Format } from \"../../../MapFormats/bbbv1\"\nimport { EditMap } from \"../../../MappingScope/EditMap\"\n\n\nconst Actions = () => {\n\n  const { t } = useTranslation()\n\n  const importBBBv1 = async () => {\n    try {\n      const content = await openFile(\"*\")\n      scope.reset(fromBBBv1Format(content))\n      userMessage(t(\"Import success\"), \"success\")\n    } catch (error) {\n      if (!error) return\n      userMessage(t(\"Error import\"), \"error\")\n      throw error\n    }\n  }\n\n  const exportBestdori = () => {\n    try {\n      const content = toBestdoriFormat((scope.map as any).state)\n      openDialog(t(\"Export Bestdori format map\"), content)\n    } catch (error) {\n      openDialog(t(\"An error occurred during export\"), t(\"\" + error))\n      userMessage(t(\"Error export\"), \"error\")\n      throw error\n    }\n  }\n\n  const reset = () => {\n    openConfirm(\n      t(\"Are you sure to reset current map?\"),\n      t(\"This action can not be reverted. Please make sure you have backed up your map.\"),\n      () => {\n        scope.reset()\n        userMessage(t(\"Reset success\"), \"success\")\n      })\n  }\n\n  const exportEditorMap = () => {\n    const content = EditMap.toJsonString(scope.map as any)\n    downLoadFile(content)\n  }\n\n  const importEditorMap = async () => {\n    try {\n      const content = await openFile(\"*\")\n      scope.reset(EditMap.fromJson(content))\n      userMessage(t(\"Import success\"), \"success\")\n    } catch (error) {\n      if (!error) return\n      userMessage(t(\"Error import\"), \"error\")\n      throw error\n    }\n  }\n\n  return (\n    <Grid style={{margin: \"20px 0\"}} item container direction=\"column\" spacing={2}>\n      <Grid item>\n        <Button fullWidth variant=\"outlined\" onClick={importBBBv1}>\n          {t(\"Import bangbangboom format v1 (current map will loss)\")}\n        </Button>\n      </Grid>\n      <Grid item>\n        <Button fullWidth variant=\"outlined\" onClick={exportBestdori}>\n          {t(\"Export Bestdori format map\")}\n        </Button>\n      </Grid>\n      <Grid item>\n        <Button fullWidth variant=\"outlined\" onClick={exportEditorMap}>\n          {t(\"Download editor format map\")}\n        </Button>\n      </Grid>\n      <Grid item>\n        <Button fullWidth variant=\"outlined\" onClick={importEditorMap}>\n          {t(\"Import editor format map (current map will loss)\")}\n        </Button>\n      </Grid>\n      <Grid item>\n        <Button fullWidth variant=\"outlined\" onClick={reset}>\n          {t(\"Reset current map\")}\n        </Button>\n      </Grid>\n    </Grid>)\n}\n\nexport default Actions","import React, { forwardRef, useState, useCallback, useMemo } from \"react\"\nimport TextField, { TextFieldProps } from \"@material-ui/core/TextField\"\n\nexport type FileInputProps = { accept?: string, multiple?: boolean, onFileSelected?: (f: File[]) => any } & TextFieldProps\n\nconst FileField = forwardRef<HTMLDivElement, FileInputProps>((props, ref) => {\n\n  const {\n    onFileSelected,\n    inputProps,\n    multiple = false,\n    accept,\n    value = \"\",\n    ...others\n  } = props\n\n  const [display, setDisplay] = useState(value)\n\n  const handleChange = useCallback((input: HTMLInputElement, onSelected?: (f: File[]) => any) => {\n    if (input.files && input.files.length) {\n      const fs = Array.from(input.files)\n      setDisplay(fs.map(f => f.name).join(\", \"))\n      if (onSelected) onSelected(fs)\n    }\n  }, [setDisplay])\n\n  const input = useMemo(() => {\n    const i = document.createElement(\"input\")\n    i.type = \"file\"\n    return i\n  }, [])\n\n  const handleClick = () => {\n    input.accept = accept || \"*\"\n    input.multiple = multiple\n    input.onchange = () => handleChange(input, onFileSelected)\n    input.click()\n  }\n  return (\n    <TextField {...others} ref={ref}\n      inputProps={{\n        ...inputProps,\n        onClick: handleClick,\n      }}\n      value={display} />)\n})\n\nexport default FileField","import React from \"react\"\nimport Grid from \"@material-ui/core/Grid\"\nimport AttachFileIcon from '@material-ui/icons/AttachFile'\nimport QueueMusicIcon from '@material-ui/icons/QueueMusic'\nimport FileField from \"../../../Common/Components/FileField\"\nimport { Music, Background } from \"../../states\"\nimport { userMessage } from \"../../../Common/Components/GlobalSnackbar\"\nimport { useTranslation } from \"react-i18next\"\nimport { useObserver } from \"mobx-react-lite\"\nimport { scope } from \"../../../MappingScope/scope\"\nimport TextField from \"@material-ui/core/TextField\"\n\nconst FileFieldWrapper = ({ children }: { children: React.ReactNode }) => {\n  return (\n    <Grid item container spacing={2} alignItems=\"flex-end\">\n      <Grid item><AttachFileIcon /></Grid>\n      <Grid item xs>\n        {children}\n      </Grid>\n    </Grid>)\n}\n\nconst MapName = () => {\n\n  const { t } = useTranslation()\n\n  return useObserver(() =>\n    <Grid item container spacing={2} alignItems=\"flex-end\">\n      <Grid item><QueueMusicIcon /></Grid>\n      <Grid item xs>\n        <TextField fullWidth label={t(\"Map name\")} value={scope.meta.name}\n          onChange={e => scope.meta.name = e.target.value} />\n      </Grid>\n    </Grid>)\n}\n\nlet musicfilename = \"\"\nconst SelectMusic = () => {\n  const { t } = useTranslation()\n\n  const select = (files: File[]) => {\n    musicfilename = files[0].name\n    Music.load(files[0],\n      () => userMessage(t(\"Load failed\"), \"error\"),\n      () => userMessage(t(\"Load success\"), \"success\"))\n  }\n\n  return (\n    <FileFieldWrapper>\n      <FileField fullWidth value={musicfilename} label={t(\"Load music\")}\n        accept=\"audio/*\" onFileSelected={select} />\n    </FileFieldWrapper>)\n}\n\nlet backgroundfilename = \"\"\nconst SelectBackground = () => {\n  const { t } = useTranslation()\n\n  const select = (files: File[]) => {\n    backgroundfilename = files[0].name\n    const src = URL.createObjectURL(files[0])\n    Background.src = src\n  }\n\n  return (\n    <FileFieldWrapper>\n      <FileField fullWidth value={backgroundfilename} label={t(\"Load background\")}\n        accept=\"image/*\" onFileSelected={select} />\n    </FileFieldWrapper>)\n}\n\nconst Inputs = () => <>\n  <MapName />\n  <SelectMusic />\n  <SelectBackground />\n</>\n\nexport default Inputs","import React from \"react\"\nimport { makeStyles } from \"@material-ui/core/styles\"\nimport Grid from \"@material-ui/core/Grid\"\nimport CopyDialog from \"./CopyDialog\"\nimport Actions from \"./Actions\"\nimport ConfirmDialog from \"./ConfirmDialog\"\nimport Inputs from \"./Inputs\"\nimport Typography from \"@material-ui/core/Typography\"\nimport Link from \"@material-ui/core/Link\"\nimport Box from \"@material-ui/core/Box\"\nimport { useObserver } from \"mobx-react-lite\"\nimport { useTranslation } from \"react-i18next\"\nimport { scope } from \"../../../MappingScope/scope\"\n\nconst useStyles = makeStyles(() => ({\n  panel: { width: \"100%\", maxWidth: 600, margin: \"64px auto\", },\n}))\n\nconst Links = () =>\n  <Grid item>\n    <Typography align=\"right\" color=\"textSecondary\">\n      <Link target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://bestdori.com\">\n        Bestdori\n    </Link>&nbsp;|&nbsp;\n    <Link target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://player.banground.fun\">\n        Banground Player\n    </Link>&nbsp;|&nbsp;\n    <Link target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://github.com/K024/bangbangboom-editor\">\n        About bangbangboom editor & translations\n    </Link>\n    </Typography>\n  </Grid>\n\nconst Update = () => {\n  const { t } = useTranslation()\n  const update = useObserver(() => scope.update)\n  if (update) return (\n    <Grid item>\n      <Box p={1} fontWeight=\"fontWeightLight\" fontFamily=\"sans-serif\" fontStyle=\"italic\" textAlign=\"center\">\n        {t(\"An update is available. Please close ALL tabs of this site or press Ctrl + F5 reload.\")}</Box>\n    </Grid>)\n  return null\n}\n\nconst MetaPage = () => {\n\n  const cn = useStyles()\n\n  return (\n    <Grid className={cn.panel} container direction=\"column\" spacing={4}>\n      <Update />\n      <Inputs />\n      <Actions />\n      <Links />\n      <CopyDialog />\n      <ConfirmDialog />\n    </Grid>)\n\n}\n\nexport default MetaPage","import { observable, reaction } from \"mobx\"\nimport { scope } from \"../../../MappingScope/scope\"\n\n\nexport const TimingState = observable({\n  bpm: 90,\n  bpb: 4,\n  time: 0,\n\n  selected: null as null | number,\n\n  muteticker: false,\n  measuring: false,\n\n  autoswitchtp: true, // in Timing pad, anim loop\n})\n\nreaction(() => TimingState.selected, selected => {\n  if (selected !== null) {\n    const tp = scope.map.timepoints.get(selected)\n    if (!tp) return\n    TimingState.bpm = tp.bpm\n    TimingState.bpb = tp.bpb\n    TimingState.time = tp.time\n  }\n})\n","import React from \"react\"\nimport { useObserver } from \"mobx-react-lite\"\nimport Grid from \"@material-ui/core/Grid\"\nimport Typography from \"@material-ui/core/Typography\"\nimport { useTranslation } from \"react-i18next\"\nimport { useMapChange } from \"../../states\"\nimport { makeStyles } from \"@material-ui/core/styles\"\nimport Table from \"@material-ui/core/Table\"\nimport TableHead from \"@material-ui/core/TableHead\"\nimport TableRow from \"@material-ui/core/TableRow\"\nimport TableCell from \"@material-ui/core/TableCell\"\nimport TableBody from \"@material-ui/core/TableBody\"\nimport { scope } from \"../../../MappingScope/scope\"\nimport { TimeToString } from \"../../../Common/utils\"\nimport { TimingState } from \"./sharedState\"\nimport Button from \"@material-ui/core/Button\"\n\n\nconst useStyles = makeStyles(theme => ({\n  table: { maxHeight: \"60vh\", overflow: \"auto\", \"-webkit-overflow-scrolling\": \"touch\" },\n  tablerow: { cursor: \"pointer\" }\n}))\n\nconst TimepointTable = () => {\n\n  const cn = useStyles()\n  const { t } = useTranslation()\n  useMapChange()\n\n  return useObserver(() =>\n    <Table className={cn.table}>\n      <TableHead>\n        <TableRow>\n          <TableCell>{t(\"Start time\")}</TableCell>\n          <TableCell>BPM</TableCell>\n          <TableCell>{(t(\"Meter\"))}</TableCell>\n        </TableRow>\n      </TableHead>\n      <TableBody>\n        {scope.map.timepointlist.map(tp => (\n          <TableRow key={tp.id} selected={tp.id === TimingState.selected} hover\n            onClick={() => TimingState.selected = tp.id === TimingState.selected ? null : tp.id}\n            classes={{ root: cn.tablerow }}>\n            <TableCell>{TimeToString(tp.time)}</TableCell>\n            <TableCell>{tp.bpm}</TableCell>\n            <TableCell>{tp.bpb}/4</TableCell>\n          </TableRow>))}\n      </TableBody>\n    </Table>)\n}\n\nconst RemoveBtn = () => {\n\n  const { t } = useTranslation()\n\n  const removeTp = () => {\n    if (TimingState.selected === null) return\n    scope.map.removeTimepoint(TimingState.selected, scope.settings.editor.justify_grid_divisor)\n    TimingState.selected = null\n  }\n\n  return useObserver(() =>\n    <Button color=\"secondary\" disabled={TimingState.selected === null} onClick={removeTp}>\n      {t(\"Remove\")}\n    </Button>)\n}\n\nconst LeftPanel = () => {\n\n  const { t } = useTranslation()\n\n  return useObserver(() =>\n    <Grid item xs={12} sm container spacing={2} direction=\"column\">\n      <Grid item><Typography>{t(\"Timepoints\")}</Typography></Grid>\n      <Grid item>\n        <TimepointTable />\n      </Grid>\n      <Grid item>\n        <RemoveBtn />\n      </Grid>\n    </Grid>)\n}\n\nexport default LeftPanel","\nconst assets = {\n  note_flick: \"/assets/mapping/note_flick.png\",\n  note_long: \"/assets/mapping/note_long.png\",\n  note_normal: \"/assets/mapping/note_normal.png\",\n  note_slide_among: \"/assets/mapping/note_slide_among.png\",\n  timing_tack: \"/assets/mapping/timing_tack.wav\",\n  timing_tick: \"/assets/mapping/timing_tick.wav\",\n  perfect: \"/assets/mapping/perfect.mp3\",\n  flick: \"/assets/mapping/flick.mp3\",\n  long: \"/assets/mapping/long.mp3\",\n}\n\nfor (const k in assets) {\n  assets[(k as keyof typeof assets)] = process.env.PUBLIC_URL + assets[(k as keyof typeof assets)]\n}\n\nexport default assets\n\n","\nimport hotkey, { KeyHandler } from \"hotkeys-js\"\n\nexport function createAnimLoop(fn: (cancel: () => void) => void) {\n  let unmounted = false\n  const cancel = () => {\n    unmounted = true\n  }\n  const loop = () => {\n    if (unmounted) return\n    requestAnimationFrame(loop)\n    fn(cancel)\n  }\n  requestAnimationFrame(loop)\n  return cancel\n}\n\nexport function addHotkey(key: string, handler: KeyHandler) {\n  hotkey(key, handler)\n  return function () {\n    hotkey.unbind(key, handler)\n  }\n}\n","import { observable } from \"mobx\"\n\nexport type AssignableCSSProps = Exclude<keyof CSSStyleDeclaration, \"length\" | \"parentRule\">\n\nconst Calibration = observable({\n  counter: 1\n})\n\nsetInterval(() => {\n  Calibration.counter++\n}, 500)\n\nexport function stopAnimation(el: HTMLElement, prop: AssignableCSSProps, value: number, unit: string | ((value: number) => string)) {\n  el.style[prop] = unit instanceof Function ? unit(value) : value + unit\n  el.style.transition = \"none\"\n  if (getComputedStyle(el)[prop]) {\n    // trigger computation\n  }\n}\n\nexport function startAnimation(el: HTMLElement, prop: AssignableCSSProps, from: number, to: number, unit: string | ((value: number) => string), duration: number) {\n  el.style[prop] = unit instanceof Function ? unit(from) : from + unit\n  el.style.transition = \"none\"\n  if (getComputedStyle(el)[prop] && Calibration.counter) {\n    // trigger computation, auto collect calibration dependency\n  }\n  el.style[prop] = unit instanceof Function ? unit(to) : to + unit\n  el.style.transition = prop + \" \" + duration + \"s linear\"\n}\n\n","import React from \"react\"\nimport { useObserver } from \"mobx-react-lite\"\nimport Grid from \"@material-ui/core/Grid\"\nimport { useTranslation } from \"react-i18next\"\nimport Button from \"@material-ui/core/Button\"\nimport { TimingState } from \"../sharedState\"\nimport { scope } from \"../../../../MappingScope/scope\"\nimport FormControlLabel from \"@material-ui/core/FormControlLabel\"\nimport Switch from \"@material-ui/core/Switch\"\nimport { useMapChange } from \"../../../states\"\n\nconst addtp = () => {\n  scope.map.addTimepoint(\n    TimingState.time,\n    TimingState.bpm,\n    TimingState.bpb,\n    scope.settings.editor.justify_grid_divisor)\n}\n\nconst settp = () => {\n  const selected = TimingState.selected\n  if (selected === null) return\n  scope.map.moveTimepoint(selected,\n    scope.settings.editor.justify_find_nearest,\n    scope.settings.editor.justify_grid_divisor,\n    TimingState.time,\n    TimingState.bpm,\n    TimingState.bpb)\n}\n\nexport const changed = () => {\n  const selected = TimingState.selected\n  if (selected === null) return false\n  const tp = scope.map.timepoints.get(selected)\n  if (!tp) {\n    TimingState.selected = null\n    return false\n  }\n  return tp.bpb !== TimingState.bpb || tp.bpm !== TimingState.bpm || tp.time !== TimingState.time\n}\n\nconst ActionPart = () => {\n\n  const { t } = useTranslation()\n  useMapChange()\n\n  return useObserver(() =>\n    <Grid item container wrap=\"wrap\" spacing={2}>\n      <Grid item xs>\n        <Button fullWidth onClick={addtp} disabled={TimingState.selected !== null} color=\"primary\">\n          {t(\"Add timepoint\")}\n        </Button></Grid>\n      <Grid item xs>\n        <Button fullWidth onClick={settp} disabled={!changed()} color=\"primary\">\n          {t(\"Apply changes\")}\n        </Button></Grid>\n      <Grid item container style={{ marginTop: 16 }}>\n        <FormControlLabel style={{ marginLeft: \"auto\" }}\n          control={<Switch checked={TimingState.muteticker}\n            onChange={(e, v) => TimingState.muteticker = v} />}\n          label={t(\"Mute metronome\")} labelPlacement=\"start\" />\n      </Grid>\n      <Grid item container>\n        <FormControlLabel style={{ marginLeft: \"auto\" }}\n          control={<Switch checked={TimingState.autoswitchtp}\n            onChange={(e, v) => TimingState.autoswitchtp = v} />}\n          label={t(\"Auto switch selected timepoint\")} labelPlacement=\"start\" />\n      </Grid>\n    </Grid>)\n}\n\nexport default ActionPart","import React, { useEffect, useRef } from \"react\"\nimport { makeStyles } from \"@material-ui/core/styles\"\nimport assets from \"../../../assets\"\nimport { once, range } from \"../../../../Common/utils\"\nimport { createAnimLoop } from \"../../../../Common/hooks\"\nimport { useObserver } from \"mobx-react-lite\"\nimport { TimingState } from \"../sharedState\"\nimport { Music } from \"../../../states\"\nimport { stopAnimation, startAnimation } from \"../../../../Common/animation\"\nimport { AudioSource, loadFromUrl, AudioInstance } from \"../../../../Common/AudioCtx\"\nimport { autorun } from \"mobx\"\nimport { scope } from \"../../../../MappingScope/scope\"\nimport { changed } from \"./ActionPart\"\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    display: \"flex\", alignItems: \"center\", height: 80, padding: 10, transform: \"translate(0, 0)\",\n    \"&>*\": {\n      flexGrow: 1, height: \"100%\", margin: 10, border: \"solid 3px cornflowerblue\", borderRadius: 6, overflow: \"hidden\",\n    },\n    \"& :first-child\": { borderColor: \"darkorange\", },\n    \"&>*>*\": {\n      width: \"100%\", height: \"100%\", backgroundColor: \"cornflowerblue\", willChange: \"opacity\", opacity: 0,\n    },\n    \"& :first-child>*\": { backgroundColor: \"darkorange\", },\n  }\n}))\n\nconst sounds = once(() => ({\n  tick: AudioSource.from(loadFromUrl(assets.timing_tick)).load(),\n  tack: AudioSource.from(loadFromUrl(assets.timing_tack)).load(),\n}))\n\nlet nosounduntil = 0\nfunction setsound(tick: boolean, timeoutms: number) {\n  if (TimingState.measuring || TimingState.muteticker) return\n  const soundtime = performance.now() + timeoutms\n  if (soundtime <= nosounduntil) return\n  const s = sounds()\n  nosounduntil = soundtime + 100 // no sound until 100 ms after sound played\n\n  new AudioInstance(tick ? s.tick : s.tack).play(timeoutms / 1000)\n}\n\nlet lastbeat = -1\nfunction animloop(pads: HTMLDivElement[]) {\n\n  const pos = Music.position()\n  /**\n   * only if not measuring and selected a timepoint and playing and no changes on editor\n   */\n  if (!TimingState.measuring && TimingState.autoswitchtp && TimingState.selected !== null && Music.playing) {\n    if (!changed()) {\n      const [tp] = scope.map.findTimepoint(pos)\n      if (!tp) return\n      if (tp.id !== TimingState.selected) {\n        TimingState.selected = tp.id\n      }\n    }\n  }\n\n  const { time, bpm, bpb } = TimingState\n  const beattime = 60 / bpm\n  const currentBeat = (pos - time) / beattime\n  const beatcount = Math.floor(currentBeat)\n  const beatoff = currentBeat - beatcount\n  const beatnum = beatcount % bpb\n\n  const realbeattime = beattime / Music.playbackrate\n\n  if (Music.playing) {\n\n    let deltabeat = currentBeat - lastbeat\n    if (deltabeat > 0.3) {\n      // clearsound()\n      deltabeat = 0\n    }\n\n    if (beatoff - deltabeat < 0) { // play animation\n      for (let i = 0; i < pads.length; i++) {\n        if (i === beatnum) {\n          startAnimation(pads[i], \"opacity\", 1, 0, \"\", realbeattime / 2)\n        } else {\n          stopAnimation(pads[i], \"opacity\", 0, \"\")\n        }\n      }\n    }\n\n    const nexttimems = (1 - beatoff) * realbeattime * 1000\n    if (nexttimems < 50)\n      setsound(beatnum === bpb - 1, nexttimems)\n\n\n  } else {\n    // clearsound()\n\n    for (let i = 0; i < pads.length; i++) {\n      if (i === beatnum) {\n        stopAnimation(pads[i], \"opacity\", Math.max(0, (0.5 - beatoff) * 2), \"\")\n      } else {\n        stopAnimation(pads[i], \"opacity\", 0, \"\")\n      }\n    }\n  }\n\n  lastbeat = currentBeat\n}\n\nconst TimingPad = () => {\n\n  const cn = useStyles()\n\n  const ref = useRef<HTMLDivElement>(null)\n  const padcount = useObserver(() => TimingState.bpb)\n\n  useEffect(() => createAnimLoop(() => {\n    if (ref.current) {\n      const pads = Array.from(ref.current.children).map(x => x.firstChild as HTMLDivElement)\n      animloop(pads)\n    }\n  }), [])\n\n  useEffect(() => autorun(() => {\n    const s = sounds()\n    s.tick.volume = scope.settings.general.effect_volume\n    s.tack.volume = scope.settings.general.effect_volume\n  }), [])\n\n  return (\n    <div className={cn.root} ref={ref}>\n      {range(padcount).map(v =>\n        <div key={v}>\n          <div></div>\n        </div>)}\n    </div>)\n}\n\nexport default TimingPad","import React, { useState, useEffect } from \"react\"\nimport Button from \"@material-ui/core/Button\"\nimport { TimingState } from \"../sharedState\"\nimport { useTranslation } from \"react-i18next\"\nimport { Music } from \"../../../states\"\nimport { addHotkey } from \"../../../../Common/hooks\"\nimport { useObserver } from \"mobx-react-lite\"\n\nfunction calcMeasureRaw(taps: number[]) {\n  const d = (taps.length / 2) | 0\n  let sum = 0\n  let i = 0\n  for (; i + d < taps.length; i++) {\n    sum += taps[i + d] - taps[i]\n  }\n  const beattime = sum / d / i\n  const bpm = 60 / beattime\n  sum = 0\n  i = 0\n  for (; i < taps.length; i++) {\n    sum += taps[i] - i * beattime\n  }\n  const offset = sum / i\n  return { bpm, offset }\n}\n\nfunction calcMeasure(taps: number[]) {\n  const res = calcMeasureRaw(taps)\n  let recalc = false\n  const beattime = 60 / res.bpm\n  const processed = [taps[0]]\n  for (let i = 1; i < taps.length; i++) {\n    const current = taps[i]\n    const last = processed[processed.length - 1]\n    const dt = current - last\n    if (dt < beattime * 0.3) {\n      recalc = true                 // ignore multi taps in one beat\n    } else if (dt > beattime * 1.7) {\n      processed.push(last + beattime) // push missed taps\n      i--\n      recalc = true\n    } else {\n      processed.push(current)\n    }\n  }\n  if (recalc) return calcMeasureRaw(processed)\n  return res\n}\n\nconst state = {\n  taps: [] as number[],\n  timeoutId: undefined as any,\n}\n\nconst startMeasure = (setLen: (v: number) => void) => {\n  const currentpos = Music.position()\n\n  state.taps.push(currentpos)\n  setLen(state.taps.length)\n  if (state.taps.length >= 5) {\n    const res = calcMeasure(state.taps)\n    TimingState.bpm = res.bpm\n    TimingState.time = res.offset\n  }\n  TimingState.measuring = true\n\n  clearTimeout(state.timeoutId)\n  state.timeoutId = setTimeout(() => {\n    state.taps.length = 0\n    TimingState.measuring = false\n    setLen(0)\n  }, 3000)\n}\nconst MeasureBtn = () => {\n\n  const [length, setLen] = useState(0)\n\n  useEffect(() => addHotkey(\"t\", () => [\n    startMeasure(setLen)\n  ]), [])\n\n  const { t } = useTranslation()\n\n  return useObserver(() =>\n    <Button fullWidth disableRipple onClick={() => startMeasure(setLen)} disabled={!Music.playing}\n      title={t(\"Hotkey: {{ hotkey }}\", { hotkey: \"t\" })}>\n      {!Music.playing\n        ? t(\"Play the music to start measure\")\n        : length <= 0\n          ? t(\"Click here or press 'T' to measure\")\n          : length < 5\n            ? t(\"More {{ count }} times\", { count: 5 - length })\n            : t(\"Keep stable\")}\n    </Button>)\n}\n\nexport default MeasureBtn","import React, { useState, forwardRef } from \"react\"\nimport TextField, { TextFieldProps } from \"@material-ui/core/TextField\"\n\nexport type NumberFieldProps = TextFieldProps & {\n  number: number,\n  validator?: (s: string) => number | boolean,\n  numberDisplay?: (v: number) => string,\n  onNumberChange?: (e: React.ChangeEvent, v: number) => void\n}\n\nconst NumberField = forwardRef<HTMLDivElement, NumberFieldProps>((props, ref) => {\n\n  const {\n    number,\n    validator = (s: string) => /^-?([0-9]+(\\.[0-9]+)?)$/.test(s) && parseFloat(s),\n    numberDisplay = (v: number) => v.toString(),\n    onNumberChange,\n    onBlur: userBlur,\n    onChange: userChange,\n    ...others\n  } = props\n\n  const propNumberDisplay = numberDisplay(number)\n\n  const [display, setDisplay] = useState(propNumberDisplay)\n  const [valid, setValid] = useState(true)\n\n  // received new number, should update to new display\n  if (valid && validator(propNumberDisplay) !== validator(display))\n    setDisplay(propNumberDisplay)\n\n  const onChange: typeof userChange = e => {\n    setDisplay(e.target.value)\n    if (userChange) userChange(e)\n\n    const v = validator(e.target.value)\n    if (typeof v === \"number\" && !isNaN(v)) {\n      setValid(true)\n      if (v !== number && onNumberChange)   // the number is valid and changed\n        onNumberChange(e, v)\n    } else {\n      setValid(false)\n    }\n  }\n\n  const onBlur: typeof userBlur = e => {\n    if (userBlur) userBlur(e)\n    if (!valid) {\n      setDisplay(propNumberDisplay)\n      setValid(true)\n    }\n  }\n\n  return (\n    <TextField {...others} ref={ref}\n      value={display} onChange={onChange} onBlur={onBlur}\n      color={valid ? \"primary\" : \"secondary\"}>\n    </TextField>)\n})\n\nexport default NumberField","import React from \"react\"\nimport { useObserver } from \"mobx-react-lite\"\nimport Grid from \"@material-ui/core/Grid\"\nimport NumberField from \"../../../../Common/Components/NumberField\"\nimport { useTranslation } from \"react-i18next\"\nimport { TimingState } from \"../sharedState\"\nimport NavigateBeforeIcon from '@material-ui/icons/NavigateBefore'\nimport NavigateNextIcon from '@material-ui/icons/NavigateNext'\nimport IconButton from \"@material-ui/core/IconButton\"\nimport Button from \"@material-ui/core/Button\"\nimport { Music } from \"../../../states\"\nimport InputAdornment from \"@material-ui/core/InputAdornment\"\nimport { TimeToString } from \"../../../../Common/utils\"\n\nconst movebeat = (beats: number) => {\n  TimingState.time += beats * 60 / TimingState.bpm\n}\n\nfunction secondFromString(s: string) {\n  if (!/^-?([0-9]+:[0-9]{2}(.[0-9]+)?|[0-9]+(.[0-9]+)?)$/.test(s)) return false\n  const cindex = s.indexOf(\":\")\n  if (cindex < 0) return parseFloat(s)\n  const minutes = parseInt(s.substr(0, cindex))\n  const seconds = parseFloat(s.substr(cindex + 1))\n  return minutes * 60 + seconds\n}\n\nconst EditPart = () => {\n\n  const { t } = useTranslation()\n\n  return useObserver(() =>\n    <Grid item container spacing={2}>\n      <Grid item xs={12} sm={6}>\n        <NumberField fullWidth label={t(\"Time\")}\n          numberDisplay={TimeToString} validator={secondFromString}\n          number={TimingState.time} onNumberChange={(e, v) => TimingState.time = v} />\n      </Grid>\n      <Grid item xs={12} container alignItems=\"center\">\n        <Grid item>\n          <IconButton onClick={() => movebeat(-1)} title={t(\"Backward one beat\")} >\n            <NavigateBeforeIcon />\n          </IconButton>\n          <IconButton onClick={() => movebeat(1)} title={t(\"Forward one beat\")}>\n            <NavigateNextIcon />\n          </IconButton>\n        </Grid>\n        <Grid item xs>\n          <Button fullWidth onClick={() => TimingState.time = Music.position()}>\n            {t(\"Set to current player time\")}\n          </Button>\n        </Grid>\n      </Grid>\n      <Grid item xs={12} sm={6}>\n        <NumberField fullWidth label=\"BPM\" inputProps={{ type: \"number\", step: \"0.001\" }}\n          number={TimingState.bpm}\n          onNumberChange={(e, v) => TimingState.bpm = v} />\n      </Grid>\n      <Grid item xs={12} sm={6}>\n        <NumberField\n          InputProps={{ endAdornment: <InputAdornment position=\"end\">/ 4</InputAdornment> }}\n          fullWidth label={t(\"Meter\")} inputProps={{ type: \"number\", step: \"1\" }}\n          number={TimingState.bpb}\n          validator={s => /^[0-9]+$/.test(s) && parseInt(s)}\n          onNumberChange={(e, v) => TimingState.bpb = v} />\n      </Grid>\n    </Grid>)\n}\n\nexport default EditPart","import React from \"react\"\nimport Grid from \"@material-ui/core/Grid\"\nimport Box from \"@material-ui/core/Box\"\nimport TimingPad from \"./TimingPad\"\nimport MeasureBtn from \"./MeasureBtn\"\nimport EditPart from \"./EditPart\"\nimport ActionPart from \"./ActionPart\"\nimport { useObserver } from \"mobx-react-lite\"\nimport { scope } from \"../../../../MappingScope/scope\"\nimport { useTranslation } from \"react-i18next\"\n\nconst DelayNotice = () => {\n  const { t } = useTranslation()\n  return useObserver(() => {\n    if (scope.settings.editor.keep_pitch)\n      return (\n        <Grid item>\n          <Box p={1} fontWeight=\"fontWeightLight\" fontFamily=\"sans-serif\" fontStyle=\"italic\" textAlign=\"center\">\n            {t(\"Some unstable delay may be caused by setting \\\"Keep pitch\\\"\")}</Box>\n        </Grid>)\n    return null\n  })\n}\n\nconst RightPanel = () => {\n\n  return (\n    <Grid item xs={12} sm container spacing={2} direction=\"column\">\n      <Grid item>\n        <TimingPad />\n      </Grid>\n      <DelayNotice />\n      <Grid item>\n        <MeasureBtn />\n      </Grid>\n      <EditPart />\n      <ActionPart />\n    </Grid>)\n}\n\nexport default RightPanel","import React from \"react\"\nimport makeStyles from \"@material-ui/core/styles/makeStyles\"\nimport Grid from \"@material-ui/core/Grid\"\nimport LeftPanel from \"./LeftPanel\"\nimport RightPanel from \"./RightPanel\"\n\n\nconst useStyles = makeStyles(theme => ({\n  timing: { width: \"100%\", maxWidth: 1000, margin: \"32px auto\" },\n}))\n\nconst TimingPage = () => {\n\n  const cn = useStyles()\n\n  return (\n    <Grid className={cn.timing} container spacing={3}>\n      <LeftPanel />\n      <RightPanel />\n    </Grid>)\n}\n\nexport default TimingPage","import React from \"react\"\nimport { makeStyles } from \"@material-ui/core/styles\"\nimport { useObserver } from \"mobx-react-lite\"\nimport Grid from \"@material-ui/core/Grid\"\nimport Typography from \"@material-ui/core/Typography\"\nimport { useTranslation } from \"react-i18next\"\nimport Slider from \"@material-ui/core/Slider\"\nimport { scope } from \"../../../MappingScope/scope\"\nimport FormControl from \"@material-ui/core/FormControl\"\nimport InputLabel from \"@material-ui/core/InputLabel\"\nimport Select from \"@material-ui/core/Select\"\nimport MenuItem from \"@material-ui/core/MenuItem\"\nimport Divider from \"@material-ui/core/Divider\"\nimport Switch from \"@material-ui/core/Switch\"\nimport { userMessage } from \"../../../Common/Components/GlobalSnackbar\"\nimport FormLabel from \"@material-ui/core/FormLabel\"\nimport NumberField from \"../../../Common/Components/NumberField\"\n\n\nconst useStyles = makeStyles(theme => ({\n  panel: { width: \"100%\", maxWidth: 600, margin: \"32px auto\", },\n}))\n\nfunction timeFormat(date: Date) {\n  const hh = (date.getHours() + 100).toString().substr(1)\n  const mm = (date.getMinutes() + 100).toString().substr(1)\n  const ss = (date.getSeconds() + 100).toString().substr(1)\n  return `${hh}:${mm}:${ss}`\n}\n\nconst SliderWrapper = (props: { children: React.ReactNode, label: React.ReactNode }) =>\n  <Grid item container spacing={2} alignItems=\"center\">\n    <Grid component={FormLabel} item style={{ width: 150 }}>\n      <Typography>{props.label}</Typography></Grid>\n    <Grid item xs>\n      {props.children}\n    </Grid>\n  </Grid>\n\nconst SwitchWrapper = (props: { children: React.ReactNode, label: React.ReactNode }) =>\n  <Grid component={FormLabel} item container spacing={2} alignItems=\"center\">\n    <Grid item xs>\n      <Typography>{props.label}</Typography></Grid>\n    <Grid item>\n      {props.children}\n    </Grid>\n  </Grid>\n\nconst General = () => {\n  const { t, i18n } = useTranslation()\n  return useObserver(() => <>\n    <Grid item>\n      <Typography variant=\"h6\">{t(\"General\")}</Typography>\n    </Grid>\n    <SliderWrapper label={t(\"Song volume\")}>\n      <Slider value={scope.settings.general.song_volume} min={0} max={1} step={0.01} valueLabelDisplay=\"auto\"\n        onChange={(e, v) => scope.settings.general.song_volume = v as number} />\n    </SliderWrapper>\n    <SliderWrapper label={t(\"Effect volume\")}>\n      <Slider value={scope.settings.general.effect_volume} min={0} max={1} step={0.01} valueLabelDisplay=\"auto\"\n        onChange={(e, v) => scope.settings.general.effect_volume = v as number} />\n    </SliderWrapper>\n    <SliderWrapper label={t(\"Background dim\")}>\n      <Slider value={scope.settings.general.background_dim} min={0} max={1} step={0.01} valueLabelDisplay=\"auto\"\n        onChange={(e, v) => scope.settings.general.background_dim = v as number} />\n    </SliderWrapper>\n    <Grid item>\n      <FormControl fullWidth>\n        <InputLabel>{t(\"Preferred language (some items maybe missing)\")}</InputLabel>\n        <Select value={i18n.language}\n          onChange={e => i18n.changeLanguage(e.target.value as string)}>\n          <MenuItem value=\"en\">English</MenuItem>\n          <MenuItem value=\"zh\"></MenuItem>\n          <MenuItem value=\"ja\"></MenuItem>\n        </Select>\n      </FormControl>\n    </Grid>\n  </>)\n}\n\nconst Editor = () => {\n  const { t } = useTranslation()\n\n  const changeKeepPitch = (e: any, v: boolean) => {\n    scope.settings.editor.keep_pitch = v\n    if (v) {\n      userMessage(t(\"This may cause unstable delay of song.\") + \" \" + t(\"Please reload the music to activate\"), \"warning\")\n    } else {\n      userMessage(t(\"Please reload the music to activate\"), \"warning\")\n    }\n  }\n\n  return useObserver(() => <>\n    <Grid item>\n      <Typography variant=\"h6\">{t(\"Editor\")}</Typography>\n    </Grid>\n    <Grid item container spacing={2}>\n      <Grid component={FormLabel} item xs={12}>\n        <Typography>\n          {t(\"Auto save interval (minutes, 0 to disable)\")} &nbsp;&nbsp;\n          {t(\"Last save: {{ time }}\", {\n            time: scope.lastSave ? timeFormat(scope.lastSave) : t(\"Never\")\n          })}\n        </Typography></Grid>\n      <Grid item xs>\n        <Slider value={scope.settings.editor.autosave_interval} min={0} max={10} step={0.5} valueLabelDisplay=\"auto\"\n          onChange={(e, v) => scope.settings.editor.autosave_interval = v as number} />\n      </Grid>\n    </Grid>\n    <SwitchWrapper label={t(\"Keep pitch when changing playback rate\")}>\n      <Switch checked={scope.settings.editor.keep_pitch}\n        onChange={changeKeepPitch} />\n    </SwitchWrapper>\n    <Grid item>\n      <FormControl fullWidth>\n        <InputLabel>{t(\"When changes applied, try to keep notes at\")}</InputLabel>\n        <Select value={scope.settings.editor.justify_find_nearest ? 1 : 0}\n          onChange={e => scope.settings.editor.justify_find_nearest = !!e.target.value}>\n          <MenuItem value={1}>{t(\"Previous time\")}</MenuItem>\n          <MenuItem value={0}>{t(\"Previous beat\")}</MenuItem>\n        </Select>\n      </FormControl>\n    </Grid>\n    <Grid item>\n      <FormControl fullWidth>\n        <InputLabel>{t(\"Grid divisor (of a quarter) to justify notes when justifying timepoint\")}</InputLabel>\n        <Select value={scope.settings.editor.justify_grid_divisor}\n          onChange={e => scope.settings.editor.justify_grid_divisor = e.target.value as number}>\n          <MenuItem value={1}>1 / 1</MenuItem>\n          <MenuItem value={2}>1 / 2</MenuItem>\n          <MenuItem value={3}>1 / 3</MenuItem>\n          <MenuItem value={4}>1 / 4</MenuItem>\n          <MenuItem value={6}>1 / 6</MenuItem>\n          <MenuItem value={8}>1 / 8</MenuItem>\n          <MenuItem value={16}>1 / 16</MenuItem>\n          <MenuItem value={48}>1 / 48</MenuItem>\n        </Select>\n      </FormControl>\n    </Grid>\n    <SwitchWrapper label={t(\"Show cursor information in mapping\")}>\n      <Switch checked={scope.settings.editor.show_info_window}\n        onChange={(e, v) => scope.settings.editor.show_info_window = v} />\n    </SwitchWrapper>\n    <SwitchWrapper label={t(\"Show warning for same position notes\")}>\n      <Switch checked={scope.settings.editor.warn_for_same_pos_notes}\n        onChange={(e, v) => scope.settings.editor.warn_for_same_pos_notes = v} />\n    </SwitchWrapper>\n  </>)\n}\nlet v: number\nconst Game = () => {\n  const { t } = useTranslation()\n  return useObserver(() => <>\n    <Grid item>\n      <Typography variant=\"h6\">{t(\"Game\")}</Typography>\n    </Grid>\n    <Grid item container spacing={2}>\n      <Grid component={FormLabel} item xs={12}>\n        <Typography>{t(\"Judge offset (ms, smaller means you have to tap earlier)\")}</Typography></Grid>\n      <Grid item xs>\n        <Slider value={scope.settings.game.judge_offset} min={-1000} max={1000} step={1} valueLabelDisplay=\"auto\"\n          onChange={(e, v) => scope.settings.game.judge_offset = v as number} />\n      </Grid>\n      <Grid item style={{ width: 72 }}>\n        <NumberField inputProps={{ type: \"number\", step: \"1\", max: \"1000\", min: \"-1000\" }}\n          number={scope.settings.game.judge_offset}\n          validator={s => /^-?[0-9]+$/.test(s) && (v = parseInt(s), v <= 1000 && v >= -1000 && v)}\n          onNumberChange={(e, v) => scope.settings.game.judge_offset = v} />\n      </Grid>\n    </Grid>\n    <Grid item container spacing={2}>\n      <Grid component={FormLabel} item xs={12}>\n        <Typography>{t(\"Visual offset (ms, smaller means notes fall earlier)\")}</Typography></Grid>\n      <Grid item xs>\n        <Slider value={scope.settings.game.visual_offset} min={-1000} max={1000} step={1} valueLabelDisplay=\"auto\"\n          onChange={(e, v) => scope.settings.game.visual_offset = v as number} />\n      </Grid>\n      <Grid item style={{ width: 72 }}>\n        <NumberField inputProps={{ type: \"number\", step: \"1\", max: \"1000\", min: \"-1000\" }}\n          number={scope.settings.game.visual_offset}\n          validator={s => /^-?[0-9]+$/.test(s) && (v = parseInt(s), v <= 1000 && v >= -1000 && v)}\n          onNumberChange={(e, v) => scope.settings.game.visual_offset = v} />\n      </Grid>\n    </Grid>\n    <Grid item container spacing={2}>\n      <Grid component={FormLabel} item style={{ width: 150 }}>\n        <Typography>{t(\"Fall speed\")}</Typography></Grid>\n      <Grid item xs>\n        <Slider value={scope.settings.game.speed} min={1} max={11} step={0.1} valueLabelDisplay=\"auto\"\n          onChange={(e, v) => scope.settings.game.speed = v as number} />\n      </Grid>\n      <Grid item style={{ width: 72 }}>\n        <NumberField inputProps={{ type: \"number\", step: \"0.1\", max: \"11\", min: \"1\" }}\n          number={scope.settings.game.speed}\n          validator={s => /^[0-9]+(.[0-9]?)?$/.test(s) && (v = parseFloat(s), v <= 11 && v >= 1 && v)}\n          onNumberChange={(e, v) => scope.settings.game.speed = v} />\n      </Grid>\n    </Grid>\n    <SliderWrapper label={t(\"Resolution\")}>\n      <Slider value={scope.settings.game.resolution} min={0.2} max={4} step={0.05} valueLabelDisplay=\"auto\"\n        onChange={(e, v) => scope.settings.game.resolution = v as number} />\n    </SliderWrapper>\n    <SliderWrapper label={t(\"Slide bar opacity\")}>\n      <Slider value={scope.settings.game.bar_opaciry} min={0} max={1} step={0.01} valueLabelDisplay=\"auto\"\n        onChange={(e, v) => scope.settings.game.bar_opaciry = v as number} />\n    </SliderWrapper>\n    <SwitchWrapper label={t(\"Show simultaneous line\")}>\n      <Switch checked={scope.settings.game.show_sim_line}\n        onChange={(e, v) => scope.settings.game.show_sim_line = v} />\n    </SwitchWrapper>\n    <SwitchWrapper label={t(\"Lane tap effect\")}>\n      <Switch checked={scope.settings.game.lane_effect}\n        onChange={(e, v) => scope.settings.game.lane_effect = v} />\n    </SwitchWrapper>\n    <SwitchWrapper label={t(\"Mirror\")}>\n      <Switch checked={scope.settings.game.mirror}\n        onChange={(e, v) => scope.settings.game.mirror = v} />\n    </SwitchWrapper>\n    <SwitchWrapper label={t(\"Rhythm visual assist\")}>\n      <Switch checked={scope.settings.game.beat_note}\n        onChange={(e, v) => scope.settings.game.beat_note = v} />\n    </SwitchWrapper>\n  </>)\n}\n\n\nconst SettingsPage = () => {\n\n  const cn = useStyles()\n\n  return (\n    <Grid className={cn.panel} container direction=\"column\" spacing={4}>\n      <General />\n      <Divider style={{ margin: \"32px -24px\", width: \"30%\" }} />\n      <Editor />\n      <Divider style={{ margin: \"32px -24px\", width: \"30%\" }} />\n      <Game />\n    </Grid>)\n}\n\nexport default SettingsPage","import { observable, computed, reaction } from \"mobx\"\nimport { Music } from \"../../states\"\nimport { scope } from \"../../../MappingScope/scope\"\nimport { assert } from \"../../../Common/utils\"\nimport { NoteType } from \"../../../MappingScope/EditMap\"\n\nexport type ToolTypes = \"none\" | \"single\" | \"slide\" | \"delete\"\n\nclass State {\n\n  @observable private _viewposition = 0\n\n  // some offset that let the progress line can be a little higher than view port bottom\n  @computed get viewOffset() { return 100 / this.timeHeightFactor }\n\n  @computed get viewduration() {\n    return Music.duration - this.viewOffset\n  }\n  getViewposition = () => {\n    if (this.tracking) return Music.position() - this.viewOffset\n    return this._viewposition\n  }\n  setViewposition = (v: number) => {\n    const offset = this.viewOffset\n    if (v < -offset) v = -offset\n    if (v > Music.duration - offset) v = Music.duration - 0.05 - offset\n    if (this.tracking) Music.seek(v + offset)\n    else this._viewposition = v\n  }\n  @observable tracking = false\n  @observable timeHeightFactor = 400\n  @observable division = 1\n  @observable tool = \"none\" as ToolTypes\n\n  // we mirror 1. notes layer (and bar layer) 2. action preview layer 3. input event handler\n  @observable mirror = false\n\n  @computed get paddedDuration() {\n    return Music.duration * 1.2\n  }\n\n\n  @observable private mapChangeCounter = 1\n  @computed get samePosNotes() {\n    const notes = new Set<number>()\n    if (this.mapChangeCounter) {\n      const NoteSig = (n: NoteType) => `${n.timepoint}:${n.offset}:${n.lane}`\n      for (const slide of scope.map.slidelist) {\n        let from = assert(scope.map.notes.get(slide.notes[0]))\n        for (let i = 1; i < slide.notes.length; i++) {\n          const to = assert(scope.map.notes.get(slide.notes[i]))\n          if (from.timepoint === to.timepoint && from.offset === to.offset) {\n            notes.add(from.id)\n            notes.add(to.id)\n          }\n          from = to\n        }\n      }\n      const set = new Set<string>()\n      for (const n of scope.map.notelist) {\n        const sig = NoteSig(n)\n        if (set.has(sig)) notes.add(n.id)\n        set.add(sig)\n      }\n    }\n    return notes\n  }\n\n  @computed get noteListOrdered() {\n    const list: NoteType[] = []\n    if (this.mapChangeCounter) {\n      for (const n of scope.map.notelist) {\n        list.push(n)\n      }\n    }\n    return list.sort((a, b) => a.realtimecache - b.realtimecache)\n  }\n\n  constructor() {\n    reaction(() => this.tracking, t => {\n      const offset = 100 / this.timeHeightFactor\n      if (!t) this._viewposition = Music.position() - offset\n    })\n    scope.map.changeListeners.add(() => this.mapChangeCounter++)\n  }\n}\n\nexport const MappingState = new State()\n\nexport function GridD1() {\n  const tps = scope.map.timepointlist\n  const list: Array<{ time: number; name: string }> = []\n  let endtime = 0\n  for (let i = 0; i < tps.length; i++) {\n    const tp = tps[i]\n    endtime = i < tps.length - 1 ? tps[i + 1].time : Music.duration\n    let beat = 1\n    while (true) {\n      const time = tp.time + tp.ticktimecache * 48 * beat\n      if (time >= endtime) break\n      const bar = ((beat / tp.bpb) | 0) + 1\n      const innerbeat = (beat % tp.bpb) + 1\n      list.push({\n        time,\n        name: `${i + 1}:${bar}:${innerbeat}`\n      })\n      beat++\n    }\n  }\n  return list\n}\n\n\nexport function GridD2() {\n  const tps = scope.map.timepointlist\n  const list: number[] = []\n  let endtime = 0\n  for (let i = 0; i < tps.length; i++) {\n    const tp = tps[i]\n    endtime = i < tps.length - 1 ? tps[i + 1].time : Music.duration\n    let beat = 0\n    const offset = tp.ticktimecache * 24\n    while (true) {\n      const time = tp.time + tp.ticktimecache * 48 * beat + offset\n      if (time >= endtime) break\n      list.push(time)\n      beat++\n    }\n  }\n  return list\n}\n\nexport function GridD3() {\n  const tps = scope.map.timepointlist\n  const list: number[] = []\n  let endtime = 0\n  for (let i = 0; i < tps.length; i++) {\n    const tp = tps[i]\n    endtime = i < tps.length - 1 ? tps[i + 1].time : Music.duration\n    let beat_3 = 1\n    while (true) {\n      const time = tp.time + tp.ticktimecache * 16 * beat_3\n      if (time >= endtime) break\n      list.push(time)\n      beat_3++\n      if (beat_3 % 3 === 0) beat_3++\n    }\n  }\n  return list\n}\n\nexport function GridD4() {\n  const tps = scope.map.timepointlist\n  const list: number[] = []\n  let endtime = 0\n  for (let i = 0; i < tps.length; i++) {\n    const tp = tps[i]\n    endtime = i < tps.length - 1 ? tps[i + 1].time : Music.duration\n    let beat_2 = 0.5\n    while (true) {\n      const time = tp.time + tp.ticktimecache * 24 * beat_2\n      if (time >= endtime) break\n      list.push(time)\n      beat_2++\n    }\n  }\n  return list\n}\n","import React, { useEffect } from \"react\"\nimport { useObserver } from \"mobx-react-lite\"\nimport { MappingState, ToolTypes } from \"./sharedState\"\nimport { makeStyles } from \"@material-ui/core/styles\"\nimport Box from \"@material-ui/core/Box\"\nimport Grid from \"@material-ui/core/Grid\"\nimport { useTranslation } from \"react-i18next\"\nimport RadioGroup from \"@material-ui/core/RadioGroup\"\nimport FormControlLabel from \"@material-ui/core/FormControlLabel\"\nimport Radio from \"@material-ui/core/Radio\"\nimport assets from \"../../assets\"\nimport HelpIcon from '@material-ui/icons/Help'\nimport ZoomInIcon from '@material-ui/icons/ZoomIn'\nimport ZoomOutIcon from '@material-ui/icons/ZoomOut'\nimport FormLabel from \"@material-ui/core/FormLabel\"\nimport Tooltip from \"@material-ui/core/Tooltip\"\nimport FormControl from \"@material-ui/core/FormControl\"\nimport InputLabel from \"@material-ui/core/InputLabel\"\nimport Select from \"@material-ui/core/Select\"\nimport MenuItem from \"@material-ui/core/MenuItem\"\nimport IconButton from \"@material-ui/core/IconButton\"\nimport Switch from \"@material-ui/core/Switch\"\nimport Typography from \"@material-ui/core/Typography\"\nimport { addHotkey } from \"../../../Common/hooks\"\n\nconst useStyles = makeStyles(theme => ({\n  tools: {\n    position: \"relative\", flexGrow: 0.5, flexShrink: 1.5, maxWidth: \"calc(40% - 100px)\", overflowX: \"hidden\", overflowY: \"auto\",\n    \"-webkit-overflow-scrolling\": \"touch\",\n    \"&>*\": { maxWidth: 300, position: \"absolute\", right: 0, top: 30 }\n  },\n  toolimg: { width: 80 }\n}))\n\nexport const zoomin = () => {\n  let f = MappingState.timeHeightFactor * 1.414\n  if (f > 1580) f = 1600\n  MappingState.timeHeightFactor = f\n}\nexport const zoomout = () => {\n  let f = MappingState.timeHeightFactor / 1.414\n  if (f < 120) f = 100\n  MappingState.timeHeightFactor = f\n}\n\nconst SelectTool = () => {\n  const cn = useStyles()\n  const { t } = useTranslation()\n\n  useEffect(() => addHotkey(\"1\", () => MappingState.tool = \"none\"), [])\n  useEffect(() => addHotkey(\"2\", () => MappingState.tool = \"single\"), [])\n  useEffect(() => addHotkey(\"3\", () => MappingState.tool = \"slide\"), [])\n  useEffect(() => addHotkey(\"4\", () => MappingState.tool = \"delete\"), [])\n\n  return useObserver(() =>\n    <Grid item>\n      <Box display=\"block\" my={2} component={FormLabel}>\n        <Grid container alignItems=\"center\" spacing={2}>\n          <Grid item>{t(\"Tool\")}</Grid>\n          <Grid item>\n            <Tooltip placement=\"right\"\n              title={<Typography variant=\"body2\">\n                {t(\"Double click to switch flick\")} <br />\n                {t(\"Right click to delete note(s)\")} <br />\n                {t(\"Click the slide bar to add mid note\")} <br />\n                {t(\"Hold ctrl and drag to multi-select & copy notes\")}\n              </Typography>}>\n              <HelpIcon fontSize=\"small\" />\n            </Tooltip></Grid>\n        </Grid>\n      </Box>\n      <RadioGroup value={MappingState.tool}\n        onChange={(e, v) => MappingState.tool = v as ToolTypes}>\n        <FormControlLabel value=\"none\" control={<Radio />}\n          label={t(\"None\")} title={t(\"Hotkey: {{ hotkey }}\", { hotkey: \"1\" })} />\n        <FormControlLabel value=\"single\" control={<Radio />}\n          label={<img className={cn.toolimg} src={assets.note_normal} alt=\"Single / Flick\" />}\n          title={t(\"Hotkey: {{ hotkey }}\", { hotkey: \"2\" })} />\n        <FormControlLabel value=\"slide\" control={<Radio />}\n          label={<img className={cn.toolimg} src={assets.note_long} alt=\"Slide\" />}\n          title={t(\"Hotkey: {{ hotkey }}\", { hotkey: \"3\" })} />\n        <FormControlLabel value=\"delete\" control={<Radio />}\n          label={t(\"Delete\")} title={t(\"Hotkey: {{ hotkey }}\", { hotkey: \"4 / Right click\" })} />\n      </RadioGroup>\n    </Grid>)\n}\n\nconst SelectDivisor = () => {\n  const { t } = useTranslation()\n  return useObserver(() =>\n    <Grid item>\n      <FormControl fullWidth>\n        <InputLabel>{t(\"Grid divisor (of a quarter note)\")}</InputLabel>\n        <Select fullWidth value={MappingState.division}\n          onChange={e => MappingState.division = e.target.value as number} >\n          <MenuItem value={1}>1 / 1</MenuItem>\n          <MenuItem value={2}>1 / 2</MenuItem>\n          <MenuItem value={3}>1 / 3</MenuItem>\n          <MenuItem value={4}>1 / 4</MenuItem>\n          <MenuItem value={6}>1 / 6</MenuItem>\n          <MenuItem value={8}>1 / 8</MenuItem>\n          <MenuItem value={16}>1 / 16</MenuItem>\n          <MenuItem value={48}>1 / 48</MenuItem>\n        </Select>\n      </FormControl>\n    </Grid>)\n}\n\nconst ZoomInOut = () => {\n  const { t } = useTranslation()\n\n  useEffect(() => addHotkey(\"+,=\", zoomin), [])\n  useEffect(() => addHotkey(\"-,_\", zoomout), [])\n\n  useEffect(() => {\n    const el = document.getElementById(\"root\")\n    const listener = (e: WheelEvent) => {\n      if (e.ctrlKey) {\n        e.stopPropagation()\n        e.preventDefault()\n        if (e.deltaY < 0) zoomin()\n        else zoomout()\n      }\n    }\n    el?.addEventListener(\"wheel\", listener)\n    return () => el?.removeEventListener(\"wheel\", listener)\n  }, [])\n\n  return useObserver(() =>\n    <Grid item container spacing={2}>\n      <Grid item>\n        <IconButton onClick={zoomin} disabled={MappingState.timeHeightFactor > 1580}\n          title={t(\"Hotkey: {{ hotkey }}\", { hotkey: \"+ / ctrl + wheel\" })}>\n          <ZoomInIcon /></IconButton>\n      </Grid>\n      <Grid item>\n        <IconButton onClick={zoomout} disabled={MappingState.timeHeightFactor < 120}\n          title={t(\"Hotkey: {{ hotkey }}\", { hotkey: \"- / ctrl + wheel\" })}>\n          <ZoomOutIcon /></IconButton>\n      </Grid>\n    </Grid>)\n}\n\nconst OtherTools = () => {\n  const { t } = useTranslation()\n\n  useEffect(() => addHotkey(\"f\", () => MappingState.tracking = !MappingState.tracking), [])\n  useEffect(() => addHotkey(\"tab\", (e) => {\n    MappingState.mirror = !MappingState.mirror; e.stopPropagation(); e.preventDefault()\n  }), [])\n\n  return useObserver(() =>\n    <Grid item container spacing={2}>\n      <Grid item>\n        <FormControlLabel label={t(\"Follow\")} title={t(\"Hotkey: {{ hotkey }}\", { hotkey: \"f\" })}\n          control={<Switch checked={MappingState.tracking}\n            onChange={(e, v) => MappingState.tracking = v} />} />\n      </Grid>\n      <Grid item>\n        <FormControlLabel label={t(\"Mirror\")} title={t(\"Hotkey: {{ hotkey }}\", { hotkey: \"tab\" })}\n          control={<Switch checked={MappingState.mirror}\n            onChange={(e, v) => MappingState.mirror = v} />} />\n      </Grid>\n    </Grid>)\n}\n\nconst Tools = () => {\n  const cn = useStyles()\n  return (\n    <Box className={cn.tools}>\n      <Grid container spacing={4} direction=\"column\">\n        <SelectTool />\n        <SelectDivisor />\n        <ZoomInOut />\n        <OtherTools />\n      </Grid>\n    </Box>)\n}\n\nexport default Tools","import { makeStyles } from \"@material-ui/core/styles\"\n\nexport const useStyles = makeStyles(theme => ({\n  track: { position: \"relative\", flexGrow: 1, maxWidth: 600, },\n  panel: { width: \"100%\", position: \"absolute\", bottom: 0, willChange: \"transform\" },\n  layer: { width: \"100%\", height: \"100%\", position: \"absolute\", pointerEvents: \"none\", },\n}))\n\nexport const useNoteStyles = makeStyles(theme => ({\n  note: {\n    transform: \"translateY(50%) scale(1.2)\", width: \"10%\", position: \"absolute\",\n    pointerEvents: \"auto\", minHeight: \"10px\",\n  },\n  noevent: { pointerEvents: \"none\" },\n  slidebar: {\n    background: \"greenyellow\", opacity: 0.2, width: \"10%\", position: \"absolute\", pointerEvents: \"auto\",\n  },\n  selection: {\n    position: \"absolute\", pointerEvents: \"none\", background: \"gray\",\n    opacity: 0.3, border: \"2px solid rgba(80, 182, 255, 0.8)\"\n  }\n}))","import { observable, computed, autorun, reaction } from \"mobx\"\nimport { MappingState } from \"../sharedState\"\nimport { scope } from \"../../../../MappingScope/scope\"\nimport { useRef, useEffect } from \"react\"\nimport { itemList } from \"../../../../Common/utils\"\nimport { NoteType } from \"../../../../MappingScope/EditMap\"\n\nclass State {\n\n  @observable pointerClientX = 0\n  @observable pointerClientY = 0\n\n  @observable panelRef: React.MutableRefObject<HTMLDivElement | null> = {\n    current: null\n  }\n\n  @computed get pointerTime() {\n    const panel = this.panelRef.current\n    if (!panel) return 0\n    const rect = panel.getBoundingClientRect()\n    let res = (rect.bottom - this.pointerClientY) / MappingState.timeHeightFactor\n    return res\n  }\n\n  @computed get pointerLeftPercent() {\n    const panel = this.panelRef.current\n    if (!panel) return -1\n    const rect = panel.getBoundingClientRect()\n    if (MappingState.mirror)\n      return (rect.right - this.pointerClientX) / rect.width * 100\n    else\n      return (this.pointerClientX - rect.left) / rect.width * 100\n  }\n\n  laneFromLeftPercent = (percent: number) => {\n    const left = percent - 15\n    if (left < 0) return -1\n    if (left >= 70) return -1\n    return (left / 10) | 0\n  }\n\n  @computed get pointerLane() {\n    return this.laneFromLeftPercent(this.pointerLeftPercent)\n  }\n\n  @computed get pointerBeat() {\n    return scope.map.calcNearestPosition(this.pointerTime, MappingState.division)\n  }\n\n  @observable slideNote1Beat: State[\"pointerBeat\"]\n  @observable slideNote1Lane = -1\n\n  @observable preventClick = 0\n\n  @observable draggingNote = -1\n\n  @observable selecting = false\n  @observable selectingStartTime = 0\n  @observable selectingStartLeft = 0\n  @observable selectingNotes: number[] = []\n\n  @observable selectedNotes = new Set<number>()\n\n  getSelectedNotes = () => {\n    const selected = new Set<NoteType>()\n    for (const nid of this.selectedNotes) {\n      const n = scope.map.notes.get(nid)\n      if (n) selected.add(n)\n    }\n    for (const nid of this.selectingNotes) {\n      const n = scope.map.notes.get(nid)\n      if (n) selected.add(n)\n    }\n    return itemList(selected)\n  }\n\n  @computed get draggingSelected() {\n    const n = scope.map.notes.get(this.draggingNote)\n    if (!n) return false\n    return this.selectedNotes.has(n.id)\n  }\n\n  constructor() {\n    reaction(() => MappingState.tool, tool => {\n      this.slideNote1Beat = undefined\n    })\n  }\n}\n\nexport const state = new State()\n\nexport function useMirror() {\n\n  const layer = useRef<HTMLDivElement>(null)\n\n  useEffect(() => autorun(() => {\n    if (layer.current) {\n      if (MappingState.mirror)\n        layer.current.style.transform = `scaleX(-1)`\n      else\n        layer.current.style.transform = `none`\n    }\n  }), [])\n\n  return layer\n}\n","import React from \"react\"\n\nexport const Cross = (props: React.SVGProps<SVGSVGElement>) => {\n  return (\n    <svg viewBox=\"0 0 500 500\" {...props}>\n      <g stroke={props.color || props.style?.color} strokeWidth=\"20\" fill=\"none\">\n        <path d=\"M 0 250 H 500\"></path>\n        <path d=\"M 250 0 V 500\"></path>\n      </g>\n    </svg>)\n}\n\nexport const Rect = (props: React.SVGProps<SVGSVGElement>) => {\n  return (\n    <svg viewBox=\"0 0 500 200\" {...props}>\n      <g stroke={props.color || props.style?.color} strokeWidth=\"40\" fill=\"none\">\n        <path d=\"M 0 0 H 500 V 200 H 0 V 0\"></path>\n      </g>\n    </svg>)\n}","import React from \"react\"\nimport { useStyles, useNoteStyles } from \"./styles\"\nimport { useObserver } from \"mobx-react-lite\"\nimport { state, useMirror } from \"./state\"\nimport { MappingState } from \"../sharedState\"\nimport { Cross, Rect } from \"./SVGs\"\nimport { entryList } from \"../../../../Common/utils\"\nimport { scope } from \"../../../../MappingScope/scope\"\nimport { useMapChange } from \"../../../states\"\n\nconst createStyle = (time: number, lane: number) => {\n  return {\n    bottom: time * MappingState.timeHeightFactor + \"px\",\n    left: lane * 10 + 15 + \"%\"\n  }\n}\n\nconst PointerPos = () => {\n  const cn = useNoteStyles()\n  const style = useObserver(() => {\n    if (state.selecting) return\n    if (state.pointerLane < 0) return\n    const beat = state.pointerBeat\n    if (!beat) return\n    let color = \"#afafaf\"\n    switch (MappingState.tool) {\n      case \"single\": color = \"#0088ff\"; break\n      case \"slide\": color = \"#00ff88\"; break\n      case \"delete\": color = \"#ff4444\"; break\n    }\n    return {\n      ...createStyle(beat.realtime, state.pointerLane), color\n    }\n  })\n  if (!style) return null\n  return <Cross className={cn.note + \" \" + cn.noevent} style={style} />\n}\n\nconst SlideNote1 = () => {\n  const cn = useNoteStyles()\n  const style = useObserver(() => {\n    if (!state.slideNote1Beat) return\n    const time = state.slideNote1Beat.timepoint.time + state.slideNote1Beat.timepoint.ticktimecache * state.slideNote1Beat.offset\n    return {\n      ...createStyle(time, state.slideNote1Lane), color: \"#00ff88\"\n    }\n  })\n  if (!style) return null\n  return <Rect className={cn.note + \" \" + cn.noevent} style={style} />\n}\n\nconst DragOneNote = () => {\n  const cn = useNoteStyles()\n  const style = useObserver(() => {\n    if (state.draggingNote < 0) return\n    if (state.pointerLane < 0) return\n    const n = scope.map.notes.get(state.draggingNote)\n    if (!n) return\n    const beat = state.pointerBeat\n    if (!beat) return\n    const time = beat.realtime\n    if (time === n.realtimecache && state.pointerLane === n.lane) return\n    return {\n      from: { ...createStyle(n.realtimecache, n.lane), color: \"#a0a0a0\" },\n      to: { ...createStyle(time, state.pointerLane), color: \"#e0e0e0\" }\n    }\n  })\n  if (!style) return null\n  return <>\n    <Rect className={cn.note + \" \" + cn.noevent} style={style.from} />\n    <Rect className={cn.note + \" \" + cn.noevent} style={style.to} />\n  </>\n}\n\nconst SelectedNotes = () => {\n  const cn = useNoteStyles()\n  useMapChange()\n  const props = useObserver(() => {\n    const className = cn.note + \" \" + cn.noevent\n    const map = new Map<number, React.SVGProps<SVGSVGElement>>()\n    for (const n of state.getSelectedNotes()) {\n      map.set(n.id, {\n        key: n.id, style: { ...createStyle(n.realtimecache, n.lane), color: \"rgba(102, 183, 255, 0.8)\" }, className\n      })\n    }\n    return entryList(map).map(x => x[1])\n  })\n  if (props.length <= 0) return null\n  return <>\n    {props.map(p => <Rect {...p} />)}\n  </>\n}\n\nconst Selection = () => {\n  const cn = useNoteStyles()\n  const style = useObserver(() => {\n    if (!state.selecting) return\n    const l1 = state.selectingStartLeft\n    const l2 = state.pointerLeftPercent\n    const t1 = state.selectingStartTime\n    const t2 = state.pointerTime\n    return {\n      left: Math.min(l1, l2) + \"%\",\n      width: Math.abs(l1 - l2) + \"%\",\n      bottom: Math.min(t1, t2) * MappingState.timeHeightFactor + \"px\",\n      height: Math.abs(t1 - t2) * MappingState.timeHeightFactor + \"px\",\n    }\n  })\n  if (!style) return null\n  return <div className={cn.selection} style={style}></div>\n}\n\nconst ActionPreview = () => {\n\n  const cn = useStyles()\n  const layer = useMirror()\n\n  return (\n    <div className={cn.layer} ref={layer}>\n      <SlideNote1 />\n      <SelectedNotes />\n      <DragOneNote />\n      <Selection />\n      <PointerPos />\n    </div>)\n}\n\nexport default ActionPreview","import React from \"react\"\nimport { makeStyles } from \"@material-ui/core/styles\"\nimport { GridD1, MappingState, GridD2, GridD3, GridD4 } from \"../sharedState\"\nimport { useMapChange, Music } from \"../../../states\"\nimport { useObserver } from \"mobx-react-lite\"\nimport { range, TimeToString } from \"../../../../Common/utils\"\nimport { useStyles as useLayerStyle } from \"./styles\"\nimport { scope } from \"../../../../MappingScope/scope\"\n\nconst useStyles = makeStyles(theme => ({\n  vertline: { borderLeft: \"1.2px solid lightgray\", height: \"100%\", position: \"absolute\", pointerEvents: \"none\" },\n  beatline1: {\n    position: \"absolute\", textAlign: \"right\", width: \"80%\", right: \"5%\", borderBottom: \"1.2px lightgray solid\",\n  },\n  subline: { position: \"absolute\", width: \"70%\", left: \"15%\", },\n  beatline2: { borderBottom: \"1.2px solid gray\" },\n  beatline3: { borderBottom: \"1.2px solid firebrick\" },\n  beatline4: { borderBottom: \"1.2px solid darkslateblue\" },\n  time: { position: \"absolute\", left: 0 },\n  bpm: { position: \"absolute\", right: 0 },\n  timepoint: {\n    position: \"absolute\", color: \"aquamarine\", width: \"95%\",\n    borderBottom: \"1.2px aquamarine solid\", height: \"1.5em\"\n  },\n}))\n\nconst bottomstyle = (time: number) => ({ bottom: (MappingState.timeHeightFactor * time) + \"px\" })\n\nconst vertlines = range(15, 90, 10)\n\nconst LaneAndTime = () => {\n  const cn = useStyles()\n\n  return useObserver(() => <>\n    <>\n      {vertlines.map(left =>\n        <div key={left} className={cn.vertline} style={{ left: left + \"%\" }} />)}\n    </><>\n      {range(0, Music.duration, 2).map(time =>\n        <div key={time} className={cn.time} style={bottomstyle(time)}>{TimeToString(time)}</div>)}\n    </>\n  </>)\n}\n\nconst DivisorLines = () => {\n\n  const cn = useStyles()\n  useMapChange()\n\n  return useObserver(() => <>\n    <>\n      {GridD1().map(({ time, name }, index) =>\n        <div key={index} className={cn.beatline1} style={bottomstyle(time)}>{name}</div>)}\n    </><>\n      {MappingState.division % 2 === 0 && GridD2().map((time, index) =>\n        <div key={index} className={cn.subline + \" \" + cn.beatline2} style={bottomstyle(time)} />)}\n    </><>\n      {MappingState.division % 3 === 0 && GridD3().map((time, index) =>\n        <div key={index} className={cn.subline + \" \" + cn.beatline3} style={bottomstyle(time)} />)}\n    </><>\n      {MappingState.division % 4 === 0 && GridD4().map((time, index) =>\n        <div key={index} className={cn.subline + \" \" + cn.beatline4} style={bottomstyle(time)} />)}\n    </>\n  </>)\n}\n\nconst TimepointStart = () => {\n\n  const cn = useStyles()\n  useMapChange()\n\n  return useObserver(() => <>\n    {scope.map.timepointlist.map(tp =>\n      <div className={cn.timepoint} key={tp.id} style={bottomstyle(tp.time)}>\n        <div className={cn.time}>{TimeToString(tp.time)}</div>\n        <div className={cn.bpm}>{tp.bpm}</div>\n      </div>)}\n  </>)\n}\n\n\nconst GridLayer = () => {\n  const cn = useLayerStyle()\n  return (\n    <div className={cn.layer}>\n      <LaneAndTime />\n      <DivisorLines />\n      <TimepointStart />\n    </div>)\n}\n\nexport default GridLayer","import React, { useMemo } from \"react\"\nimport { NoteType } from \"../../../../MappingScope/EditMap\"\nimport { MappingState } from \"../sharedState\"\nimport { useStyles, useNoteStyles } from \"./styles\"\nimport assets from \"../../../assets\"\nimport { assert, neverHappen } from \"../../../../Common/utils\"\nimport { scope } from \"../../../../MappingScope/scope\"\nimport { useMapChange, Music } from \"../../../states\"\nimport { useMirror, state } from \"./state\"\nimport { useObserver } from \"mobx-react-lite\"\n\nlet dragPointer = -1\nconst downEventHandler = (nid: number) => {\n  return (e: React.MouseEvent<HTMLImageElement> | React.TouchEvent<HTMLImageElement>) => {\n    e.stopPropagation()\n    e.preventDefault()\n    const note = assert(scope.map.notes.get(nid))\n    if (dragPointer < 0) {\n      if (\"buttons\" in e) {\n        if (!(e.buttons & 3)) return\n        dragPointer = e.button\n      } else {\n        dragPointer = e.changedTouches[0].identifier\n      }\n    }\n    state.draggingNote = nid\n    if (!e.ctrlKey && !state.selectedNotes.has(note.id))\n      state.selectedNotes.clear()\n    state.slideNote1Beat = undefined\n  }\n}\n\nconst handleUp = (e: MouseEvent | TouchEvent) => {\n  if (\"buttons\" in e) {\n    if (e.button !== dragPointer) return\n  } else {\n    if (e.changedTouches[0].identifier !== dragPointer) return\n  }\n  dragPointer = -1\n  if (state.draggingNote >= 0) {\n    const note = assert(scope.map.notes.get(state.draggingNote))\n    const draggingSelected = state.draggingSelected\n    state.draggingNote = -1 // important: after get draggingselected !!!\n    if (!state.pointerBeat) return\n    if (state.pointerLane < 0) return\n    const dt = state.pointerBeat.realtime - note.realtimecache\n    const dl = state.pointerLane - note.lane\n    if (!dt && !dl) return\n\n    const before = new Set<number>()\n    const copy = e.ctrlKey\n    if (copy)\n      for (const n of scope.map.notelist) before.add(n.id)\n\n    if (draggingSelected) {\n      if (copy)\n        scope.map.copyMany(state.getSelectedNotes(), dt, 0, Music.duration, dl, MappingState.division)\n      else\n        scope.map.moveMany(state.getSelectedNotes(), dt, 0, Music.duration, dl, MappingState.division)\n    } else {\n      if (copy)\n        scope.map.copyMany([note], dt, 0, Music.duration, dl, MappingState.division)\n      else\n        scope.map.moveMany([note], dt, 0, Music.duration, dl, MappingState.division)\n    }\n\n    if (copy && scope.map.notelist.length !== before.size) {\n      state.selectedNotes.clear()\n      for (const n of scope.map.notelist) {\n        if (!before.has(n.id)) {\n          state.selectedNotes.add(n.id)\n        }\n      }\n    }\n\n    state.preventClick++\n    setTimeout(() => state.preventClick--, 50)\n  }\n}\nwindow.addEventListener(\"mouseup\", handleUp)\nwindow.addEventListener(\"touchend\", handleUp)\n\nconst removeNote = (note: NoteType) => {\n  if (state.selectedNotes.has(note.id)) {\n    scope.map.removeNotes(state.getSelectedNotes())\n  } else {\n    scope.map.removeNotes([note])\n  }\n}\n\nconst clickEventHandler = (nid: number) => {\n  return (e: React.MouseEvent) => {\n    e.stopPropagation()\n    e.preventDefault()\n    // if (state.preventClick) return\n    const note = assert(scope.map.notes.get(nid))\n    if (e.ctrlKey) {\n      if (state.selectedNotes.has(note.id)) state.selectedNotes.delete(note.id)\n      else state.selectedNotes.add(note.id)\n    } else {\n      switch (MappingState.tool) {\n        case \"delete\":\n          removeNote(note)\n          break\n      }\n    }\n  }\n}\n\nconst doubleClickHandler = (nid: number) => {\n  return (e: React.MouseEvent) => {\n    e.stopPropagation()\n    e.preventDefault()\n    if (state.preventClick) return\n    const note = assert(scope.map.notes.get(nid))\n    if (note.type === \"slide\") {\n      const s = assert(scope.map.slides.get(note.slide))\n      if (note.id === s.notes[s.notes.length - 1])\n        scope.map.toggleFlickend(s.id)\n    } else {\n      scope.map.toggleFlick(note)\n    }\n  }\n}\n\nconst contextMenuHandler = (nid: number) => {\n  return (e: React.MouseEvent<HTMLImageElement>) => {\n    e.stopPropagation()\n    e.preventDefault()\n    if (state.preventClick) return\n    const note = assert(scope.map.notes.get(nid))\n    removeNote(note)\n  }\n}\n\nconst Note = ({ note }: { note: NoteType }) => {\n\n  const cn = useNoteStyles()\n\n  const style = useObserver(() => {\n    const left = (note.lane * 10 + 15) + \"%\"\n    const bottom = (MappingState.timeHeightFactor * note.realtimecache) + \"px\"\n    return { left, bottom }\n  })\n\n  const downHandler = useMemo(() => downEventHandler(note.id), [note.id])\n  const ctxmenuHandler = useMemo(() => contextMenuHandler(note.id), [note.id])\n  const doubleHandler = useMemo(() => doubleClickHandler(note.id), [note.id])\n  const clickHandler = useMemo(() => clickEventHandler(note.id), [note.id])\n\n  const props: React.DetailedHTMLProps<React.ImgHTMLAttributes<HTMLImageElement>, HTMLImageElement> = {\n    onMouseDown: downHandler,\n    onContextMenu: ctxmenuHandler,\n    onDoubleClick: doubleHandler,\n    onClick: clickHandler,\n    style, draggable: false,\n    className: cn.note\n  }\n\n  switch (note.type) {\n    case \"single\": return <img alt=\"Single\" src={assets.note_normal} {...props} />\n    case \"flick\": return <img alt=\"Flick\" src={assets.note_flick} {...props} />\n    case \"slide\":\n      const slide = assert(scope.map.slides.get(note.slide))\n      if (note.id === slide.notes[0]) {\n        return <img alt=\"Slide start\" src={assets.note_long} {...props} />\n      } else if (note.id === slide.notes[slide.notes.length - 1]) {\n        if (slide.flickend)\n          return <img alt=\"Flick end\" src={assets.note_flick} {...props} />\n        else\n          return <img alt=\"Slide end\" src={assets.note_long} {...props} />\n      } else {\n        return <img alt=\"Slide mid\" src={assets.note_slide_among} {...props} />\n      }\n    default: neverHappen()\n  }\n}\n\nconst NotesLayer = () => {\n\n  const cn = useStyles()\n  const layer = useMirror()\n\n  useMapChange()\n  return (\n    <div className={cn.layer} ref={layer}>\n      {scope.map.notelist.map(n => <Note key={n.id} note={n} />)}\n    </div>)\n}\n\nexport default NotesLayer","import React, { useRef, useEffect } from \"react\"\nimport { makeStyles } from \"@material-ui/core/styles\"\nimport { autorun } from \"mobx\"\nimport { Music } from \"../../../states\"\nimport { startAnimation, stopAnimation } from \"../../../../Common/animation\"\nimport { MappingState } from \"../sharedState\"\n\nconst useStyles = makeStyles(theme => ({\n  progress: {\n    position: \"absolute\", width: \"80%\", left: \"10%\", borderBottom: \"2px solid red\",\n    bottom: 0, willChange: \"transform\", opacity: 0.7,\n  }\n}))\n\nconst transY = (time: number, viewTime: number) => MappingState.timeHeightFactor * (viewTime - time)\n\nconst transpx = (t: number) => `translateY(${t}px)`\n\nconst ProgressLine = () => {\n  const cn = useStyles()\n  const div = useRef<HTMLDivElement>(null)\n\n  useEffect(() => autorun(() => {\n    if (div.current) {\n      const time = Music.position()\n      const viewTime = MappingState.getViewposition()\n      const current = transY(time, viewTime)\n      const target = transY(Music.duration, viewTime)\n      if (Music.playing && !MappingState.tracking) {\n        startAnimation(div.current, \"transform\", current, target, transpx, Music.remaintime())\n      } else {\n        stopAnimation(div.current, \"transform\", current, transpx)\n      }\n    }\n  }), [])\n\n  return <div className={cn.progress} ref={div} />\n}\n\nexport default ProgressLine","import React from \"react\"\nimport { makeStyles } from \"@material-ui/core/styles\"\nimport { useObserver } from \"mobx-react-lite\"\nimport { state } from \"./state\"\nimport { TimeToString } from \"../../../../Common/utils\"\n\nconst useStyles = makeStyles(theme => ({\n  root: { position: \"absolute\", width: 0, left: 0, height: 0, bottom: 0, color: \"lightgray\", userSelect: \"text\" },\n  window: {\n    position: \"absolute\", width: 100, height: 84, right: \"calc(12px + 3vw)\", bottom: 48, padding: 12,\n    background: \"rgba(127, 127, 127, 0.15)\", borderRadius: 4, textAlign: \"right\"\n  }\n}))\n\nfunction calcGCD(a: number, b: number) {\n  a = a | 0\n  b = b | 0\n  if (a < 0 || b <= 0) throw new Error(\"Can not get gcd\")\n  while (true) {\n    const c = (a % b) | 0\n    if (c === 0) return b\n    a = b\n    b = c\n  }\n}\n\nconst InfoWindow = () => {\n\n  const cn = useStyles()\n\n  const info = useObserver(() => {\n    const beat = state.pointerBeat\n    if (!beat || beat.offset < 0) return\n    const bpb = beat.timepoint.bpb\n    const beatcount = (beat.offset / 48) | 0\n    let offset = beat.offset % 48\n    while (offset < 0) offset += 48\n    const gcd = calcGCD(offset, 48)\n    return {\n      time: beat.realtime,\n      name: `${beat.timepointIndex + 1} : ${((beatcount / bpb) | 0) + 1} : ${(beatcount % bpb) + 1}`,\n      divide: `${offset / gcd} / ${48 / gcd}`\n    }\n  })\n\n  return (\n    <div className={cn.root}>\n      <div className={cn.window}>\n        {info && <>\n          <div>{TimeToString(info.time)}</div>\n          <div>{info.name}</div>\n          <div>{info.divide}</div>\n        </>}\n      </div>\n    </div>)\n}\n\nexport default InfoWindow","import React, { useEffect, useMemo, useState } from \"react\"\nimport { NoteType, SlideNote } from \"../../../../MappingScope/EditMap\"\nimport { MappingState } from \"../sharedState\"\nimport { useStyles, useNoteStyles } from \"./styles\"\nimport { useMapChange } from \"../../../states\"\nimport { autorun } from \"mobx\"\nimport { scope } from \"../../../../MappingScope/scope\"\nimport { assert } from \"../../../../Common/utils\"\nimport { state, useMirror } from \"./state\"\nimport { useObserver } from \"mobx-react-lite\"\n\nconst clickHandler = (slide: number) => {\n  return (e: React.MouseEvent<HTMLDivElement>) => {\n    const beat = state.pointerBeat\n    const lane = state.pointerLane\n    if (!beat || lane < 0) return\n    e.stopPropagation()\n\n    scope.map.addSlideMid(slide, beat.timepoint.id, beat.offset, lane)\n  }\n}\n\nconst Bar = ({ from, to, layerWidth }: { from: NoteType, to: NoteType, layerWidth: number }) => {\n\n  const cn = useNoteStyles()\n\n  const style = useObserver(() => {\n    const bottom = from.realtimecache * MappingState.timeHeightFactor\n    const top = to.realtimecache * MappingState.timeHeightFactor\n    const dh = top - bottom\n    const dw = layerWidth * (from.lane - to.lane) * 0.1\n    return {\n      bottom: bottom + \"px\",\n      height: dh + \"px\",\n      transform: `skew(${Math.atan2(dw, dh)}rad)`,\n      left: (from.lane + to.lane) * 5 + 15 + \"%\",\n    }\n  })\n\n  const slide = (from as SlideNote).slide\n\n  const handler = useMemo(() => clickHandler(slide), [slide])\n\n  return <div className={cn.slidebar} onClick={handler} style={style}></div>\n}\n\nconst forEachBar = (cb: (from: SlideNote, to: SlideNote) => any) => {\n  for (const slide of scope.map.slidelist) {\n    let from = assert(scope.map.notes.get(slide.notes[0]))\n    for (let i = 1; i < slide.notes.length; i++) {\n      const to = assert(scope.map.notes.get(slide.notes[i]))\n      cb(from as SlideNote, to as SlideNote)\n      from = to\n    }\n  }\n}\n\nconst BarLayer = () => {\n\n  const cn = useStyles()\n  const layer = useMirror()\n  const [layerWidth, setLayerWidth] = useState(100)\n\n  useEffect(() => {\n    const listener = () => state.panelRef.current && setLayerWidth(state.panelRef.current.clientWidth)\n    const dispose = autorun(listener)\n    window.addEventListener(\"resize\", listener)\n    return () => { window.removeEventListener(\"resize\", listener); dispose() }\n  }, [])\n\n  useMapChange()\n\n  const list: React.ReactNode[] = []\n  forEachBar((from, to) =>\n    list.push(<Bar key={from.id + \":\" + to.id} from={from} to={to} layerWidth={layerWidth} />))\n\n  return (\n    <div className={cn.layer} ref={layer}>\n      {list}\n    </div>)\n}\n\nexport default BarLayer","import React, { useEffect } from \"react\"\nimport { useStyles, useNoteStyles } from \"./styles\"\nimport { useObserver } from \"mobx-react-lite\"\nimport { useMirror } from \"./state\"\nimport { MappingState } from \"../sharedState\"\nimport { Rect } from \"./SVGs\"\nimport { itemList } from \"../../../../Common/utils\"\nimport { scope } from \"../../../../MappingScope/scope\"\nimport i18n from \"../../../../i18n\"\nimport { userMessage } from \"../../../../Common/Components/GlobalSnackbar\"\n\nconst WaringRect = ({ noteid }: { noteid: number }) => {\n  const cn = useNoteStyles()\n  const style = useObserver(() => {\n    const note = scope.map.notes.get(noteid)\n    if (!note) return\n    const time = note.realtimecache\n    return {\n      bottom: time * MappingState.timeHeightFactor + \"px\",\n      left: note.lane * 10 + 15 + \"%\",\n      color: \"#ff8800\",\n      transform: \"translateY(50%) scale(1.4)\"\n    }\n  })\n  if (!style) return null\n  return <Rect className={cn.note + \" \" + cn.noevent} style={style} />\n}\n\nconst WarningLayer = () => {\n\n  const cn = useStyles()\n  const layer = useMirror()\n\n  const notes = useObserver(() => MappingState.samePosNotes)\n\n  useEffect(() => {\n    if (notes.size > 0)\n      userMessage(i18n.t(\"Some notes are in the same position\"), \"warning\")\n  }, [notes.size])\n\n  return (\n    <div className={cn.layer} ref={layer}>\n      {itemList(notes).map(id => <WaringRect key={id} noteid={id} />)}\n    </div>)\n}\n\nexport default WarningLayer","\ntype FuncList<T = number> = (index: number) => T\n\n/**\n * find the index to insert the item makes the list still ordered\n * @param list    - a function represets the list\n * @param listlen - list length\n * @param target  - search target\n * @returns `[ index, equal ]`\n */\nexport function binarySearch(list: FuncList, listlen: number, target: number): [number, boolean] {\n  let l = 0\n  let r = listlen\n  if (listlen <= 0) return [0, false]\n  if (target < list(l)) return [0, false]\n\n  while (l < r - 1) {\n    const m = ((l + r) / 2) | 0\n    const v = list(m)\n    if (target < v) r = m\n    else if (v < target) l = m\n    else return [m + 1, true]\n  }\n  // l = m   -->   l >= r + 1   --> list(l) not tested equality\n  return [l + 1, list(l) === target]\n}","import React, { useEffect } from \"react\"\nimport { autorun } from \"mobx\"\nimport { startAnimation, stopAnimation } from \"../../../../Common/animation\"\nimport { Music } from \"../../../states\"\nimport { MappingState } from \"../sharedState\"\nimport ActionPreview from \"./ActionPreview\"\nimport GridLayer from \"./GridLayer\"\nimport NotesLayer from \"./NotesLayer\"\nimport ProgressLine from \"./ProgressLine\"\nimport { state } from \"./state\"\nimport { useStyles } from \"./styles\"\nimport InfoWindow from \"./InfoWindow\"\nimport { scope } from \"../../../../MappingScope/scope\"\nimport BarLayer from \"./BarLayer\"\nimport WarningLayer from \"./WarningLayer\"\nimport { binarySearch } from \"../../../../Common/binarySearch\"\n\nconst transY = (viewTime: number) => `translateY(${MappingState.timeHeightFactor * viewTime}px)`\n\nconst handleScroll = (e: React.WheelEvent<HTMLDivElement>) => {\n  e.stopPropagation()\n  const dt = e.deltaY / MappingState.timeHeightFactor\n  const target = MappingState.getViewposition() - dt\n  MappingState.setViewposition(target)\n}\n\nconst flushPointerPos = (e: MouseEvent | TouchEvent) => {\n  if (\"buttons\" in e) {\n    state.pointerClientX = e.clientX\n    state.pointerClientY = e.clientY\n  } else {\n    const touches = Array.from(e.changedTouches)\n    if (touches.length <= 0) return\n    state.pointerClientX = touches.reduce((a, b) => a + b.clientX, 0) / touches.length\n    state.pointerClientY = touches.reduce((a, b) => a + b.clientY, 0) / touches.length\n  }\n}\n\nlet selectPointer = -1\nconst handleDown = (e: MouseEvent | TouchEvent) => {\n  e.stopPropagation()\n  e.preventDefault()\n  if (document.activeElement && \"blur\" in document.activeElement) {\n    (document.activeElement as HTMLElement).blur()\n  }\n  if (selectPointer < 0) {\n    if (\"buttons\" in e) {\n      if (!(e.buttons & 3)) return\n      selectPointer = e.button\n    } else {\n      selectPointer = e.changedTouches[0].identifier\n    }\n  }\n  flushPointerPos(e)\n  state.selectingStartLeft = state.pointerLeftPercent\n  state.selectingStartTime = state.pointerTime\n  if (!e.ctrlKey) {\n    state.selectedNotes.clear()\n  }\n}\nconst stopSelect = () => {\n  if (!state.selecting) return\n  selectPointer = -1\n  state.selecting = false\n  for (const n of state.selectingNotes)\n    state.selectedNotes.add(n)\n  state.selectingNotes = []\n  state.preventClick++\n  setTimeout(() => state.preventClick--, 50)\n}\nwindow.addEventListener(\"mouseup\", e => {\n  if (e.button === selectPointer) stopSelect()\n})\nwindow.addEventListener(\"touchend\", e => {\n  if (e.changedTouches[0].identifier === selectPointer) stopSelect()\n})\n\nconst handleMove = (e: MouseEvent | TouchEvent) => {\n  flushPointerPos(e)\n  if (!(\"buttons\" in e) || e.buttons & 3) {\n    if (state.draggingNote < 0 && !state.selecting)\n      if (Math.abs(state.pointerTime - state.selectingStartTime) > 50 / MappingState.timeHeightFactor\n        || Math.abs(state.pointerLeftPercent - state.selectingStartLeft) > 10) {\n        state.selecting = true\n        state.slideNote1Beat = undefined\n      }\n  } else {\n    if (state.selecting) stopSelect()\n  }\n  if (state.selecting) {\n    const list = MappingState.noteListOrdered\n    const start = binarySearch(i => list[i].realtimecache, list.length, state.pointerTime)[0]\n    const end = binarySearch(i => list[i].realtimecache, list.length, state.selectingStartTime)[0]\n    state.selectingNotes = (list.slice(Math.min(start, end), Math.max(start, end)))\n      .filter(x => {\n        const left = x.lane * 10 + 20\n        const min = Math.min(state.pointerLeftPercent, state.selectingStartLeft)\n        const max = Math.max(state.pointerLeftPercent, state.selectingStartLeft)\n        if (left >= min && left <= max) return true\n        return false\n      }).map(x => x.id)\n  }\n}\n\nconst handleClick = (e: React.MouseEvent<HTMLDivElement>) => {\n  flushPointerPos(e.nativeEvent)\n  e.stopPropagation()\n  e.preventDefault()\n  if (state.preventClick) return\n  const beat = state.pointerBeat\n  const lane = state.pointerLane\n  if (!beat || lane < 0) return\n  switch (MappingState.tool) {\n    case \"single\":\n      scope.map.addSingle(beat.timepoint.id, beat.offset, lane)\n      break\n    case \"slide\":\n      if (state.slideNote1Beat) {\n        scope.map.addSlide(state.slideNote1Beat.timepoint.id, state.slideNote1Beat.offset, state.slideNote1Lane,\n          beat.timepoint.id, beat.offset, lane)\n        state.slideNote1Beat = undefined\n      } else {\n        state.slideNote1Beat = beat\n        state.slideNote1Lane = lane\n      }\n      break\n    default:\n      return\n  }\n}\n\nconst Track = () => {\n  const cn = useStyles()\n\n  useEffect(() => autorun(() => {\n    if (state.panelRef.current) {\n      state.panelRef.current.style.height = (MappingState.paddedDuration * MappingState.timeHeightFactor) + \"px\"\n      if (Music.playing && MappingState.tracking) {\n        startAnimation(state.panelRef.current, \"transform\", MappingState.getViewposition(),\n          MappingState.viewduration, transY, Music.remaintime())\n      } else {\n        stopAnimation(state.panelRef.current, \"transform\", MappingState.getViewposition(), transY)\n      }\n    }\n  }), [])\n\n  useEffect(() => {\n    window.addEventListener(\"mousedown\", handleDown)\n    window.addEventListener(\"mousemove\", handleMove)\n    return () => {\n      window.removeEventListener(\"mousedown\", handleDown)\n      window.removeEventListener(\"mousemove\", handleMove)\n    }\n  }, [])\n\n  return (\n    <div className={cn.track}>\n      <div className={cn.panel} ref={state.panelRef} onWheel={handleScroll} onClick={handleClick}>\n        <GridLayer />\n        <BarLayer />\n        <NotesLayer />\n        {scope.settings.editor.warn_for_same_pos_notes && <WarningLayer />}\n        <ActionPreview />\n      </div>\n      {scope.settings.editor.show_info_window && <InfoWindow />}\n      <ProgressLine />\n    </div>)\n}\n\nexport default Track","import { MappingState, GridD1 } from \"../sharedState\"\nimport { range, TimeToString, assert } from \"../../../../Common/utils\"\nimport { scope } from \"../../../../MappingScope/scope\"\nimport { NoteType } from \"../../../../MappingScope/EditMap\"\n\nexport const barTimeHeightFactor = 30\n\nconst getX = (lane: number) => lane * 10 + 15\nconst getY = (time: number) => (MappingState.paddedDuration - time) * barTimeHeightFactor\n\n\nfunction drawLine(ctx: CanvasRenderingContext2D, xfrom: number, xto: number, y: number) {\n  ctx.beginPath()\n  ctx.moveTo(xfrom, y)\n  ctx.lineTo(xto, y)\n  ctx.stroke()\n}\nfunction drawBar(ctx: CanvasRenderingContext2D, fromx: number, fromy: number, tox: number, toy: number) {\n  ctx.beginPath()\n  ctx.lineTo(fromx, fromy)\n  ctx.lineTo(fromx + 10, fromy)\n  ctx.lineTo(tox + 10, toy)\n  ctx.lineTo(tox, toy)\n  ctx.fill()\n}\nfunction drawDiamond(ctx: CanvasRenderingContext2D, x: number, y: number) {\n  ctx.beginPath()\n  ctx.lineTo(x, y)\n  ctx.lineTo(x + 5, y + 3)\n  ctx.lineTo(x + 10, y)\n  ctx.lineTo(x + 5, y - 3)\n  ctx.fill()\n}\nfunction drawOval(ctx: CanvasRenderingContext2D, x: number, y: number) {\n  ctx.beginPath()\n  ctx.lineTo(x, y)\n  ctx.arcTo(x + 5, y + 5, x + 10, y, 7)\n  ctx.arcTo(x + 5, y - 5, x, y, 7)\n  ctx.fill()\n}\nfunction drawCircle(ctx: CanvasRenderingContext2D, x: number, y: number) {\n  ctx.beginPath()\n  ctx.ellipse(x, y, 5, 5, 0, 0, 2 * Math.PI)\n  ctx.fill()\n}\n\nexport const drawScrollBar = (canvas: HTMLCanvasElement) => {\n  const ctx = canvas.getContext(\"2d\")\n  if (!ctx) return\n  const timelist = range(0, MappingState.paddedDuration, 2)\n  ctx.clearRect(0, 0, canvas.width, canvas.height)\n  ctx.font = \"12px\"\n  ctx.lineWidth = 1\n\n  ctx.strokeStyle = \"gray\"\n  for (const t of GridD1()) {\n    drawLine(ctx, 15, 85, getY(t.time))\n  }\n\n  ctx.fillStyle = \"aquamarine\"\n  ctx.strokeStyle = \"aquamarine\"\n  for (const t of scope.map.timepointlist) {\n    const y = getY(t.time)\n    drawLine(ctx, 0, 100, y)\n    ctx.fillText(t.bpm + \"\", 80, y - 3)\n  }\n\n  ctx.fillStyle = \"white\"\n  for (const t of timelist) {\n    ctx.fillText(TimeToString(t).split(\".\")[0], 0, getY(t) - 3)\n  }\n\n  ctx.fillStyle = \"rgb(173,255,47,0.2)\"\n  for (const s of scope.map.slidelist) {\n    let from = assert(scope.map.notes.get(s.notes[0]))\n    let to: NoteType\n    for (let i = 1; i < s.notes.length; i++) {\n      to = assert(scope.map.notes.get(s.notes[i]))\n      drawBar(ctx, getX(from.lane), getY(from.realtimecache), getX(to.lane), getY(to.realtimecache))\n      from = to\n    }\n  }\n\n  for (const n of scope.map.notelist) {\n    switch (n.type) {\n      case \"single\":\n        ctx.fillStyle = \"rgba(21,224,225)\"\n        drawOval(ctx, getX(n.lane), getY(n.realtimecache))\n        break\n      case \"flick\":\n        ctx.fillStyle = \"rgba(255,59,114)\"\n        drawDiamond(ctx, getX(n.lane), getY(n.realtimecache))\n        break\n      case \"slide\":\n        const slide = assert(scope.map.slides.get(n.slide))\n        ctx.fillStyle = \"rgba(1,219,1)\"\n        if (n.id === slide.notes[0]) {\n          drawOval(ctx, getX(n.lane), getY(n.realtimecache))\n        } else if (n.id === slide.notes[slide.notes.length - 1]) {\n          if (slide.flickend) {\n            ctx.fillStyle = \"rgba(255,59,114)\"\n            drawDiamond(ctx, getX(n.lane), getY(n.realtimecache))\n          } else {\n            drawOval(ctx, getX(n.lane), getY(n.realtimecache))\n          }\n        } else {\n          ctx.strokeStyle = \"rgba(1,219,1)\"\n          ctx.lineWidth = 2\n          const x = getX(n.lane)\n          drawLine(ctx, x, x + 10, getY(n.realtimecache))\n        }\n        break\n    }\n  }\n}\n\nexport const drawWarning = (canvas: HTMLCanvasElement) => {\n  const ctx = canvas.getContext(\"2d\")\n  if (!ctx) return\n  ctx.fillStyle = \"#ff8800\"\n  for (const nid of MappingState.samePosNotes) {\n    const n = scope.map.notes.get(nid)\n    if (!n) return\n    const y = getY(n.realtimecache)\n    drawCircle(ctx, 93, y)\n  }\n}","import { observable, computed } from \"mobx\"\nimport { MappingState } from \"../sharedState\"\nimport { barTimeHeightFactor } from \"./drawCanvas\"\n\nclass State {\n  @observable containerHeight = 0\n  @computed get barHeight() { return MappingState.paddedDuration * barTimeHeightFactor }\n  @computed get viewportheight() { return this.containerHeight / MappingState.timeHeightFactor * barTimeHeightFactor }\n  \n  progressTransY = (playtime: number) => `translateY(${- barTimeHeightFactor * playtime}px)`\n  barTransY = (viewtime: number) => {\n    const height = this.barHeight\n    if (height <= this.containerHeight) return \"\"\n    const p = viewtime / MappingState.paddedDuration\n    const transx = this.containerHeight * p - height * p\n    return `translateY(${-transx}px)`\n  }\n  viewTransY = (viewtime: number) => {\n    let h = this.containerHeight\n    if (this.barHeight < this.containerHeight) h = this.barHeight\n    const transx = (h * viewtime) / MappingState.paddedDuration\n    return `translateY(${-transx}px)`\n  }\n}\n\nexport const state = new State()\n","import React, { useRef, useEffect } from \"react\"\nimport { makeStyles } from \"@material-ui/core/styles\"\nimport { autorun } from \"mobx\"\nimport { Music } from \"../../../states\"\nimport { startAnimation, stopAnimation } from \"../../../../Common/animation\"\nimport { state } from \"./state\"\n\nconst useStyles = makeStyles(theme => ({\n  progress: {\n    position: \"absolute\", width: \"100%\", borderBottom: \"2px solid red\",\n    bottom: 0, willChange: \"transform\", opacity: 0.7\n  },\n}))\n\nconst ProgressLine = () => {\n\n  const cn = useStyles()\n  const div = useRef<HTMLDivElement>(null)\n\n  useEffect(() => autorun(() => {\n    if (div.current) {\n      const current = Music.position()\n      if (Music.playing) {\n        startAnimation(div.current, \"transform\", current, Music.duration, state.progressTransY, Music.remaintime())\n      } else {\n        stopAnimation(div.current, \"transform\", current, state.progressTransY)\n      }\n    }\n  }), [])\n\n  return <div className={cn.progress} ref={div}></div>\n}\n\nexport default ProgressLine","import React, { useRef, useEffect } from \"react\"\nimport { makeStyles } from \"@material-ui/core/styles\"\nimport { autorun } from \"mobx\"\nimport { Music, useMapChange } from \"../../../states\"\nimport { startAnimation, stopAnimation } from \"../../../../Common/animation\"\nimport { state } from \"./state\"\nimport { MappingState } from \"../sharedState\"\nimport { drawScrollBar, drawWarning } from \"./drawCanvas\"\nimport ProgressLine from \"./ProgressLine\"\nimport { scope } from \"../../../../MappingScope/scope\"\n\n\nconst useStyles = makeStyles(theme => ({\n  bar: { position: \"absolute\", width: \"100%\", bottom: 0, willChange: \"transform\" },\n  canvas: { width: \"100%\", height: \"100%\" },\n}))\n\nconst Canvas = () => {\n  const cn = useStyles()\n  const canvas = useRef<HTMLCanvasElement>(null)\n\n  const change = useMapChange()\n\n  useEffect(() => autorun(() => {\n    if (canvas.current && change) {\n      canvas.current.height = state.barHeight\n      drawScrollBar(canvas.current)\n      if (scope.settings.editor.warn_for_same_pos_notes)\n        drawWarning(canvas.current)\n    }\n  }), [change])\n\n  return <canvas ref={canvas} className={cn.canvas} width={100}></canvas>\n}\n\nconst handelMouseTouch = (e: React.MouseEvent<HTMLDivElement> | React.TouchEvent<HTMLDivElement>) => {\n  let clientY: number\n  if (\"buttons\" in e) {\n    if (!(e.buttons & 3)) return\n    clientY = e.clientY\n  } else {\n    clientY = e.changedTouches[0].clientY\n  }\n  e.stopPropagation()\n\n  const target = (e.currentTarget.getBoundingClientRect().bottom - clientY - state.viewportheight / 2)\n    / state.barHeight * MappingState.paddedDuration\n\n  MappingState.setViewposition(target)\n}\n\nconst CanvasBar = () => {\n\n  const cn = useStyles()\n  const bar = useRef<HTMLDivElement>(null)\n\n  useEffect(() => autorun(() => {\n    if (bar.current) {\n      bar.current.style.height = state.barHeight + \"px\"\n      if (Music.playing && MappingState.tracking) {\n        startAnimation(bar.current, \"transform\", MappingState.getViewposition(),\n          MappingState.viewduration, state.barTransY, Music.remaintime())\n      } else {\n        stopAnimation(bar.current, \"transform\", MappingState.getViewposition(), state.barTransY)\n      }\n    }\n  }), [])\n\n  return (\n    <div className={cn.bar} ref={bar} onTouchStart={handelMouseTouch}\n      onMouseDown={handelMouseTouch}>\n      <Canvas />\n      <ProgressLine />\n    </div>)\n}\n\nexport default CanvasBar","import React, { useRef, useEffect } from \"react\"\nimport { autorun } from \"mobx\"\nimport { Music } from \"../../../states\"\nimport { startAnimation, stopAnimation } from \"../../../../Common/animation\"\nimport { state } from \"./state\"\nimport { MappingState } from \"../sharedState\"\nimport { makeStyles } from \"@material-ui/core/styles\"\n\nconst useStyles = makeStyles(theme => ({\n  viewport: {\n    position: \"absolute\", width: \"100%\", backgroundColor: \"#fff\", opacity: 0.2, transition: \"opacity 0.2s\",\n    bottom: 0, willChange: \"opacity, transform\", \"&:hover\": { opacity: 0.4 }\n  },\n}))\n\nconst touchState = {\n  identifier: -1,\n  /**\n   * the offset from touch/mouse point to the bottom of viewport rectangle\n   * positive\n   */\n  offsetY: 0,\n\n  container: null as HTMLElement | null\n}\n\nconst handelMouseTouchStart = (e: React.MouseEvent<HTMLDivElement> | React.TouchEvent<HTMLDivElement>) => {\n  e.stopPropagation()\n  const viewport = e.currentTarget\n  const bottom = viewport.getBoundingClientRect().bottom\n  if (touchState.identifier < 0) {\n    if (\"buttons\" in e) {\n      if (!(e.buttons & 3)) return\n      touchState.identifier = e.button\n      touchState.offsetY = bottom - e.clientY\n    } else {\n      touchState.identifier = e.changedTouches[0].identifier\n      touchState.offsetY = bottom - e.changedTouches[0].clientY\n    }\n  }\n  touchState.container = e.currentTarget.parentElement\n}\n\nconst handleMove = (e: MouseEvent | TouchEvent) => {\n  let clientY: number\n  if (\"buttons\" in e) {\n    if (touchState.identifier !== e.button) return\n    clientY = e.clientY\n  } else {\n    if (touchState.identifier !== e.changedTouches[0].identifier) return\n    clientY = e.changedTouches[0].clientY\n  }\n  if (!touchState.container) return\n  e.stopPropagation()\n\n  const TimeYtoBottom = touchState.container.getBoundingClientRect().bottom - clientY - touchState.offsetY\n\n  let h = state.containerHeight\n  if (state.barHeight < state.containerHeight) h = state.barHeight\n\n  let target = TimeYtoBottom / h * MappingState.paddedDuration\n\n  MappingState.setViewposition(target)\n}\n\n\nwindow.addEventListener(\"mouseup\", () => touchState.identifier = -1)\nwindow.addEventListener(\"mouseleave\", () => touchState.identifier = -1)\ndocument.addEventListener(\"mousemove\", handleMove)\ndocument.addEventListener(\"touchmove\", handleMove)\n\nconst ViewPort = () => {\n\n  const cn = useStyles()\n  const div = useRef<HTMLDivElement>(null)\n\n  useEffect(() => autorun(() => {\n    if (div.current) {\n      div.current.style.height = state.viewportheight + \"px\"\n      if (Music.playing && MappingState.tracking) {\n        startAnimation(div.current, \"transform\", MappingState.getViewposition(),\n          MappingState.viewduration, state.viewTransY, Music.remaintime())\n      } else {\n        stopAnimation(div.current, \"transform\", MappingState.getViewposition(), state.viewTransY)\n      }\n    }\n  }), [])\n\n  return <div className={cn.viewport} ref={div}\n    onMouseDown={handelMouseTouchStart}\n    onTouchStart={handelMouseTouchStart} />\n}\n\nexport default ViewPort\n","import React, { useRef, useEffect } from \"react\"\nimport { makeStyles } from \"@material-ui/core/styles\"\nimport { state } from \"./state\"\nimport CanvasBar from \"./CanvasBar\"\nimport ViewPort from \"./ViewPort\"\nimport { MappingState } from \"../sharedState\"\n\nconst useStyles = makeStyles(theme => ({\n  scrollbar: { position: \"relative\", width: 100 },\n}))\n\nconst handleScroll = (e: React.WheelEvent) => {\n  e.stopPropagation()\n  const dt = e.deltaY / 100\n  const target = MappingState.getViewposition() - dt\n  MappingState.setViewposition(target)\n}\n\nconst ScrollBar = () => {\n  const cn = useStyles()\n  const container = useRef<HTMLDivElement>(null)\n\n  useEffect(() => {\n    const listener = () => container.current && (state.containerHeight = container.current.clientHeight)\n    listener()\n    window.addEventListener(\"resize\", listener)\n    return () => window.removeEventListener(\"resize\", listener)\n  }, [])\n\n\n  return (\n    <div className={cn.scrollbar} ref={container} onWheel={handleScroll}>\n      <CanvasBar />\n      <ViewPort />\n    </div>)\n}\n\nexport default ScrollBar","import { once, assert, itemList } from \"../../../Common/utils\"\nimport { AudioSource, loadFromUrl, AudioInstance } from \"../../../Common/AudioCtx\"\nimport assets from \"../../assets\"\nimport { useEffect } from \"react\"\nimport { MappingState } from \"./sharedState\"\nimport { Music } from \"../../states\"\nimport { binarySearch } from \"../../../Common/binarySearch\"\nimport { createAnimLoop } from \"../../../Common/hooks\"\nimport { autorun, observable } from \"mobx\"\nimport { scope } from \"../../../MappingScope/scope\"\n\nconst sounds = once(() => ({\n  perfect: AudioSource.from(loadFromUrl(assets.perfect)).load(),\n  flick: AudioSource.from(loadFromUrl(assets.flick)).load(),\n}))\n\nconst images = once(() => {\n  const list: (keyof typeof assets)[] = [\"note_flick\", \"note_long\", \"note_normal\", \"note_slide_among\"]\n  list.forEach(async key => {\n    const res = await fetch(assets[key])\n    const file = await res.blob()\n    assets[key] = URL.createObjectURL(file)\n  })\n})\n\nlet noSoundUntil = -1\n\nconst soundlist = observable({\n  get list() {\n    return MappingState.noteListOrdered.map(x => {\n      if (x.type === \"single\") return { time: x.realtimecache, type: \"single\" }\n      if (x.type === \"flick\") return { time: x.realtimecache, type: \"flick\" }\n      const slide = assert(scope.map.slides.get(x.slide))\n      if (x.id === slide.notes[slide.notes.length - 1] && slide.flickend)\n        return { time: x.realtimecache, type: \"flick\" }\n      return { time: x.realtimecache, type: \"single\" }\n    })\n  }\n})\n\nconst toBeStopped = new Set<AudioInstance>()\n\nfunction animloop() {\n  if (Music.playing) {\n    const list = soundlist.list\n    const position = Music.position()\n\n    if (list.length <= 0) return\n    let [index] = binarySearch(i => list[i].time, list.length, position)\n    while (index < list.length && list[index].time <= position) index++\n    if (index >= list.length) return\n\n    const time = list[index].time\n    if (time > position + 0.05) return\n    if (time < noSoundUntil) return\n    noSoundUntil = time + 0.01 * Music.playbackrate\n\n    const s = sounds()\n\n    while (index < list.length && list[index].time < noSoundUntil) {\n      const au = new AudioInstance(list[index].type === \"single\" ? s.perfect : s.flick)\n      au.play((list[index].time - position) / Music.playbackrate)\n      au.onend.add(() => toBeStopped.delete(au))\n      toBeStopped.add(au)\n      index++\n    }\n\n  } else {\n    noSoundUntil = -1\n    for (const au of itemList(toBeStopped)) {\n      au.stop()\n    }\n    toBeStopped.clear()\n  }\n}\n\nautorun(() => {\n  if (Music.position()) noSoundUntil = -1\n})\n\nexport function useSoundEffect() {\n\n  useEffect(() => {\n    images()\n  }, [])\n\n  useEffect(() => createAnimLoop(animloop), [])\n\n  useEffect(() => autorun(() => {\n    const s = sounds()\n    s.perfect.volume = scope.settings.general.effect_volume\n    s.flick.volume = scope.settings.general.effect_volume\n  }), [])\n}","import React from \"react\"\nimport { makeStyles } from \"@material-ui/core/styles\"\nimport Box from \"@material-ui/core/Box\"\nimport Tools from \"./Tools\"\nimport Track from \"./Track\"\nimport ScrollBar from \"./ScrollBar\"\nimport { useSoundEffect } from \"./soundEffect\"\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    position: \"absolute\", width: \"100%\", height: \"100%\", display: \"flex\",\n    justifyContent: \"space-between\", alignItems: \"stretch\", overflow: \"hidden\"\n  },\n}))\n\n\nconst MappingPage = () => {\n\n  const cn = useStyles()\n\n  useSoundEffect()\n\n  return (\n    <Box className={cn.root} onContextMenu={e => { e.stopPropagation(); e.preventDefault() }}>\n      <Tools />\n      <Track />\n      <ScrollBar />\n    </Box>)\n}\n\nexport default MappingPage","import React, { useEffect } from \"react\"\nimport { observable, reaction } from \"mobx\"\nimport { useObserver } from \"mobx-react-lite\"\nimport MetaPage from \"./Pages/MetaPage\"\nimport TimingPage from \"./Pages/TimingPage\"\nimport SettingsPage from \"./Pages/SettingsPage\"\nimport MappingPage from \"./Pages/MappingPage\"\n\nconst routes = {\n  \"#meta\": MetaPage,\n  \"#timing\": TimingPage,\n  \"#mapping\": MappingPage,\n  \"#settings\": SettingsPage,\n}\nexport type RoutePath = keyof typeof routes\n\nconst router = observable({\n  path: window.location.hash as RoutePath || \"#meta\"\n})\n\nreaction(() => router.path, p => window.location.hash = p)\n\nexport const useHashRoutes = (): [RoutePath, React.ComponentType<{}>] => {\n\n  const path = useObserver(() => router.path)\n\n  const ContentComponent = routes[path]\n\n  useEffect(() => {\n    if (!ContentComponent) {\n      router.path = \"#meta\"\n    }\n  }, [ContentComponent])\n\n  return [path, ContentComponent || (() => null)]\n}\n\nexport const NavigateTo = (path: RoutePath) => router.path = path\n\n","import React from \"react\"\nimport Fade from \"@material-ui/core/Fade\"\nimport Box from \"@material-ui/core/Box\"\nimport { useHashRoutes } from \"../routes\"\nimport { makeStyles } from \"@material-ui/core/styles\"\n\nconst useStyles = makeStyles(theme => ({\n  content: { flexGrow: 1, position: \"relative\", overflow: \"hidden\", },\n  wrapping: {\n    width: \"100%\", height: \"100%\", overflowX: \"hidden\", overflowY: \"auto\",\n    \"-webkit-overflow-scrolling\": \"touch\", position: \"absolute\"\n  }\n}))\n\nconst MainContent = () => {\n\n  const cn = useStyles()\n  const [path, Component] = useHashRoutes()\n\n  return (\n    <Fade in key={path}>\n      <Box className={cn.content}>\n        <Box className={cn.wrapping}>\n          <Component />\n        </Box>\n      </Box>\n    </Fade>)\n}\n\n\nexport default MainContent","import { useEffect, useState } from \"react\"\n\nlet statelistener = () => { }\n\nexport function useGameState() {\n\n  const [hash, setHash] = useState(\"\")\n\n  useEffect(() => {\n    const listener = () => {\n      setHash(window.location.hash)\n    }\n    statelistener = listener\n    window.addEventListener(\"popstate\", listener)\n    return () => window.addEventListener(\"popstate\", listener)\n  }, [])\n\n  return hash === \"#game\"\n}\n\nexport function startGame() {\n  window.history.pushState({}, \"\", \"#game\")\n  statelistener()\n}\n","import React, { useEffect, useState } from \"react\"\nimport Box from \"@material-ui/core/Box\"\nimport IconButton from \"@material-ui/core/IconButton\"\nimport { makeStyles } from \"@material-ui/core/styles\"\nimport Tab from \"@material-ui/core/Tab\"\nimport Tabs from \"@material-ui/core/Tabs\"\nimport PlayCircleFilledIcon from '@material-ui/icons/PlayCircleFilled'\nimport RedoIcon from '@material-ui/icons/Redo'\nimport SaveAltIcon from '@material-ui/icons/SaveAlt'\nimport UndoIcon from '@material-ui/icons/Undo'\nimport DoneOutlineIcon from '@material-ui/icons/DoneOutline'\nimport { useHashRoutes, NavigateTo } from \"../routes\"\nimport { scope } from \"../../MappingScope/scope\"\nimport { useMapChange } from \"../states\"\nimport { addHotkey } from \"../../Common/hooks\"\nimport { useTranslation } from \"react-i18next\"\nimport { userMessage } from \"../../Common/Components/GlobalSnackbar\"\nimport { startGame } from \"../../GamePage/gamestate\"\nimport i18n from \"../../i18n\"\nimport { useObserver } from \"mobx-react-lite\"\n\nconst useStyles = makeStyles(theme => ({\n  tabs: { flexGrow: 1, height: \"100%\" }\n}))\n\nconst HeaderTabs = () => {\n\n  const cn = useStyles()\n  const { t } = useTranslation()\n  const [path] = useHashRoutes()\n\n  const tabs = {\n    \"#meta\": t(\"Meta\"),\n    \"#timing\": t(\"Timing\"),\n    \"#mapping\": t(\"Mapping\"),\n    \"#settings\": t(\"Settings\")\n  }\n\n  return (\n    <Tabs indicatorColor=\"primary\" className={cn.tabs} value={path in tabs ? path : \"#meta\"} onChange={(e, v) => NavigateTo(v)}>\n      {Object.keys(tabs).map(key =>\n        <Tab key={key} value={key} label={tabs[key as keyof typeof tabs]} />)}\n    </Tabs>)\n}\n\nconst save = (e: { preventDefault: () => void }) => {\n  scope.save()\n  e.preventDefault()\n  userMessage(i18n.t(\"Saved into browser storage\"), \"success\")\n}\n\nconst SaveIcon = () => {\n  const [noticed, setNoticed] = useState(0)\n  const lastsave = useObserver(() => scope.lastSave)\n\n  useEffect(() => {\n    if (!lastsave || lastsave.getTime() === noticed) return\n    const to = setTimeout(() => {\n      setNoticed(lastsave.getTime())\n    }, 3000)\n    return () => clearTimeout(to)\n  })\n\n\n  if (!lastsave || lastsave.getTime() === noticed)\n    return <SaveAltIcon />\n  return <DoneOutlineIcon />\n}\n\nconst HeaderActions = () => {\n\n  useMapChange()\n\n  useEffect(() => addHotkey(\"ctrl+z\", scope.map.Undo), [])\n  useEffect(() => addHotkey(\"ctrl+shift+z\", scope.map.Redo), [])\n  useEffect(() => addHotkey(\"ctrl+s\", save), [])\n\n  const { t } = useTranslation()\n\n  const actionlist1 = [\n    {\n      children: <UndoIcon />, onClick: scope.map.Undo, disabled: !scope.map.canUndo,\n      title: t(\"Hotkey: {{ hotkey }}\", { hotkey: \"ctrl + z\" })\n    },\n    {\n      children: <RedoIcon />, onClick: scope.map.Redo, disabled: !scope.map.canRedo,\n      title: t(\"Hotkey: {{ hotkey }}\", { hotkey: \"ctrl + shift + z\" })\n    },\n    { children: <SaveIcon />, onClick: save, title: t(\"Hotkey: {{ hotkey }}\", { hotkey: \"ctrl + s\" }) },\n  ]\n  const actionlist2 = [\n    { children: <PlayCircleFilledIcon />, onClick: startGame },\n  ]\n\n  return <>\n    {actionlist1.map((item, i) =>\n      <Box key={i}><IconButton {...item} /></Box>)}\n    <Box width={2} />\n    {actionlist2.map((item, i) =>\n      <Box key={i}><IconButton {...item} /></Box>)}\n  </>\n}\n\nconst HeaderBar = () => {\n\n  return (<>\n    <HeaderTabs />\n    <HeaderActions />\n  </>)\n}\n\nexport default HeaderBar","import React, { useRef, useEffect } from \"react\"\nimport clsx from \"clsx\"\nimport { makeStyles } from \"@material-ui/core/styles\"\nimport { Music, useMapChange } from \"../../states\"\nimport { createAnimLoop } from \"../../../Common/hooks\"\nimport { TimeToString } from \"../../../Common/utils\"\nimport { scope } from \"../../../MappingScope/scope\"\nimport { startAnimation, stopAnimation } from \"../../../Common/animation\"\nimport { useObserver } from \"mobx-react-lite\"\nimport { autorun } from \"mobx\"\n\nconst useStyles = makeStyles(theme => ({\n  flex: { display: \"flex\", alignItems: \"center\" },\n  center: { justifyContent: \"center\" },\n  bar: { flexGrow: 1, height: \"100%\", position: \"relative\", },\n  time: { margin: theme.spacing(0, 2), width: 80, textAlign: \"center\" },\n  layer: { position: \"absolute\", width: \"100%\", height: \"100%\" },\n  midline: { width: \"100%\", borderBottom: \"1px solid white\" },\n  progress: { position: \"absolute\", height: \"100%\", borderLeft: \"4px solid red\" },\n  timepoint: {\n    position: \"absolute\", height: \"50%\", borderLeft: \"1px solid aquamarine\", transition: \"left 0.2s\"\n  }\n}))\n\nconst leftStyle = (time: number) => `${(time / Music.duration) * 100}%`\n\nconst TimepointLines = () => {\n\n  const cn = useStyles()\n\n  useMapChange()\n  const timepoints = scope.map.timepointlist\n\n  return useObserver(() => <>\n    {timepoints.map(tp =>\n      <div key={tp.id} className={cn.timepoint} style={{ left: leftStyle(tp.time) }} />)}\n  </>)\n}\n\nconst ProgressLine = () => {\n\n  const cn = useStyles()\n  const div = useRef<HTMLDivElement>(null)\n\n  useEffect(() => autorun(() => {\n    if (div.current) {\n      const current = Music.position() / Music.duration\n      if (Music.playing) {\n        startAnimation(div.current, \"left\", current * 100, 100, \"%\", Music.remaintime())\n      } else {\n        stopAnimation(div.current, \"left\", current * 100, \"%\")\n      }\n    }\n  }), [])\n\n  return <div className={cn.progress} ref={div}></div>\n}\n\nconst PlayTime = () => {\n\n  const cn = useStyles()\n  const div = useRef<HTMLDivElement>(null)\n  const lasttime = useRef(-1)\n\n  useEffect(() => createAnimLoop(() => {\n    const time = Music.position()\n    if (div.current && lasttime.current !== time) {\n      div.current.innerText = TimeToString(time)\n      lasttime.current = time\n    }\n  }), [])\n\n  return <div className={clsx(cn.flex, cn.center, cn.time)} ref={div} />\n}\n\nconst handleMouse = (e: React.MouseEvent<HTMLDivElement>) => {\n  if (!(e.buttons & 3)) return // if not left or right down\n  const bar = e.currentTarget\n  const x = e.pageX - bar.offsetLeft\n  Music.seek(x / bar.clientWidth * Music.duration)\n}\n\nconst handleTouch = (e: React.TouchEvent<HTMLDivElement>) => {\n  const bar = e.currentTarget\n  const x = e.changedTouches[0].pageX - bar.offsetLeft\n  Music.seek(x / bar.clientWidth * Music.duration)\n}\n\nconst handleScroll = (e: React.WheelEvent) => {\n  e.stopPropagation()\n  const dt = e.deltaY / 100\n  const target = Music.position() - dt\n  Music.seek(target)\n}\n\nconst ProgressBar = () => {\n\n  const cn = useStyles()\n\n  return useObserver(() =>\n    <div className={clsx(cn.flex, cn.bar)} style={{ overflow: \"hidden\" }} onWheel={handleScroll}>\n      <PlayTime />\n      <div className={cn.bar}\n        onMouseDown={handleMouse} onMouseMove={handleMouse}\n        onTouchStart={handleTouch} onTouchMove={handleTouch}>\n        <div className={clsx(cn.flex, cn.layer, cn.center)}>\n          <div className={cn.midline}></div>\n        </div>\n        <div className={cn.layer}>\n          <TimepointLines />\n        </div>\n        <div className={cn.layer}>\n          <ProgressLine />\n        </div>\n      </div>\n      <div className={clsx(cn.flex, cn.center, cn.time)}>\n        {TimeToString(Music.duration)}\n      </div>\n    </div>)\n}\n\nexport default ProgressBar","import React, { useEffect } from \"react\"\nimport IconButton from \"@material-ui/core/IconButton\"\nimport StopIcon from '@material-ui/icons/Stop'\nimport PauseIcon from '@material-ui/icons/Pause'\nimport PlayArrowIcon from '@material-ui/icons/PlayArrow'\nimport Box from \"@material-ui/core/Box\"\nimport Slider from \"@material-ui/core/Slider\"\nimport { useTranslation } from \"react-i18next\"\nimport { Music } from \"../../states\"\nimport { useObserver } from \"mobx-react-lite\"\nimport { addHotkey } from \"../../../Common/hooks\"\n\nconst Tools = () => {\n\n  const { t } = useTranslation()\n\n  useEffect(() => addHotkey(\"space\", Music.toggle), [])\n\n  return useObserver(() => <>\n    <IconButton onClick={Music.toggle} disabled={!Music.loaded}\n      title={t(\"Hotkey: {{ hotkey }}\", { hotkey: \"space\" })}>\n      {Music.playing ?\n        <PauseIcon /> : <PlayArrowIcon />}\n    </IconButton>\n    <IconButton onClick={Music.stop} disabled={!Music.loaded}>\n      <StopIcon />\n    </IconButton>\n    <Box width=\"120px\" ml={3} mr={4}>\n      <Slider value={Music.playbackrate} step={null} min={0.15} max={1}\n        title={t(\"Playback rate\")} color=\"secondary\"\n        onChange={(e, v) => Music.playbackrate = v as number}\n        marks={[\n          { value: 0.25, label: \"25%\" },\n          { value: 0.5, label: \"50%\" },\n          { value: 0.75, label: \"75%\" },\n          { value: 1, label: \"100%\" },]}\n      />\n    </Box>\n  </>)\n}\n\nexport default Tools","import React from \"react\"\nimport ProgressBar from \"./ProgressBar\"\nimport Tools from \"./Tools\"\n\n\nconst FooterBar = () => {\n\n  return (<>\n    <ProgressBar />\n    <Tools />\n  </>)\n}\n\nexport default FooterBar","import React, { useEffect } from \"react\"\nimport Box from \"@material-ui/core/Box\"\nimport CssBaseline from \"@material-ui/core/CssBaseline\"\nimport Fade from \"@material-ui/core/Fade\"\nimport { makeStyles, ThemeProvider } from \"@material-ui/core/styles\"\nimport BackgroundImage from \"./Components/BackgroundImage\"\nimport { theme } from \"./theme\"\nimport MainContent from \"./Components/MainContent\"\nimport HeaderBar from \"./Components/HeaderBar\"\nimport FooterBar from \"./Components/FooterBar\"\nimport GlobalSnackbar from \"../Common/Components/GlobalSnackbar\"\nimport { Music } from \"./states\"\n\nconst useStyles = makeStyles(theme => ({\n  content: { position: \"fixed\", display: \"flex\", flexDirection: \"column\", top: 0, bottom: 0, left: 0, right: 0 },\n  bar: { display: \"flex\", alignItems: \"center\", height: 50, width: \"100%\", backgroundColor: \"rgba(128, 128, 128, 0.4)\" },\n}))\n\nconst MappingPage = () => {\n\n  const cn = useStyles()\n\n  useEffect(() => () => {\n    if (Music.playing)\n      Music.toggle()\n  }, [])\n\n  return (\n    <ThemeProvider theme={theme}>\n      <CssBaseline />\n      <Fade in>\n        <Box className={cn.content}>\n          <BackgroundImage />\n          <Box className={cn.bar}>\n            <HeaderBar />\n          </Box>\n          <MainContent />\n          <Box className={cn.bar}>\n            <FooterBar />\n          </Box>\n        </Box>\n      </Fade>\n      <GlobalSnackbar />\n    </ThemeProvider>)\n}\n\nexport default MappingPage","import React, { useEffect, useRef } from \"react\"\nimport { makeStyles } from \"@material-ui/core/styles\"\nimport { Game } from \"bangbangboom-game\"\nimport { Music, Background } from \"../MappingPage/states\"\nimport { userMessage } from \"../Common/Components/GlobalSnackbar\"\nimport i18n from \"../i18n\"\nimport { scope } from \"../MappingScope/scope\"\nimport { toGameContent } from \"../MapFormats/bbbgame\"\n\nconst useStyles = makeStyles(theme => ({\n  root: { position: \"fixed\", left: 0, right: 0, top: 0, bottom: 0 },\n  canvas: { width: \"100%\", height: \"100%\" }\n}))\n\nconst GamePage = () => {\n\n  const cn = useStyles()\n  const container = useRef<HTMLDivElement>(null)\n  const canvas = useRef<HTMLCanvasElement>(null)\n\n  useEffect(() => {\n    if (!canvas.current) return\n    if (!Music.musicfile) {\n      window.history.back()\n      setTimeout(() => {\n        userMessage(i18n.t(\"No music selected\"))\n      }, 100)\n      return\n    }\n    const musicSrc = URL.createObjectURL(Music.musicfile)\n    const game = new Game(canvas.current, {\n      judgeOffset: scope.settings.game.judge_offset,\n      visualOffset: scope.settings.game.visual_offset,\n      speed: scope.settings.game.speed,\n      resolution: scope.settings.game.resolution,\n      noteScale: scope.settings.game.note_scale,\n      barOpacity: scope.settings.game.bar_opaciry,\n      backgroundDim: scope.settings.general.background_dim,\n      effectVolume: scope.settings.general.effect_volume,\n      showSimLine: scope.settings.game.show_sim_line,\n      laneEffect: scope.settings.game.lane_effect,\n      mirror: scope.settings.game.mirror,\n      beatNote: scope.settings.game.beat_note\n    }, {\n      musicSrc, backgroundSrc: Background.src, songName: scope.meta.name, skin: \"/assets/skins/default\",\n      mapContent: () => toGameContent(scope.map as any)\n    })\n    game.ondestroyed = () => {\n      window.history.back()\n    }\n    game.start()\n    return () => {\n      URL.revokeObjectURL(musicSrc)\n    }\n  }, [])\n\n  return <div ref={container} className={cn.root}>\n    <canvas ref={canvas} className={cn.canvas} /></div>\n}\n\nexport default GamePage\n","import { RawMap, NoteType, Slide } from \"bangbangboom-game\"\nimport { EditMap } from \"../MappingScope/EditMap\"\n\nexport function toGameContent(map: EditMap): RawMap {\n  const notes: NoteType[] = []\n  const slides: Slide[] = []\n\n  const slideIdIndex: { [key: number]: number } = {}\n\n  for (const [id, s] of map.slides) {\n    slideIdIndex[id] = slides.length\n    slides.push({ id: slides.length, flickend: s.flickend })\n  }\n\n  for (const [, n] of map.notes) {\n    if (n.type === \"single\")\n      notes.push({ type: \"single\", time: n.realtimecache, lane: n.lane, onbeat: n.offset % 48 === 0 })\n    else if (n.type === \"flick\")\n      notes.push({ type: \"flick\", time: n.realtimecache, lane: n.lane })\n    else\n      notes.push({ type: \"slide\", time: n.realtimecache, lane: n.lane, slideid: slideIdIndex[n.slide] })\n  }\n\n  return { notes, slides }\n}\n","import React, { useEffect } from 'react'\nimport MappingPage from './MappingPage'\nimport { useGameState } from './GamePage/gamestate'\nimport GamePage from './GamePage'\n\n\nconst App = () => {\n\n  useEffect(() => {\n    document.getElementById(\"loader\")?.remove()\n    document.getElementById(\"loader-style\")?.remove()\n\n    gtag('event', 'timing_complete', {\n      'name' : 'app_load',\n      'value' : performance.now(),\n    })\n  }, [])\n\n  const inGame = useGameState()\n\n  if (inGame) return <GamePage />\n\n  return <MappingPage />\n}\n\nexport default App\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n  // [::1] is the IPv6 localhost address.\n  window.location.hostname === '[::1]' ||\n  // 127.0.0.0/8 are considered localhost for IPv4.\n  window.location.hostname.match(\n    /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n  )\n)\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL,\n      window.location.href\n    )\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config)\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n            'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          )\n        })\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config)\n      }\n    })\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing\n        if (installingWorker == null) {\n          return\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              )\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration)\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.')\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration)\n              }\n            }\n          }\n        }\n      }\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error)\n    })\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type')\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload()\n          })\n        })\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config)\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      )\n    })\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister()\n    })\n  }\n}\n","import React from 'react'\nimport ReactDOM from 'react-dom'\nimport './index.css'\nimport \"./i18n\"\nimport App from './App'\nimport * as serviceWorker from './serviceWorker'\nimport { userMessage } from './Common/Components/GlobalSnackbar'\nimport i18n from './i18n'\nimport { scope } from './MappingScope/scope'\n\nwindow.addEventListener(\"error\", ev => {\n  gtag('event', 'exception', {\n    'description': ev.error,\n    'fatal': true\n  })\n})\n\nReactDOM.render(<App />, document.getElementById('root'))\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.register({\n  onUpdate() {\n    userMessage(i18n.t(\"An update is available. Please close ALL tabs of this site or press Ctrl + F5 reload.\"), \"info\")\n    scope.update = true\n  }\n})\n"],"sourceRoot":""}